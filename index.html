<!DOCTYPE html>
<!--
================================================================================
  CALCULADORA DID√ÅCTICA v2.0 ‚Äî F√≠sica & Matem√°ticas ¬∑ Exara Studio
================================================================================
FLUJO EDUCATIVO:
  1. La app presenta el problema con los DATOS YA DADOS.
  2. El alumno resuelve EN PAPEL usando la f√≥rmula mostrada.
  3. Escribe su resultado y presiona "Verificar".
  4. Si falla ‚Üí pistas progresivas que ense√±an el M√âTODO (no la respuesta).
  5. Al acertar ‚Üí los pasos se revelan autom√°ticamente para reforzar.

EXTENDER A ML (TensorFlow.js):
  - Reemplaza Adaptive.score() con model.predict()
  - Entradas [5]: [pct_correctos, intentos_prom, tiempo_prom, nivel_id, tema_id]
  - Salidas [3]: softmax ‚Üí [bajar, mantener, subir]
  - Guarda: model.save('localstorage://calc-ml')
================================================================================
-->
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Did√°ctica ‚Äî F√≠sica y Matem√°ticas</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300&family=JetBrains+Mono:wght@400;600&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js" defer></script>
<style>
:root{--bg:#0d1117;--sf:#161b22;--sf2:#21262d;--br:#30363d;--am:#e6a817;--ad:#9a6f0e;--cr:#f0e6d3;--cd:#b8a898;--gn:#3fb950;--rd:#f85149;--bl:#58a6ff;--pu:#bc8cff;--r:10px;--mn:'JetBrains Mono',monospace;--se:'Instrument Serif',serif;--bd:'Crimson Pro',serif}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--cr);font-family:var(--bd);font-size:18px;line-height:1.6;min-height:100vh}
body::before{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:0;opacity:.5}
.app{max-width:1100px;margin:0 auto;padding:24px 20px;position:relative;z-index:1}
header{display:flex;align-items:center;gap:16px;margin-bottom:32px;border-bottom:1px solid var(--br);padding-bottom:20px}
.logo{width:48px;height:48px;background:linear-gradient(135deg,var(--am),#c47f00);border-radius:12px;display:flex;align-items:center;justify-content:center;font-family:var(--mn);font-weight:600;font-size:20px;color:#000;flex-shrink:0;box-shadow:0 0 20px rgba(230,168,23,.25)}
.ht h1{font-family:var(--se);font-size:1.6rem;color:var(--cr);font-weight:normal;line-height:1.2}
.ht p{font-size:.85rem;color:var(--cd);font-family:var(--mn);letter-spacing:.03em}
header .ha{margin-left:auto}
.grid{display:grid;grid-template-columns:270px 1fr;gap:20px}
@media(max-width:768px){.grid{grid-template-columns:1fr}}
.sb{display:flex;flex-direction:column;gap:16px}
.panel{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:18px}
.pt{font-family:var(--mn);font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;color:var(--am);margin-bottom:14px;display:flex;align-items:center;gap:6px}
.pt::before{content:'';display:inline-block;width:6px;height:6px;background:var(--am);border-radius:50%}
.lvls{display:flex;flex-direction:column;gap:6px}
.lv{background:var(--sf2);border:1px solid var(--br);color:var(--cd);font-family:var(--bd);font-size:.95rem;padding:10px 14px;border-radius:6px;cursor:pointer;text-align:left;display:flex;align-items:center;gap:10px;transition:all .2s}
.lv:hover{border-color:var(--ad);color:var(--cr)}.lv.on{background:rgba(230,168,23,.12);border-color:var(--am);color:var(--am)}
.lv .badge{font-family:var(--mn);font-size:.65rem;padding:2px 6px;border-radius:4px;background:var(--br);color:var(--cd);margin-left:auto}
.tlist{display:flex;flex-direction:column;gap:4px}
.ti{padding:8px 12px;border-radius:6px;cursor:pointer;font-size:.9rem;color:var(--cd);border:1px solid transparent;transition:all .15s;display:flex;align-items:center;gap:8px}
.ti:hover{background:var(--sf2);color:var(--cr)}.ti.on{background:rgba(88,166,255,.1);border-color:rgba(88,166,255,.3);color:var(--bl)}
.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.sbox{background:var(--sf2);border:1px solid var(--br);border-radius:6px;padding:10px;text-align:center}
.sv{font-family:var(--mn);font-size:1.4rem;font-weight:600;color:var(--am)}
.sl{font-size:.7rem;color:var(--cd);letter-spacing:.04em;text-transform:uppercase;margin-top:2px}
.pbw{margin-top:12px}.pbl{display:flex;justify-content:space-between;font-size:.8rem;color:var(--cd);margin-bottom:4px}
.pb{height:6px;background:var(--sf2);border-radius:10px;overflow:hidden}
.pbf{height:100%;background:linear-gradient(90deg,var(--ad),var(--am));border-radius:10px;transition:width .5s}
.ast{background:var(--sf2);border:1px solid var(--br);border-radius:6px;padding:10px 12px;font-size:.82rem;color:var(--cd);margin-top:10px;line-height:1.4}
.ast strong{color:var(--bl)}
.mc{display:flex;flex-direction:column;gap:16px}
/* lesson */
.lcard{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:20px;border-left:3px solid var(--bl)}
.lcard h2{font-family:var(--se);font-size:1.25rem;color:var(--cr);margin-bottom:8px}
.cpt{color:var(--cd);font-size:.95rem;line-height:1.7}
.fbox{background:var(--sf2);border:1px solid var(--br);border-radius:6px;padding:10px 14px;margin-top:10px;font-family:var(--mn);font-size:.9rem;color:var(--am)}
/* problem */
.pcard{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:20px}
.plbl{font-family:var(--mn);font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;color:var(--am);margin-bottom:12px}
.pq{font-family:var(--se);font-size:1.12rem;color:var(--cr);line-height:1.7;margin-bottom:16px;white-space:pre-line}
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px}
.chip{background:var(--sf2);border:1px solid var(--br);border-radius:6px;padding:6px 14px;font-family:var(--mn);font-size:.88rem;color:var(--am)}
.chip span{color:var(--cd);font-size:.78rem;margin-left:4px}
.clbl{font-family:var(--mn);font-size:.68rem;color:var(--cd);text-transform:uppercase;letter-spacing:.08em;width:100%;margin-bottom:4px}
/* answer */
.az{background:rgba(88,166,255,.04);border:1px dashed rgba(88,166,255,.3);border-radius:8px;padding:16px 18px;margin-bottom:14px}
.albl{font-family:var(--mn);font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;color:var(--bl);margin-bottom:10px}
.ar{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.ai{background:var(--sf2);border:2px solid var(--br);color:var(--cr);font-family:var(--mn);font-size:1.1rem;padding:10px 14px;border-radius:8px;outline:none;transition:border-color .2s;width:180px}
.ai:focus{border-color:var(--bl)}.ai.ok{border-color:var(--gn)!important;background:rgba(63,185,80,.06)}.ai.no{border-color:var(--rd)!important;background:rgba(248,81,73,.06)}
.au{font-family:var(--mn);font-size:.9rem;color:var(--cd)}
.asub{font-size:.82rem;color:var(--cd);margin-top:8px;font-style:italic}
/* btns */
.btn{font-family:var(--mn);font-size:.8rem;font-weight:600;letter-spacing:.05em;padding:9px 18px;border-radius:6px;border:1px solid transparent;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.bp{background:var(--am);color:#000;border-color:var(--am)}.bp:hover{background:#d4960a}
.bg{background:transparent;border-color:var(--br);color:var(--cd)}.bg:hover{border-color:var(--ad);color:var(--cr)}
.bh{background:rgba(88,166,255,.12);border-color:rgba(88,166,255,.3);color:var(--bl)}.bh:hover{background:rgba(88,166,255,.2)}.bh:disabled{opacity:.35;cursor:not-allowed}
.bs{background:rgba(188,140,255,.1);border-color:rgba(188,140,255,.3);color:var(--pu)}.bs:hover{background:rgba(188,140,255,.2)}
.bn{background:rgba(63,185,80,.1);border-color:rgba(63,185,80,.3);color:var(--gn)}.bn:hover{background:rgba(63,185,80,.2)}
.arow{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
/* feedback */
.fb{border-radius:8px;padding:14px 16px;display:none;margin-top:10px}
.fb.show{display:block}.fb.ok{border:1px solid rgba(63,185,80,.5);background:rgba(63,185,80,.06)}.fb.no{border:1px solid rgba(248,81,73,.5);background:rgba(248,81,73,.06)}
.fbt{font-family:var(--mn);font-size:.82rem;font-weight:600;margin-bottom:4px}
.fb.ok .fbt{color:var(--gn)}.fb.no .fbt{color:var(--rd)}.fbm{font-size:.9rem;color:var(--cd)}
/* hints */
.hb{display:none;background:rgba(88,166,255,.06);border:1px solid rgba(88,166,255,.22);border-radius:8px;padding:14px 16px;font-size:.9rem;color:var(--cr);line-height:1.6;margin-top:8px}
.hb.show{display:block}.hl{font-family:var(--mn);font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--bl);margin-bottom:8px}
/* steps */
.stps{background:var(--sf2);border:1px solid var(--br);border-radius:8px;padding:18px;margin-top:10px;display:none}
.stps.show{display:block}
.stps h4{font-family:var(--mn);font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;color:var(--pu);margin-bottom:14px}
.si{display:flex;gap:14px;padding:10px 0;border-bottom:1px solid var(--br)}.si:last-child{border-bottom:none}
.sn{font-family:var(--mn);font-size:.75rem;color:var(--am);font-weight:600;min-width:26px;padding-top:2px}
.sb2{font-size:.92rem;color:var(--cr);line-height:1.6}
.st{margin-bottom:3px}
.sm{font-family:var(--mn);font-size:.86rem;color:var(--am);margin-top:4px;padding:5px 10px;background:rgba(230,168,23,.08);border-radius:4px;display:inline-block}
.ar2{margin-top:12px;padding:10px 14px;background:rgba(230,168,23,.07);border-radius:6px;font-family:var(--mn);font-size:.85rem;color:var(--am)}
/* plot */
.plot{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:16px;display:none}
.plot.show{display:block}.plot h3{font-family:var(--mn);font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;color:var(--am);margin-bottom:12px}
#pC{width:100%;height:280px}
/* suggest */
.sug{display:none;background:rgba(63,185,80,.07);border:1px solid rgba(63,185,80,.28);border-radius:8px;padding:12px 16px;font-size:.88rem;color:var(--gn);margin-top:10px}
.sug.show{display:block}.sug strong{display:block;font-family:var(--mn);font-size:.68rem;letter-spacing:.08em;text-transform:uppercase;margin-bottom:4px}
/* history */
.hist{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:18px;margin-top:20px}
.hl2{display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto;margin-top:10px}
.hi{display:flex;align-items:center;gap:10px;background:var(--sf2);border-radius:6px;padding:8px 12px;font-size:.82rem}
.hd{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.hi.ok .hd{background:var(--gn)}.hi.no .hd{background:var(--rd)}
.htx{flex:1;color:var(--cd)}.hbg{font-family:var(--mn);font-size:.65rem;padding:2px 6px;border-radius:4px;background:var(--br);color:var(--cd)}
/* ---- TABS NAV ---- */
.tab-nav{display:flex;gap:4px;background:var(--sf2);border:1px solid var(--br);border-radius:8px;padding:3px}
.tab-btn{font-family:var(--mn);font-size:.75rem;letter-spacing:.06em;padding:6px 14px;border-radius:5px;border:none;cursor:pointer;background:transparent;color:var(--cd);transition:all .2s}
.tab-btn:hover{color:var(--cr)}.tab-btn.on{background:var(--am);color:#000;font-weight:600}
/* ---- BIBLIOTECA ---- */
#sec-biblioteca{display:none}
#sec-ejercicios{display:block}
/* Top nav biblioteca */
.bib-nav{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:24px}
.bib-tab{font-family:var(--mn);font-size:.75rem;padding:7px 16px;border-radius:20px;border:1px solid var(--br);background:var(--sf2);color:var(--cd);cursor:pointer;transition:all .2s}
.bib-tab:hover{border-color:var(--ad);color:var(--cr)}.bib-tab.on{background:rgba(230,168,23,.15);border-color:var(--am);color:var(--am)}
/* Nivel pills */
.lv-pills{display:flex;gap:6px;margin-bottom:20px}
.lv-pill{font-family:var(--mn);font-size:.68rem;padding:4px 12px;border-radius:10px;border:1px solid var(--br);background:var(--sf2);color:var(--cd);cursor:pointer;transition:all .15s}
.lv-pill:hover{border-color:var(--bl)}.lv-pill.on{background:rgba(88,166,255,.15);border-color:var(--bl);color:var(--bl)}
/* Teoria card */
.teoria{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);overflow:hidden;margin-bottom:16px}
.teoria-head{padding:16px 20px;border-bottom:1px solid var(--br);display:flex;align-items:center;gap:10px}
.teoria-icon{font-size:1.4rem}
.teoria-head h3{font-family:var(--se);font-size:1.1rem;color:var(--cr)}
.teoria-head .nivel-badge{font-family:var(--mn);font-size:.62rem;padding:2px 8px;border-radius:10px;margin-left:auto}
.nivel-badge.basic{background:rgba(63,185,80,.15);color:var(--gn);border:1px solid rgba(63,185,80,.3)}
.nivel-badge.intermediate{background:rgba(88,166,255,.15);color:var(--bl);border:1px solid rgba(88,166,255,.3)}
.nivel-badge.advanced{background:rgba(188,140,255,.15);color:var(--pu);border:1px solid rgba(188,140,255,.3)}
.teoria-body{padding:18px 20px;display:flex;flex-direction:column;gap:14px}
.teoria-text{font-size:.95rem;color:var(--cd);line-height:1.75}
.teoria-text strong{color:var(--cr)}
/* Formula strip */
.fstrip{display:flex;flex-wrap:wrap;gap:8px}
.fchip{background:var(--sf2);border:1px solid rgba(230,168,23,.35);border-radius:6px;padding:7px 14px;font-family:var(--mn);font-size:.82rem;color:var(--am)}
/* Ejemplo real */
.ejemplo{background:rgba(88,166,255,.05);border:1px solid rgba(88,166,255,.2);border-radius:8px;padding:14px 16px}
.ejemplo-lbl{font-family:var(--mn);font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--bl);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.ejemplo-lbl::before{content:'üåç'}
.ejemplo-text{font-size:.9rem;color:var(--cr);line-height:1.65}
/* Actividad */
.actividad{background:rgba(188,140,255,.05);border:1px solid rgba(188,140,255,.25);border-radius:8px;padding:14px 16px}
.act-lbl{font-family:var(--mn);font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--pu);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.act-lbl::before{content:'üéØ'}
.act-text{font-size:.9rem;color:var(--cr);line-height:1.65;margin-bottom:10px}
.act-dato{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.act-chip{background:var(--sf2);border:1px solid var(--br);border-radius:5px;padding:4px 10px;font-family:var(--mn);font-size:.8rem;color:var(--am)}
.act-resp{background:var(--sf2);border:1px solid rgba(188,140,255,.3);border-radius:6px;padding:10px 14px;font-family:var(--mn);font-size:.82rem;display:none}
.act-resp.show{display:block;color:var(--pu)}
.btn-reveal{font-family:var(--mn);font-size:.72rem;padding:5px 12px;border-radius:5px;border:1px solid rgba(188,140,255,.3);background:transparent;color:var(--pu);cursor:pointer;transition:all .15s}
.btn-reveal:hover{background:rgba(188,140,255,.1)}
/* Dato curioso */
.curiosidad{background:rgba(230,168,23,.05);border:1px solid rgba(230,168,23,.2);border-radius:8px;padding:12px 16px;font-size:.88rem;color:var(--cd);line-height:1.6}
.cur-lbl{font-family:var(--mn);font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:var(--am);margin-bottom:6px}
.cur-lbl::before{content:'üí° '}
/* TTS */
.tts-btn{margin-left:auto;background:rgba(88,166,255,.1);border:1px solid rgba(88,166,255,.3);color:var(--bl);font-size:.78rem;padding:4px 12px;border-radius:6px;cursor:pointer;font-family:var(--mn);transition:all .15s;white-space:nowrap}
.tts-btn:hover{background:rgba(88,166,255,.2)}
/* ---- SIMULADOR ---- */
#sec-simulador{display:none}
.sim-wrap{display:flex;flex-direction:column;gap:16px}
.sim-fn-bar{display:flex;flex-wrap:wrap;gap:6px}
.sim-fn-btn{font-family:var(--mn);font-size:.72rem;padding:7px 14px;border-radius:20px;border:1px solid var(--br);background:var(--sf2);color:var(--cd);cursor:pointer;transition:all .2s}
.sim-fn-btn:hover{border-color:var(--am);color:var(--cr)}.sim-fn-btn.on{background:rgba(230,168,23,.15);border-color:var(--am);color:var(--am)}
.sim-main{display:grid;grid-template-columns:1fr 280px;gap:16px}
@media(max-width:900px){.sim-main{grid-template-columns:1fr}}
.sim-canvas-wrap{position:relative;background:var(--sf);border:1px solid var(--br);border-radius:var(--r);overflow:hidden}
#simCanvas{display:block;width:100%;cursor:crosshair}
.sim-coords{position:absolute;top:10px;left:12px;font-family:var(--mn);font-size:.7rem;color:var(--cd);background:rgba(13,17,23,.7);padding:3px 8px;border-radius:4px;pointer-events:none}
.sim-controls{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:16px;display:flex;flex-direction:column;gap:14px}
.sim-ctrl{display:flex;flex-direction:column;gap:6px}
.sim-ctrl-label{display:flex;justify-content:space-between;align-items:center}
.sim-ctrl-name{font-family:var(--mn);font-size:.72rem;color:var(--am);letter-spacing:.06em}
.sim-ctrl-val{font-family:var(--mn);font-size:.82rem;color:var(--cr);font-weight:600;min-width:48px;text-align:right}
input[type=range].sim-range{width:100%;accent-color:var(--am);cursor:pointer;height:4px}
.sim-fn-eq{background:var(--sf2);border:1px solid rgba(230,168,23,.3);border-radius:6px;padding:8px 14px;font-family:var(--mn);font-size:.88rem;color:var(--am);text-align:center;margin-bottom:4px;word-break:break-all}
.sim-checkpoint{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
.sim-cp{background:rgba(88,166,255,.1);border:1px solid rgba(88,166,255,.25);border-radius:5px;padding:4px 10px;font-family:var(--mn);font-size:.7rem;color:var(--bl)}
.sim-desc{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:16px 20px}
.sim-desc h4{font-family:var(--se);font-size:1.05rem;color:var(--cr);margin-bottom:8px}
.sim-desc p{font-size:.9rem;color:var(--cd);line-height:1.7}
.sim-desc p strong{color:var(--cr)}
.sim-table-wrap{background:var(--sf);border:1px solid var(--br);border-radius:var(--r);padding:16px}
.sim-table{width:100%;border-collapse:collapse;font-family:var(--mn);font-size:.78rem}
.sim-table th{background:var(--sf2);color:var(--am);padding:6px 12px;text-align:center;border-bottom:1px solid var(--br)}
.sim-table td{color:var(--cd);padding:5px 12px;text-align:center;border-bottom:1px solid rgba(48,54,61,.5)}
.sim-table tr:hover td{background:rgba(230,168,23,.04);color:var(--cr)}
.sim-reset{font-family:var(--mn);font-size:.7rem;padding:5px 12px;border-radius:5px;border:1px solid var(--br);background:transparent;color:var(--cd);cursor:pointer;margin-top:4px;transition:all .15s;width:100%}
.sim-reset:hover{border-color:var(--am);color:var(--am)}
.toast{position:fixed;bottom:24px;right:24px;background:var(--sf);border:1px solid var(--br);border-radius:10px;padding:14px 20px;font-size:.88rem;color:var(--cr);box-shadow:0 8px 30px rgba(0,0,0,.5);transform:translateY(80px);opacity:0;transition:all .35s cubic-bezier(.34,1.56,.64,1);z-index:999;max-width:300px}
.toast.on{transform:translateY(0);opacity:1}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--sf)}::-webkit-scrollbar-thumb{background:var(--br);border-radius:3px}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo" aria-hidden="true">‚àë</div>
    <div class="ht">
      <h1>Calculadora Did√°ctica</h1>
      <p>F√≠sica &amp; Matem√°ticas ¬∑ T√∫ resuelves, la app te gu√≠a</p>
    </div>
    <div class="ha" style="display:flex;align-items:center;gap:10px">
      <nav class="tab-nav" aria-label="Secciones">
        <button class="tab-btn on" onclick="switchTab('ejercicios')" id="tab-ejercicios">‚ö° Ejercicios</button>
        <button class="tab-btn"    onclick="switchTab('biblioteca')" id="tab-biblioteca">üìö Biblioteca</button>
        <button class="tab-btn"    onclick="switchTab('simulador')"  id="tab-simulador">üìà Simulador</button>
      </nav>
      <button class="btn bg" onclick="clearAll()">‚ü≥ Reiniciar</button>
    </div>
  </header>
<!-- ======================================================
     SECCI√ìN: EJERCICIOS (contenido original)
====================================================== -->
<div id="sec-ejercicios">
  <div class="grid">
    <aside class="sb">
      <div class="panel">
        <div class="pt">Nivel</div>
        <div class="lvls">
          <button class="lv on" data-lv="basic"        onclick="setLv('basic')">‚óé B√°sico <span class="badge">1¬∞</span></button>
          <button class="lv"    data-lv="intermediate" onclick="setLv('intermediate')">‚óé Intermedio <span class="badge">2¬∞</span></button>
          <button class="lv"    data-lv="advanced"     onclick="setLv('advanced')">‚óé Avanzado <span class="badge">3¬∞</span></button>
        </div>
      </div>
      <div class="panel"><div class="pt">Tema</div><div class="tlist" id="tList"></div></div>
      <div class="panel">
        <div class="pt">Tu Progreso</div>
        <div class="sgrid">
          <div class="sbox"><div class="sv" id="sAcc">‚Äî</div><div class="sl">Precisi√≥n</div></div>
          <div class="sbox"><div class="sv" id="sAtt">‚Äî</div><div class="sl">Intentos</div></div>
          <div class="sbox"><div class="sv" id="sTim">‚Äî</div><div class="sl">T. Medio</div></div>
          <div class="sbox"><div class="sv" id="sSco">0</div><div class="sl">Score</div></div>
        </div>
        <div class="pbw">
          <div class="pbl"><span>Dominio</span><span id="mPct">0%</span></div>
          <div class="pb"><div class="pbf" id="mBar" style="width:0%"></div></div>
        </div>
        <div class="ast" id="adSt">Completa ejercicios para activar el ajuste de dificultad.</div>
      </div>
    </aside>
    <main class="mc" id="main"></main>
  </div>
  <div class="hist">
    <div class="pt">Historial</div>
    <div class="hl2" id="hList"><p style="color:var(--cd);font-size:.85rem;">Sin actividad a√∫n.</p></div>
  </div>
</div><!-- /sec-ejercicios -->

<!-- ======================================================
     SECCI√ìN: BIBLIOTECA ‚Äî Teor√≠a ¬∑ Ejemplos ¬∑ Actividades
====================================================== -->
<div id="sec-biblioteca">
  <div style="margin-bottom:20px">
    <!-- Selector de tema de biblioteca -->
    <div class="bib-nav" id="bibNav"></div>
    <!-- Selector de nivel -->
    <div class="lv-pills">
      <button class="lv-pill on" onclick="setBibLv('basic')"        id="bpill-basic">‚óé B√°sico</button>
      <button class="lv-pill"    onclick="setBibLv('intermediate')" id="bpill-intermediate">‚óé Intermedio</button>
      <button class="lv-pill"    onclick="setBibLv('advanced')"     id="bpill-advanced">‚óé Avanzado</button>
    </div>
    <!-- Contenido de la biblioteca -->
    <div id="bibContent"></div>
  </div>
</div><!-- /sec-biblioteca -->

<!-- ======================================================
     SECCI√ìN: SIMULADOR VISUAL DE FUNCIONES
====================================================== -->
<div id="sec-simulador" style="display:none">
  <div class="sim-wrap">
    <!-- Selector de funci√≥n -->
    <div class="sim-fn-bar" id="simFnBar"></div>
    <!-- Panel principal: gr√°fica + controles -->
    <div class="sim-main">
      <!-- Canvas de la gr√°fica -->
      <div class="sim-canvas-wrap">
        <canvas id="simCanvas" width="600" height="400"></canvas>
        <div class="sim-coords" id="simCoords"></div>
      </div>
      <!-- Panel de controles -->
      <div class="sim-controls" id="simControls"></div>
    </div>
    <!-- Descripci√≥n pedag√≥gica -->
    <div class="sim-desc" id="simDesc"></div>
    <!-- Tabla de valores -->
    <div class="sim-table-wrap">
      <div class="pt" style="margin-bottom:10px;margin-top:4px">Tabla de valores</div>
      <div style="overflow-x:auto"><table class="sim-table" id="simTable"></table></div>
    </div>
  </div>
</div><!-- /sec-simulador -->
</div><!-- /app -->
<div class="toast" id="toast" role="alert" aria-live="polite"></div>
<script>
// ================================================================
// BASE DE DATOS DE EJERCICIOS
// Los datos est√°n DADOS. El alumno calcula y escribe su respuesta.
// ================================================================
const DB = {
  velocity:{label:'Velocidad',icon:'‚Üí',levels:{
    basic:[
      {id:'vb1',title:'Velocidad media',
       concept:'La velocidad media es la distancia recorrida dividida entre el tiempo empleado. Cuanto m√°s distancia en menos tiempo, mayor es la velocidad.',
       formula:'v = d / t',
       gen:()=>({d:Math.round(Math.random()*400+50),t:parseFloat((Math.random()*25+2).toFixed(1))}),
       question:d=>`Un corredor recorre <strong>${d.d} metros</strong> en <strong>${d.t} segundos</strong>. ¬øCu√°l es su velocidad media?`,
       chips:d=>[['d',d.d,'m'],['t',d.t,'s']],
       answer:d=>d.d/d.t, unit:'m/s', tol:0.01,
       steps:d=>{const r=(d.d/d.t).toFixed(3);return[
         {t:'Escribe los datos dados.',m:`d = ${d.d} m   |   t = ${d.t} s`},
         {t:'F√≥rmula de velocidad media.',m:'v = d / t'},
         {t:'Sustituye los valores en la f√≥rmula.',m:`v = ${d.d} / ${d.t}`},
         {t:'Realiza la divisi√≥n.',m:`v = ${r} m/s`}]},
       hints:['La f√≥rmula es **v = d / t**. Divide la distancia entre el tiempo.',
              'Sustituye directamente: v = {d} / {t}. Ahora haz la divisi√≥n en papel.',
              'Soluci√≥n: v = {d} / {t} = {r} m/s']},
      {id:'vb2',title:'Tiempo de viaje',
       concept:'Si conocemos velocidad y distancia, despejamos t de la f√≥rmula v=d/t. A mayor velocidad, menos tiempo se tarda en recorrer la misma distancia.',
       formula:'t = d / v',
       gen:()=>({v:Math.round(Math.random()*20+5),d:Math.round(Math.random()*300+50)}),
       question:d=>`Un ciclista viaja a <strong>${d.v} m/s</strong> y debe recorrer <strong>${d.d} metros</strong>. ¬øCu√°nto tiempo tardar√°?`,
       chips:d=>[['v',d.v,'m/s'],['d',d.d,'m']],
       answer:d=>d.d/d.v, unit:'s', tol:0.01,
       steps:d=>{const r=(d.d/d.v).toFixed(3);return[
         {t:'Datos conocidos.',m:`v = ${d.v} m/s   |   d = ${d.d} m`},
         {t:'Despeja t de la f√≥rmula base v = d/t.',m:'v = d/t   ‚Üí   t = d / v'},
         {t:'Sustituye.',m:`t = ${d.d} / ${d.v}`},
         {t:'Resultado.',m:`t = ${r} s`}]},
       hints:['Despeja t de v = d/t: **t = d / v**. Divide distancia entre velocidad.',
              'Sustituye: t = {d} / {v}. Solo divide los dos n√∫meros.',
              'Soluci√≥n: t = {d} / {v} = {r} s']},
    ],
    intermediate:[
      {id:'vi1',title:'Velocidad relativa',
       concept:'La velocidad relativa depende del sentido de movimiento: si van en el mismo sentido se restan las velocidades; si van en sentidos opuestos se suman.',
       formula:'v_rel = |v‚ÇÅ‚àív‚ÇÇ| (mismo sentido)   √≥   v‚ÇÅ+v‚ÇÇ (opuestos)',
       gen:()=>({v1:Math.round(Math.random()*40+20),v2:Math.round(Math.random()*30+10),dir:Math.random()>.5?'mismo sentido':'sentidos opuestos'}),
       question:d=>`El tren A va a <strong>${d.v1} m/s</strong> y el tren B a <strong>${d.v2} m/s</strong> en <strong>${d.dir}</strong>. ¬øCu√°l es la velocidad relativa entre ellos?`,
       chips:d=>[['v‚ÇÅ',d.v1,'m/s'],['v‚ÇÇ',d.v2,'m/s'],['direcci√≥n',d.dir,'']],
       answer:d=>d.dir==='mismo sentido'?Math.abs(d.v1-d.v2):d.v1+d.v2, unit:'m/s', tol:0.01,
       steps:d=>{const r=d.dir==='mismo sentido'?Math.abs(d.v1-d.v2):d.v1+d.v2;return[
         {t:'Velocidades y direcci√≥n del movimiento.',m:`v‚ÇÅ=${d.v1} m/s   |   v‚ÇÇ=${d.v2} m/s   |   ${d.dir}`},
         {t:d.dir==='mismo sentido'?'Mismo sentido ‚Üí resta los m√≥dulos.':'Sentidos opuestos ‚Üí suma las velocidades.',m:d.dir==='mismo sentido'?`v_rel = |${d.v1} ‚àí ${d.v2}|`:`v_rel = ${d.v1} + ${d.v2}`},
         {t:'Resultado.',m:`v_rel = ${r} m/s`}]},
       hints:['**Mismo sentido**: resta  /  **Sentidos opuestos**: suma. ¬øQu√© dice el enunciado?',
              'El enunciado dice "{dir}". Aplica la operaci√≥n correcta con {v1} y {v2}.',
              'Soluci√≥n: v_rel = {r} m/s']},
    ],
    advanced:[
      {id:'va1',title:'MRUA ‚Äî Velocidad final',
       concept:'En el Movimiento Rectil√≠neo Uniformemente Acelerado (MRUA) la velocidad cambia de forma constante. La ecuaci√≥n v = v‚ÇÄ + a¬∑t relaciona los cuatro valores clave.',
       formula:'v = v‚ÇÄ + a ¬∑ t',
       gen:()=>({v0:Math.round(Math.random()*20),a:parseFloat((Math.random()*5+0.5).toFixed(1)),t:Math.round(Math.random()*12+2)}),
       question:d=>`Un veh√≠culo parte con velocidad inicial de <strong>${d.v0} m/s</strong> y tiene aceleraci√≥n de <strong>${d.a} m/s¬≤</strong>. ¬øCu√°l es su velocidad tras <strong>${d.t} segundos</strong>?`,
       chips:d=>[['v‚ÇÄ',d.v0,'m/s'],['a',d.a,'m/s¬≤'],['t',d.t,'s']],
       answer:d=>d.v0+d.a*d.t, unit:'m/s', tol:0.01,
       steps:d=>{const at=(d.a*d.t).toFixed(2);const r=(d.v0+d.a*d.t).toFixed(2);return[
         {t:'Datos del problema.',m:`v‚ÇÄ=${d.v0} m/s   |   a=${d.a} m/s¬≤   |   t=${d.t} s`},
         {t:'Ecuaci√≥n cinem√°tica del MRUA.',m:'v = v‚ÇÄ + a ¬∑ t'},
         {t:'Calcula a¬∑t primero (multiplica).',m:`a¬∑t = ${d.a} √ó ${d.t} = ${at}`},
         {t:'Suma el resultado a v‚ÇÄ.',m:`v = ${d.v0} + ${at} = ${r} m/s`}]},
       hints:['F√≥rmula MRUA: **v = v‚ÇÄ + a¬∑t**. Identifica los tres valores dados.',
              'Primero multiplica a√ót = {a}√ó{t}. Luego s√∫male v‚ÇÄ = {v0}.',
              'Soluci√≥n: v = {v0}+{a}√ó{t} = {r} m/s']},
    ]
  }},
  kinematics:{label:'Cinem√°tica',icon:'‚ü≥',levels:{
    basic:[
      {id:'kb1',title:'Tiro parab√≥lico ‚Äî Alcance',
       concept:'Un proyectil lanzado con √°ngulo Œ∏ sigue una par√°bola. El alcance m√°ximo ocurre a 45¬∞. La gravedad g = 9.8 m/s¬≤ act√∫a siempre hacia abajo.',
       formula:'R = v‚ÇÄ¬≤ ¬∑ sin(2Œ∏) / g',
       gen:()=>({v0:Math.round(Math.random()*20+10),theta:Math.round(Math.random()*55+15)}),
       question:d=>`Un proyectil se lanza a <strong>${d.v0} m/s</strong> con √°ngulo de <strong>${d.theta}¬∞</strong>. Calcula el alcance horizontal. (g = 9.8 m/s¬≤)`,
       chips:d=>[['v‚ÇÄ',d.v0,'m/s'],['Œ∏',d.theta,'¬∞'],['g','9.8','m/s¬≤']],
       answer:d=>(d.v0*d.v0*Math.sin(2*d.theta*Math.PI/180))/9.8, unit:'m', tol:0.02, hasPlot:true,
       steps:d=>{const s2=Math.sin(2*d.theta*Math.PI/180);const R=((d.v0*d.v0*s2)/9.8).toFixed(2);return[
         {t:'Datos.',m:`v‚ÇÄ=${d.v0} m/s   |   Œ∏=${d.theta}¬∞   |   g=9.8 m/s¬≤`},
         {t:'F√≥rmula del alcance horizontal.',m:'R = v‚ÇÄ¬≤ ¬∑ sin(2Œ∏) / g'},
         {t:'Calcula sin(2Œ∏): multiplica el √°ngulo por 2 y aplica seno.',m:`sin(2√ó${d.theta}¬∞) = sin(${2*d.theta}¬∞) ‚âà ${s2.toFixed(4)}`},
         {t:'Eleva v‚ÇÄ al cuadrado.',m:`v‚ÇÄ¬≤ = ${d.v0}¬≤ = ${d.v0*d.v0}`},
         {t:'Sustituye todo y divide entre g.',m:`R = ${d.v0*d.v0} √ó ${s2.toFixed(4)} / 9.8 ‚âà ${R} m`}]},
       hints:['F√≥rmula: **R = v‚ÇÄ¬≤¬∑sin(2Œ∏)/g**. Calcula sin(2Œ∏) en tu calculadora primero.',
              'Paso 1: sin(2√ó{theta}¬∞).  Paso 2: {v0}¬≤.  Paso 3: multiplica y divide entre 9.8.',
              'Soluci√≥n: R ‚âà {r} m']},
    ],
    intermediate:[
      {id:'ki1',title:'MRUA ‚Äî Posici√≥n final',
       concept:'La ecuaci√≥n x = x‚ÇÄ + v‚ÇÄt + ¬Ωat¬≤ describe la posici√≥n en cada instante del MRUA. Tiene tres t√©rminos que se calculan por separado y se suman al final.',
       formula:'x = x‚ÇÄ + v‚ÇÄ¬∑t + ¬Ω¬∑a¬∑t¬≤',
       gen:()=>({x0:Math.round(Math.random()*15),v0:Math.round(Math.random()*12+2),a:parseFloat((Math.random()*4-1).toFixed(1)),t:Math.round(Math.random()*7+2)}),
       question:d=>`Un objeto parte de <strong>x‚ÇÄ = ${d.x0} m</strong> con <strong>v‚ÇÄ = ${d.v0} m/s</strong> y <strong>a = ${d.a} m/s¬≤</strong>. ¬øCu√°l es su posici√≥n a los <strong>${d.t} segundos</strong>?`,
       chips:d=>[['x‚ÇÄ',d.x0,'m'],['v‚ÇÄ',d.v0,'m/s'],['a',d.a,'m/s¬≤'],['t',d.t,'s']],
       answer:d=>d.x0+d.v0*d.t+0.5*d.a*d.t*d.t, unit:'m', tol:0.02,
       steps:d=>{const t2=(d.v0*d.t);const t3=(0.5*d.a*d.t*d.t).toFixed(2);const r=(d.x0+d.v0*d.t+0.5*d.a*d.t*d.t).toFixed(2);return[
         {t:'Datos.',m:`x‚ÇÄ=${d.x0}   v‚ÇÄ=${d.v0}   a=${d.a}   t=${d.t}`},
         {t:'Ecuaci√≥n de posici√≥n MRUA.',m:'x = x‚ÇÄ + v‚ÇÄ¬∑t + ¬Ω¬∑a¬∑t¬≤'},
         {t:'Calcula el 2¬∞ t√©rmino: v‚ÇÄ¬∑t',m:`v‚ÇÄ¬∑t = ${d.v0}√ó${d.t} = ${t2}`},
         {t:'Calcula el 3¬∞ t√©rmino: ¬Ω¬∑a¬∑t¬≤',m:`¬Ω¬∑a¬∑t¬≤ = 0.5√ó${d.a}√ó${d.t}¬≤ = ${t3}`},
         {t:'Suma los tres t√©rminos.',m:`x = ${d.x0} + ${t2} + (${t3}) = ${r} m`}]},
       hints:['Ecuaci√≥n: **x = x‚ÇÄ + v‚ÇÄt + ¬Ωat¬≤**. Calcula cada t√©rmino por separado antes de sumar.',
              'T√©rmino 2: v‚ÇÄ¬∑t = {v0}√ó{t}.   T√©rmino 3: ¬Ω√ó{a}√ó{t}¬≤.   Luego suma los tres.',
              'Soluci√≥n: x ‚âà {r} m']},
    ],
    advanced:[
      {id:'ka1',title:'Lanzamiento horizontal ‚Äî Tiempo de vuelo',
       concept:'En el lanzamiento horizontal el movimiento vertical es ca√≠da libre pura (velocidad inicial vertical = 0). El tiempo de vuelo s√≥lo depende de la altura.',
       formula:'h = ¬Ω¬∑g¬∑t¬≤   ‚Üí   t = ‚àö(2h/g)',
       gen:()=>({h:Math.round(Math.random()*80+20),v0:Math.round(Math.random()*25+10)}),
       question:d=>`Un objeto se lanza horizontalmente a <strong>${d.v0} m/s</strong> desde <strong>${d.h} m</strong> de altura. ¬øCu√°nto tarda en llegar al suelo? (g = 9.8 m/s¬≤)`,
       chips:d=>[['h',d.h,'m'],['v‚ÇÄ',d.v0,'m/s (horiz.)'],['g','9.8','m/s¬≤']],
       answer:d=>Math.sqrt(2*d.h/9.8), unit:'s', tol:0.02, hasPlot:true,
       steps:d=>{const t=Math.sqrt(2*d.h/9.8);const t2=(2*d.h/9.8).toFixed(4);return[
         {t:'El movimiento vertical es ca√≠da libre (v‚ÇÄv = 0).',m:'h = ¬Ω¬∑g¬∑t¬≤'},
         {t:'Despeja t¬≤.',m:`t¬≤ = 2h/g = 2√ó${d.h}/9.8 = ${t2}`},
         {t:'Aplica ra√≠z cuadrada.',m:`t = ‚àö${t2} = ${t.toFixed(3)} s`},
         {t:'La velocidad horizontal no afecta al tiempo (solo al alcance).',m:`Alcance = v‚ÇÄ¬∑t = ${d.v0}√ó${t.toFixed(3)} = ${(d.v0*t).toFixed(2)} m`}]},
       hints:['Ca√≠da libre vertical: **h = ¬Ω¬∑g¬∑t¬≤**. Despeja t: t = ‚àö(2h/g).',
              'Sustituye: t¬≤ = 2√ó{h}/9.8. Calcula ese n√∫mero y extrae la ra√≠z cuadrada.',
              'Soluci√≥n: t = {r} s']},
    ]
  }},
  vectors:{label:'Vectores',icon:'‚Üó',levels:{
    basic:[
      {id:'veb1',title:'M√≥dulo de un vector',
       concept:'El m√≥dulo es la "longitud" de un vector 2D. Se calcula con el Teorema de Pit√°goras: las dos componentes son los catetos y el m√≥dulo es la hipotenusa.',
       formula:'|A| = ‚àö(Ax¬≤ + Ay¬≤)',
       gen:()=>({ax:Math.round(Math.random()*10-2),ay:Math.round(Math.random()*10+1)}),
       question:d=>`Dado el vector <strong>A = (${d.ax}, ${d.ay})</strong>, calcula su m√≥dulo.`,
       chips:d=>[['Ax',d.ax,''],['Ay',d.ay,'']],
       answer:d=>Math.sqrt(d.ax*d.ax+d.ay*d.ay), unit:'', tol:0.01,
       steps:d=>{const r=Math.sqrt(d.ax*d.ax+d.ay*d.ay).toFixed(4);return[
         {t:'Componentes del vector.',m:`Ax = ${d.ax}   |   Ay = ${d.ay}`},
         {t:'F√≥rmula del m√≥dulo (Teorema de Pit√°goras).',m:'|A| = ‚àö(Ax¬≤ + Ay¬≤)'},
         {t:'Eleva cada componente al cuadrado.',m:`Ax¬≤ = ${d.ax*d.ax}   |   Ay¬≤ = ${d.ay*d.ay}`},
         {t:'Suma y aplica ra√≠z cuadrada.',m:`|A| = ‚àö(${d.ax*d.ax}+${d.ay*d.ay}) = ‚àö${d.ax*d.ax+d.ay*d.ay} = ${r}`}]},
       hints:['F√≥rmula: **|A| = ‚àö(Ax¬≤ + Ay¬≤)**. Eleva al cuadrado cada componente, suma y extrae ‚àö.',
              'Primero {ax}¬≤ = ?  y  {ay}¬≤ = ?  S√∫malos y aplica ra√≠z cuadrada.',
              'Soluci√≥n: |A| = ‚àö({ax2}+{ay2}) = {r}']},
      {id:'veb2',title:'Suma de vectores',
       concept:'Para sumar vectores 2D, suma las componentes x con x, y las componentes y con y. El m√≥dulo del vector resultante se calcula con Pit√°goras.',
       formula:'|A+B| = ‚àö((Ax+Bx)¬≤ + (Ay+By)¬≤)',
       gen:()=>({ax:Math.round(Math.random()*8-2),ay:Math.round(Math.random()*8+1),bx:Math.round(Math.random()*6-1),by:Math.round(Math.random()*6+1)}),
       question:d=>`Dados A = (${d.ax}, ${d.ay}) y B = (${d.bx}, ${d.by}), calcula el m√≥dulo del vector resultante A + B.`,
       chips:d=>[['Ax',d.ax,''],['Ay',d.ay,''],['Bx',d.bx,''],['By',d.by,'']],
       answer:d=>{const rx=d.ax+d.bx,ry=d.ay+d.by;return Math.sqrt(rx*rx+ry*ry)}, unit:'', tol:0.01,
       steps:d=>{const rx=d.ax+d.bx,ry=d.ay+d.by;const r=Math.sqrt(rx*rx+ry*ry).toFixed(4);return[
         {t:'Suma las componentes x.',m:`Rx = ${d.ax}+${d.bx} = ${rx}`},
         {t:'Suma las componentes y.',m:`Ry = ${d.ay}+${d.by} = ${ry}`},
         {t:'Aplica Pit√°goras al vector resultante.',m:`|R| = ‚àö(${rx}¬≤+${ry}¬≤) = ‚àö(${rx*rx}+${ry*ry})`},
         {t:'Resultado.',m:`|R| = ${r}`}]},
       hints:['Suma x con x y y con y. Luego **|R| = ‚àö(Rx¬≤+Ry¬≤)**.',
              'Rx = {ax}+{bx},  Ry = {ay}+{by}.  Ahora aplica Pit√°goras.',
              'Soluci√≥n: |R| = {r}']},
    ],
    intermediate:[
      {id:'vei1',title:'Producto punto y √°ngulo',
       concept:'El producto punto A¬∑B = Ax¬∑Bx + Ay¬∑By. Si es 0, los vectores son perpendiculares. El √°ngulo entre vectores usa arccos.',
       formula:'A¬∑B = Ax¬∑Bx+Ay¬∑By   ‚Üí   Œ∏ = arccos(A¬∑B / |A|¬∑|B|)',
       gen:()=>({ax:Math.round(Math.random()*8-1),ay:Math.round(Math.random()*8+1),bx:Math.round(Math.random()*8-1),by:Math.round(Math.random()*6-2)}),
       question:d=>`Calcula el √°ngulo entre A = (${d.ax}, ${d.ay}) y B = (${d.bx}, ${d.by}). Da la respuesta en grados.`,
       chips:d=>[['Ax',d.ax,''],['Ay',d.ay,''],['Bx',d.bx,''],['By',d.by,'']],
       answer:d=>{const dot=d.ax*d.bx+d.ay*d.by;const ma=Math.sqrt(d.ax*d.ax+d.ay*d.ay);const mb=Math.sqrt(d.bx*d.bx+d.by*d.by);return ma&&mb?Math.acos(Math.max(-1,Math.min(1,dot/(ma*mb))))*180/Math.PI:0}, unit:'¬∞', tol:0.5,
       steps:d=>{const dot=d.ax*d.bx+d.ay*d.by;const ma=Math.sqrt(d.ax*d.ax+d.ay*d.ay);const mb=Math.sqrt(d.bx*d.bx+d.by*d.by);const ang=(Math.acos(Math.max(-1,Math.min(1,dot/(ma*mb))))*180/Math.PI).toFixed(2);return[
         {t:'Calcula el producto punto.',m:`A¬∑B = ${d.ax}¬∑${d.bx}+${d.ay}¬∑${d.by} = ${dot}`},
         {t:'M√≥dulo de A.',m:`|A| = ‚àö(${d.ax}¬≤+${d.ay}¬≤) = ${ma.toFixed(3)}`},
         {t:'M√≥dulo de B.',m:`|B| = ‚àö(${d.bx}¬≤+${d.by}¬≤) = ${mb.toFixed(3)}`},
         {t:'Aplica la f√≥rmula del √°ngulo.',m:`cos(Œ∏) = ${dot}/(${ma.toFixed(3)}√ó${mb.toFixed(3)}) = ${(dot/(ma*mb)).toFixed(4)}`},
         {t:'Aplica arccos en tu calculadora.',m:`Œ∏ = arccos(${(dot/(ma*mb)).toFixed(4)}) = ${ang}¬∞`}]},
       hints:['Paso 1: A¬∑B = Ax¬∑Bx+Ay¬∑By.  Paso 2: |A| e |B| con Pit√°goras.  Paso 3: Œ∏ = arccos(A¬∑B / |A||B|).',
              'Calcula primero el producto punto. Luego los m√≥dulos. Por √∫ltimo arccos.',
              'Soluci√≥n: Œ∏ = {r}¬∞']},
    ],
    advanced:[
      {id:'vea1',title:'Descomposici√≥n de una fuerza',
       concept:'Una fuerza aplicada con √°ngulo Œ∏ se descompone en componente horizontal (coseno) y vertical (seno). Esto permite analizar el efecto de cada direcci√≥n por separado.',
       formula:'Fx = F¬∑cos(Œ∏),   Fy = F¬∑sin(Œ∏)',
       gen:()=>({f:Math.round(Math.random()*80+20),theta:Math.round(Math.random()*70+10)}),
       question:d=>`Una fuerza de <strong>${d.f} N</strong> se aplica a <strong>${d.theta}¬∞</strong> sobre la horizontal. Calcula la componente horizontal Fx.`,
       chips:d=>[['F',d.f,'N'],['Œ∏',d.theta,'¬∞']],
       answer:d=>d.f*Math.cos(d.theta*Math.PI/180), unit:'N', tol:0.02,
       steps:d=>{const rad=d.theta*Math.PI/180;const fx=(d.f*Math.cos(rad)).toFixed(3);const fy=(d.f*Math.sin(rad)).toFixed(3);return[
         {t:'Datos del problema.',m:`F=${d.f} N   |   Œ∏=${d.theta}¬∞`},
         {t:'Componente horizontal usa coseno.',m:`Fx = F¬∑cos(Œ∏) = ${d.f}¬∑cos(${d.theta}¬∞)`},
         {t:'Calcula cos(${d.theta}¬∞) en tu calculadora.',m:`cos(${d.theta}¬∞) ‚âà ${Math.cos(rad).toFixed(4)}`},
         {t:'Multiplica.',m:`Fx = ${d.f} √ó ${Math.cos(rad).toFixed(4)} = ${fx} N`},
         {t:'La componente vertical ser√≠a Fy = F¬∑sin(Œ∏).',m:`Fy = ${d.f}¬∑sin(${d.theta}¬∞) = ${fy} N`}]},
       hints:['Para la componente horizontal: **Fx = F¬∑cos(Œ∏)**. La vertical ser√≠a Fy = F¬∑sin(Œ∏).',
              'Fx = {f}¬∑cos({theta}¬∞). Calcula el coseno del √°ngulo en tu calculadora y multiplica por {f}.',
              'Soluci√≥n: Fx = {f}¬∑cos({theta}¬∞) = {r} N']},
    ]
  }},
  algebra:{label:'√Ålgebra',icon:'=',levels:{
    basic:[
      {id:'ab1',title:'Ecuaci√≥n lineal',
       concept:'Para resolver ax+b=c, el objetivo es despejar x. Se hace pasando b al otro lado (restando) y luego dividiendo entre a.',
       formula:'ax + b = c   ‚Üí   x = (c ‚àí b) / a',
       gen:()=>{const a=Math.round(Math.random()*7+1);const x=Math.round(Math.random()*10-3);const b=Math.round(Math.random()*8);return{a,b,c:a*x+b}},
       question:d=>`Resuelve la ecuaci√≥n: <strong>${d.a}x + ${d.b} = ${d.c}</strong>`,
       chips:d=>[['a',d.a,''],['b',d.b,''],['c',d.c,'']],
       answer:d=>(d.c-d.b)/d.a, unit:'', tol:0.01,
       steps:d=>{const cb=d.c-d.b;const r=((d.c-d.b)/d.a).toFixed(4);return[
         {t:'Ecuaci√≥n original.',m:`${d.a}x + ${d.b} = ${d.c}`},
         {t:'Pasa b al otro lado (resta ${d.b} en ambos miembros).',m:`${d.a}x = ${d.c} ‚àí ${d.b} = ${cb}`},
         {t:'Despeja x dividiendo entre a.',m:`x = ${cb} / ${d.a}`},
         {t:'Resultado.',m:`x = ${r}`},
         {t:'Verificaci√≥n: sustituye x en la ecuaci√≥n.',m:`${d.a}¬∑(${r}) + ${d.b} = ${(d.a*parseFloat(r)+d.b).toFixed(2)} ‚úì`}]},
       hints:['Para despejar x: **primero mueve b** (r√©stalo a ambos lados), **luego divide entre a**.',
              'Paso 1: ${d.a}x = {c}‚àí{b} = ?   Paso 2: divide ese resultado entre {a}.',
              'Soluci√≥n: x = ({c}‚àí{b})/{a} = {r}']},
      {id:'ab2',title:'Ecuaci√≥n con fracci√≥n',
       concept:'Una ecuaci√≥n como x/a = b se resuelve multiplicando ambos lados por el denominador para eliminar la fracci√≥n.',
       formula:'x/a = b   ‚Üí   x = b ¬∑ a',
       gen:()=>{const a=Math.round(Math.random()*6+2);const x=Math.round(Math.random()*20+4);return{a,b:x/a,x}},
       question:d=>`Resuelve: <strong>x / ${d.a} = ${d.b}</strong>`,
       chips:d=>[['denominador',d.a,''],['resultado',d.b,'']],
       answer:d=>d.x, unit:'', tol:0.01,
       steps:d=>[
         {t:'Ecuaci√≥n original.',m:`x / ${d.a} = ${d.b}`},
         {t:'Multiplica ambos lados por el denominador.',m:`x = ${d.b} √ó ${d.a}`},
         {t:'Resultado.',m:`x = ${d.x}`},
         {t:'Verificaci√≥n.',m:`${d.x} / ${d.a} = ${d.b} ‚úì`}],
       hints:['Para eliminar la fracci√≥n **multiplica ambos lados por el denominador** (por {a}).',
              'x = {b} √ó {a}. Multiplica directamente.',
              'Soluci√≥n: x = {b}√ó{a} = {r}']},
    ],
    intermediate:[
      {id:'ai1',title:'Ecuaci√≥n cuadr√°tica',
       concept:'La f√≥rmula general resuelve ax¬≤+bx+c=0. El discriminante Œî=b¬≤‚àí4ac determina cu√°ntas soluciones reales existen: si Œî<0 no hay soluciones reales.',
       formula:'x = (‚àíb ¬± ‚àö(b¬≤‚àí4ac)) / 2a',
       gen:()=>{const x1=Math.round(Math.random()*8-3);const x2=Math.round(Math.random()*8-1);const a=1,b=-(x1+x2),c=x1*x2;return{a,b,c,_x1:Math.max(x1,x2),_x2:Math.min(x1,x2)}},
       question:d=>`Resuelve: <strong>x¬≤ + (${d.b})x + ${d.c} = 0</strong>. Da la ra√≠z mayor.`,
       chips:d=>[['a',d.a,''],['b',d.b,''],['c',d.c,'']],
       answer:d=>d._x1, unit:'', tol:0.01,
       steps:d=>{const disc=d.b*d.b-4*d.a*d.c;const sqd=Math.sqrt(disc).toFixed(4);return[
         {t:'Identifica a, b y c.',m:`a=${d.a}   b=${d.b}   c=${d.c}`},
         {t:'Calcula el discriminante.',m:`Œî = b¬≤‚àí4ac = (${d.b})¬≤‚àí4¬∑${d.a}¬∑${d.c} = ${d.b*d.b}‚àí${4*d.a*d.c} = ${disc}`},
         {t:'Œî>0 ‚Üí dos soluciones reales. Calcula ‚àöŒî.',m:`‚àö${disc} = ${sqd}`},
         {t:'Primera ra√≠z (mayor).',m:`x‚ÇÅ = (‚àí(${d.b})+${sqd}) / 2 = ${d._x1}`},
         {t:'Segunda ra√≠z.',m:`x‚ÇÇ = (‚àí(${d.b})‚àí${sqd}) / 2 = ${d._x2}`}]},
       hints:['F√≥rmula: **x=(‚àíb¬±‚àö(b¬≤‚àí4ac))/2a**. Empieza calculando el discriminante Œî=b¬≤‚àí4ac.',
              'Œî = ({b})¬≤‚àí4¬∑{a}¬∑{c}. Calcula ese n√∫mero. Si Œî‚â•0 hay soluciones reales.',
              'Soluci√≥n: ra√≠z mayor = {r}']},
    ],
    advanced:[
      {id:'aa1',title:'Sistema 2√ó2 ‚Äî Regla de Cramer',
       concept:'La Regla de Cramer resuelve sistemas usando determinantes. El determinante principal D=a‚ÇÅb‚ÇÇ‚àía‚ÇÇb‚ÇÅ no puede ser cero (si D=0, el sistema no tiene soluci√≥n √∫nica).',
       formula:'D=a‚ÇÅb‚ÇÇ‚àía‚ÇÇb‚ÇÅ,  x=Dx/D,  y=Dy/D',
       gen:()=>{const x=Math.round(Math.random()*8-2);const y=Math.round(Math.random()*8-2);const a1=Math.round(Math.random()*4+1);const b1=Math.round(Math.random()*4-1)||1;const a2=Math.round(Math.random()*3+1);const b2=Math.round(Math.random()*4-2)||(-1);return{a1,b1,c1:a1*x+b1*y,a2,b2,c2:a2*x+b2*y,_x:x,_y:y}},
       question:d=>`Resuelve el sistema:\n<strong>${d.a1}x + ${d.b1}y = ${d.c1}</strong>\n<strong>${d.a2}x + ${d.b2}y = ${d.c2}</strong>\nDa el valor de x.`,
       chips:d=>[['a‚ÇÅ',d.a1,''],['b‚ÇÅ',d.b1,''],['c‚ÇÅ',d.c1,''],['a‚ÇÇ',d.a2,''],['b‚ÇÇ',d.b2,''],['c‚ÇÇ',d.c2,'']],
       answer:d=>d._x, unit:'', tol:0.01,
       steps:d=>{const det=d.a1*d.b2-d.a2*d.b1;const dx=d.c1*d.b2-d.c2*d.b1;const dy=d.a1*d.c2-d.a2*d.c1;return[
         {t:'Sistema de ecuaciones.',m:`${d.a1}x+${d.b1}y=${d.c1}   /   ${d.a2}x+${d.b2}y=${d.c2}`},
         {t:'Determinante principal D = a‚ÇÅb‚ÇÇ ‚àí a‚ÇÇb‚ÇÅ.',m:`D = ${d.a1}¬∑${d.b2}‚àí${d.a2}¬∑${d.b1} = ${det}`},
         {t:'Determinante Dx (reemplaza columna x por los resultados).',m:`Dx = ${d.c1}¬∑${d.b2}‚àí${d.c2}¬∑${d.b1} = ${dx}`},
         {t:'x = Dx / D.',m:`x = ${dx}/${det} = ${d._x}`},
         {t:'Determinante Dy y valor de y.',m:`Dy = ${d.a1}¬∑${d.c2}‚àí${d.a2}¬∑${d.c1} = ${dy}   ‚Üí   y=${dy}/${det}=${d._y}`}]},
       hints:['**Cramer**: calcula D=a‚ÇÅb‚ÇÇ‚àía‚ÇÇb‚ÇÅ. Luego Dx reemplazando la columna de x por [c‚ÇÅ,c‚ÇÇ]. x=Dx/D.',
              'D = {a1}¬∑{b2}‚àí{a2}¬∑{b1}.  Dx = {c1}¬∑{b2}‚àí{c2}¬∑{b1}.  x = Dx/D.',
              'Soluci√≥n: x = {r}']},
    ]
  }},
  force:{label:'Fuerzas',icon:'F',levels:{
    basic:[
      {id:'fb1',title:'Segunda Ley de Newton',
       concept:'La Segunda Ley de Newton dice que la fuerza neta sobre un objeto es igual a su masa multiplicada por su aceleraci√≥n. Es la ley fundamental de la din√°mica.',
       formula:'F = m ¬∑ a',
       gen:()=>({m:Math.round(Math.random()*40+2),a:parseFloat((Math.random()*15+0.5).toFixed(1))}),
       question:d=>`Un objeto de <strong>${d.m} kg</strong> tiene una aceleraci√≥n de <strong>${d.a} m/s¬≤</strong>. ¬øCu√°l es la fuerza neta que act√∫a sobre √©l?`,
       chips:d=>[['m',d.m,'kg'],['a',d.a,'m/s¬≤']],
       answer:d=>d.m*d.a, unit:'N', tol:0.01,
       steps:d=>{const r=(d.m*d.a).toFixed(2);return[
         {t:'Datos del problema.',m:`m=${d.m} kg   |   a=${d.a} m/s¬≤`},
         {t:'Segunda Ley de Newton.',m:'F = m ¬∑ a'},
         {t:'Sustituye y multiplica.',m:`F = ${d.m} √ó ${d.a} = ${r} N`}]},
       hints:['Segunda Ley de Newton: **F = m ¬∑ a**. Solo multiplica masa por aceleraci√≥n.',
              'F = {m} √ó {a}. Multiplica los dos valores directamente.',
              'Soluci√≥n: F = {m}√ó{a} = {r} N']},
    ],
    intermediate:[
      {id:'fi1',title:'Plano inclinado ‚Äî Aceleraci√≥n',
       concept:'En un plano inclinado sin fricci√≥n, la componente del peso paralela al plano causa la aceleraci√≥n. La masa se cancela en la ecuaci√≥n final.',
       formula:'a = g ¬∑ sin(Œ∏)',
       gen:()=>({theta:Math.round(Math.random()*55+10),m:Math.round(Math.random()*15+2)}),
       question:d=>`Un bloque de <strong>${d.m} kg</strong> reposa en un plano inclinado a <strong>${d.theta}¬∞</strong> (sin fricci√≥n). ¬øCu√°l es su aceleraci√≥n al soltarlo? (g = 9.8 m/s¬≤)`,
       chips:d=>[['Œ∏',d.theta,'¬∞'],['m',d.m,'kg'],['g','9.8','m/s¬≤']],
       answer:d=>9.8*Math.sin(d.theta*Math.PI/180), unit:'m/s¬≤', tol:0.02,
       steps:d=>{const rad=d.theta*Math.PI/180;const a=(9.8*Math.sin(rad)).toFixed(3);return[
         {t:'Componente del peso paralela al plano produce la aceleraci√≥n.',m:'Fp = m¬∑g¬∑sin(Œ∏)'},
         {t:'Por 2¬™ Ley (F=ma), la masa se cancela.',m:'a = g ¬∑ sin(Œ∏)'},
         {t:`Calcula sin(${d.theta}¬∞) en tu calculadora.`,m:`sin(${d.theta}¬∞) ‚âà ${Math.sin(rad).toFixed(4)}`},
         {t:'Resultado.',m:`a = 9.8 √ó ${Math.sin(rad).toFixed(4)} = ${a} m/s¬≤`}]},
       hints:['Sin fricci√≥n: **a = g¬∑sin(Œ∏)**. La masa NO importa ‚Äî se cancela.',
              'a = 9.8 √ó sin({theta}¬∞). Calcula el seno del √°ngulo y multiplica por 9.8.',
              'Soluci√≥n: a = 9.8√ósin({theta}¬∞) = {r} m/s¬≤']},
    ],
    advanced:[
      {id:'fa1',title:'Plano inclinado con fricci√≥n',
       concept:'Con fricci√≥n, la fuerza de rozamiento fr=ŒºN se opone al movimiento. La aceleraci√≥n neta combina la gravedad a favor y la fricci√≥n en contra.',
       formula:'a = g¬∑(sin Œ∏ ‚àí Œº¬∑cos Œ∏)',
       gen:()=>({theta:Math.round(Math.random()*45+20),mu:parseFloat((Math.random()*0.4+0.1).toFixed(2)),m:Math.round(Math.random()*10+2)}),
       question:d=>`Un bloque de <strong>${d.m} kg</strong> baja por un plano a <strong>${d.theta}¬∞</strong> con coeficiente de rozamiento <strong>Œº = ${d.mu}</strong>. ¬øCu√°l es su aceleraci√≥n? (g = 9.8 m/s¬≤)`,
       chips:d=>[['Œ∏',d.theta,'¬∞'],['Œº',d.mu,''],['m',d.m,'kg'],['g','9.8','m/s¬≤']],
       answer:d=>9.8*(Math.sin(d.theta*Math.PI/180)-d.mu*Math.cos(d.theta*Math.PI/180)), unit:'m/s¬≤', tol:0.02,
       steps:d=>{const rad=d.theta*Math.PI/180;const gp=(9.8*Math.sin(rad)).toFixed(3);const fr=(d.mu*9.8*Math.cos(rad)).toFixed(3);const a=(9.8*(Math.sin(rad)-d.mu*Math.cos(rad))).toFixed(3);return[
         {t:'Datos.',m:`Œ∏=${d.theta}¬∞   Œº=${d.mu}   g=9.8 m/s¬≤`},
         {t:'Fuerza neta paralela al plano (gravedad ‚àí fricci√≥n).',m:'a = g¬∑sin(Œ∏) ‚àí Œº¬∑g¬∑cos(Œ∏)'},
         {t:'Calcula g¬∑sin(Œ∏).',m:`9.8√ósin(${d.theta}¬∞) = ${gp} m/s¬≤`},
         {t:'Calcula Œº¬∑g¬∑cos(Œ∏).',m:`${d.mu}√ó9.8√ócos(${d.theta}¬∞) = ${fr} m/s¬≤`},
         {t:'Resta (si a<0, la fricci√≥n es mayor que la gravedad y el bloque no se mueve).',m:`a = ${gp}‚àí${fr} = ${a} m/s¬≤`}]},
       hints:['F√≥rmula: **a = g¬∑(sinŒ∏ ‚àí Œº¬∑cosŒ∏)**. Calcula cada t√©rmino por separado y r√©stalos.',
              'T√©rmino 1: g¬∑sin({theta}¬∞).  T√©rmino 2: {mu}¬∑g¬∑cos({theta}¬∞).  Resta el 2 del 1.',
              'Soluci√≥n: a = g(sin{theta}¬∞‚àí{mu}¬∑cos{theta}¬∞) = {r} m/s¬≤']},
    ]
  }}
};

// ================================================================
// ADAPTIVE ENGINE
// ================================================================
const Adaptive={
  score(hist,topic,lv){
    const r=hist.filter(h=>h.topic===topic&&h.lv===lv);
    if(!r.length)return 50;
    const l=r.slice(-10);
    const acc=l.filter(h=>h.ok).length/l.length;
    const att=l.reduce((s,h)=>s+h.att,0)/l.length;
    const tim=l.reduce((s,h)=>s+h.sec,0)/l.length;
    return Math.round((acc*.6+Math.max(0,1-(att-1)*.25)*.25+Math.max(0,1-tim/120)*.15)*100);
  },
  rec(score,lv){
    const ls=['basic','intermediate','advanced'];const i=ls.indexOf(lv);
    if(score>=80&&i<2)return{act:'up',to:ls[i+1]};
    if(score<=35&&i>0)return{act:'down',to:ls[i-1]};
    return{act:'keep',to:lv};
  },
  msg(score,rec,n){
    if(n<3)return`Completa ${3-n} ejercicio(s) m√°s para activar el ajuste.`;
    const nm={basic:'B√°sico',intermediate:'Intermedio',advanced:'Avanzado'};
    if(rec.act==='up')return`<strong>¬°Muy bien!</strong> Score ${score}/100 ‚Äî el sistema sugiere pasar a <strong>${nm[rec.to]}</strong>.`;
    if(rec.act==='down')return`Score ${score}/100 ‚Äî te recomendamos reforzar en <strong>${nm[rec.to]}</strong>.`;
    return`Score ${score}/100 ‚Äî vas bien, sigue en este nivel.`;
  }
};

// ================================================================
// PROGRESS
// ================================================================
const Prog={
  K:'calcDid_v2',
  load(){try{return JSON.parse(localStorage.getItem(this.K))||[]}catch{return[]}},
  add(e){const h=this.load();h.push({...e,ts:Date.now()});localStorage.setItem(this.K,JSON.stringify(h));return h},
  stats(hist,topic,lv){
    const r=hist.filter(h=>h.topic===topic&&h.lv===lv);
    if(!r.length)return null;
    return{acc:(r.filter(h=>h.ok).length/r.length*100).toFixed(0),att:(r.reduce((s,h)=>s+h.att,0)/r.length).toFixed(1),sec:(r.reduce((s,h)=>s+h.sec,0)/r.length).toFixed(0),n:r.length};
  },
  clear(){localStorage.removeItem(this.K)}
};

// ================================================================
// STATE
// ================================================================
let S={lv:'basic',topic:'velocity',idx:0,data:null,ans:null,hints:0,att:0,t0:null,hist:Prog.load(),vars:{}};

// ================================================================
// UI HELPERS
// ================================================================
function toast(m,d=3200){const el=document.getElementById('toast');el.textContent=m;el.classList.add('on');setTimeout(()=>el.classList.remove('on'),d)}

function setLv(lv){S.lv=lv;S.idx=0;document.querySelectorAll('.lv').forEach(b=>b.classList.toggle('on',b.dataset.lv===lv));renderEx();updateUI()}

function setTopic(tp){S.topic=tp;S.idx=0;document.querySelectorAll('.ti').forEach(b=>b.classList.toggle('on',b.dataset.tp===tp));renderEx();updateUI()}

function getEx(){const list=DB[S.topic]?.levels[S.lv];return list?list[S.idx%list.length]:null}

// ================================================================
// RENDER TOPICS
// ================================================================
function renderTopics(){
  const el=document.getElementById('tList');el.innerHTML='';
  Object.entries(DB).forEach(([k,v])=>{
    const d=document.createElement('div');d.className='ti'+(k===S.topic?' on':'');
    d.dataset.tp=k;d.onclick=()=>setTopic(k);d.setAttribute('role','button');d.setAttribute('tabindex','0');
    d.setAttribute('aria-label',`Tema: ${v.label}`);
    d.innerHTML=`<span style="width:20px;text-align:center">${v.icon}</span>${v.label}`;
    d.onkeydown=e=>e.key==='Enter'&&setTopic(k);
    el.appendChild(d);
  });
}

// ================================================================
// RENDER EXERCISE
// ================================================================
function renderEx(){
  const ex=getEx();const mc=document.getElementById('main');
  S.hints=0;S.att=0;S.t0=Date.now();
  if(!ex){mc.innerHTML=`<div class="panel" style="text-align:center;padding:40px"><p style="color:var(--cd)">No hay ejercicios para este nivel.</p></div>`;return}

  const vk=`${S.topic}_${S.lv}_${ex.id}`;
  if(!S.vars[vk])S.vars[vk]=ex.gen();
  const d=S.vars[vk];
  S.data=d;S.ans=ex.answer(d);

  const chips=ex.chips(d).map(([k,v,u])=>`<div class="chip">${k} <span>= ${typeof v==='number'?(Number.isInteger(v)?v:parseFloat(v.toFixed(3))):v}${u?' '+u:''}</span></div>`).join('');

  mc.innerHTML=`
    <div class="lcard">
      <h2>üìñ ${ex.title}</h2>
      <div class="cpt">${ex.concept}</div>
      <div class="fbox">F√≥rmula: ${ex.formula}</div>
    </div>
    <div class="pcard">
      <div class="plbl">‚óâ Ejercicio ¬∑ ${S.lv==='basic'?'B√°sico':S.lv==='intermediate'?'Intermedio':'Avanzado'}</div>
      <div class="pq">${ex.question(d)}</div>
      <div class="chips">
        <div class="clbl">Datos del problema:</div>
        ${chips}
      </div>
      <div class="az">
        <div class="albl">‚úèÔ∏è Resu√©lvelo en papel ‚Äî escribe tu resultado aqu√≠</div>
        <div class="ar">
          <input type="number" id="ai" class="ai" placeholder="Tu respuesta..." step="any" autocomplete="off"
                 aria-label="Tu respuesta" onkeydown="if(event.key==='Enter')check()">
          ${ex.unit?`<span class="au">${ex.unit}</span>`:''}
          <button class="btn bp" onclick="check()" aria-label="Verificar respuesta">‚Üµ Verificar</button>
        </div>
        <div class="asub">Usa la f√≥rmula de arriba y papel. Cuando tengas el resultado, escr√≠belo y presiona Verificar.</div>
      </div>
      <div class="arow">
        <button class="btn bh" id="bh1" onclick="showHint(1)" aria-label="Pista 1">üí° Pista 1</button>
        <button class="btn bh" id="bh2" onclick="showHint(2)" disabled aria-label="Pista 2">üîç Pista 2</button>
        <button class="btn bh" id="bh3" onclick="showHint(3)" disabled aria-label="Ver respuesta directa">‚úÖ Ver respuesta</button>
        <button class="btn bs" onclick="toggleSteps()" id="btnSt" aria-label="Ver soluci√≥n paso a paso">üìê Ver pasos</button>
      </div>
      <div class="hb" id="hb1"><div class="hl">Pista 1 ‚Äî Estrategia y f√≥rmula</div><span id="h1t"></span></div>
      <div class="hb" id="hb2"><div class="hl">Pista 2 ‚Äî C√≥mo sustituir los valores</div><span id="h2t"></span></div>
      <div class="hb" id="hb3"><div class="hl">Respuesta directa</div><span id="h3t"></span></div>
      <div class="fb" id="fbx">
        <div class="fbt" id="fbt"></div>
        <div class="fbm" id="fbm"></div>
      </div>
      <div class="stps" id="stps">
        <h4>üìê Procedimiento completo ‚Äî as√≠ se resuelve paso a paso</h4>
        <div id="stpsC"></div>
        <div class="ar2">Respuesta esperada: <strong id="ansReveal"></strong></div>
      </div>
      <div class="sug" id="sugB"><strong>üéØ Sistema Adaptativo</strong><span id="sugT"></span></div>
      <div class="arow" style="margin-top:14px">
        <button class="btn bn" onclick="newVariant()" aria-label="Nuevo ejercicio similar">‚Ü∫ Otro similar</button>
        <button class="btn bg" onclick="nextEx()" aria-label="Siguiente ejercicio">‚Üí Siguiente</button>
      </div>
    </div>
    <div class="plot" id="plotA"><h3>üìä Visualizaci√≥n</h3><div id="pC"></div></div>
  `;

  renderStepsContent(ex,d);
  document.getElementById('ansReveal').textContent=`${S.ans.toFixed(4)} ${ex.unit||''}`;
  document.getElementById('ai').focus();
}

// ================================================================
// VERIFICAR RESPUESTA
// ================================================================
function check(){
  const ex=getEx();if(!ex)return;
  const inp=document.getElementById('ai');
  const val=parseFloat(inp.value);
  if(isNaN(val)){toast('Escribe un n√∫mero como respuesta.');inp.focus();return}
  S.att++;
  const correct=Math.abs(val-S.ans)/(Math.abs(S.ans)||1)<ex.tol;
  const fb=document.getElementById('fbx');
  if(correct){
    inp.className='ai ok';
    fb.className='fb show ok';
    document.getElementById('fbt').textContent=`‚úì ¬°Correcto! Resuelto en ${S.att} intento(s).`;
    document.getElementById('fbm').textContent=`Tu respuesta ${val} ${ex.unit||''} es correcta.`;
    const sec=Math.round((Date.now()-S.t0)/1000);
    S.hist=Prog.add({topic:S.topic,lv:S.lv,id:ex.id,ok:true,att:S.att,sec});
    updateUI();updateAdaptive();addHist(true,ex.title,S.att);
    // Muestra pasos autom√°ticamente al acertar (refuerzo del aprendizaje)
    document.getElementById('stps').classList.add('show');
    document.getElementById('btnSt').textContent='üìê Ocultar pasos';
    if(ex.hasPlot)renderPlot(ex,S.data);
  }else{
    inp.className='ai no';
    fb.className='fb show no';
    const pct=(Math.abs(val-S.ans)/(Math.abs(S.ans)||1)*100).toFixed(1);
    document.getElementById('fbt').textContent=`‚úó No es correcto. Intento ${S.att}.`;
    document.getElementById('fbm').textContent=`Tu respuesta est√° ${pct}% alejada del valor esperado. Revisa el procedimiento.`;
    const sec=Math.round((Date.now()-S.t0)/1000);
    S.hist=Prog.add({topic:S.topic,lv:S.lv,id:ex.id,ok:false,att:S.att,sec});
    updateUI();addHist(false,ex.title,S.att);
    // Pistas autom√°ticas progresivas
    if(S.att===1)showHint(1);
    else if(S.att===2)showHint(2);
    else if(S.att>=3)showHint(3);
    inp.select();
  }
}

// ================================================================
// PISTAS
// ================================================================
function showHint(n){
  const ex=getEx();if(!ex)return;
  S.hints=Math.max(S.hints,n);
  const d=S.data,r=S.ans;
  function fmt(h){
    return h.replace(/\{(\w+)\}/g,(_,k)=>{
      if(k==='r')return r!==null?r.toFixed(4):'?';
      if(k==='theta2'&&d.theta)return d.theta*2;
      if(k==='ax2'&&d.ax!==undefined)return d.ax*d.ax;
      if(k==='ay2'&&d.ay!==undefined)return d.ay*d.ay;
      if(k==='dir'&&d.dir)return d.dir;
      return d[k]!==undefined?d[k]:k;
    }).replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
  }
  for(let i=1;i<=3;i++){
    const box=document.getElementById(`hb${i}`);
    const txt=document.getElementById(`h${i}t`);
    if(i<=S.hints&&ex.hints[i-1]){box.classList.add('show');txt.innerHTML=fmt(ex.hints[i-1])}
    const btn=document.getElementById(`bh${i}`);
    if(btn)btn.disabled=i>S.hints+1;
  }
  if(S.hints<3)document.getElementById(`bh${S.hints+1}`).disabled=false;
}

// ================================================================
// PASOS
// ================================================================
function renderStepsContent(ex,d){
  const steps=ex.steps(d);
  document.getElementById('stpsC').innerHTML=steps.map((s,i)=>`
    <div class="si">
      <div class="sn">${i+1}.</div>
      <div class="sb2">
        ${s.t?`<div class="st">${s.t}</div>`:''}
        ${s.m?`<div class="sm">${s.m}</div>`:''}
      </div>
    </div>`).join('');
}

function toggleSteps(){
  const p=document.getElementById('stps'),b=document.getElementById('btnSt');
  p.classList.toggle('show');
  b.textContent=p.classList.contains('show')?'üìê Ocultar pasos':'üìê Ver pasos';
}

// ================================================================
// PLOTLY
// ================================================================
function renderPlot(ex,d){
  const pa=document.getElementById('plotA');if(!pa)return;
  pa.classList.add('show');
  if(typeof Plotly==='undefined'){pa.innerHTML+='<p style="color:var(--cd);font-size:.85rem;margin-top:8px">Plotly no disponible (sin conexi√≥n).</p>';return}
  const g=9.8;let xs=[],ys=[];
  if(ex.id==='kb1'){
    const rad=d.theta*Math.PI/180;const vx=d.v0*Math.cos(rad);const vy=d.v0*Math.sin(rad);
    const T=2*vy/g;for(let i=0;i<=60;i++){const t=i/60*T;xs.push(vx*t);ys.push(vy*t-0.5*g*t*t)}
  }else if(ex.id==='ka1'){
    const T=Math.sqrt(2*d.h/g);for(let i=0;i<=60;i++){const t=i/60*T;xs.push(d.v0*t);ys.push(d.h-0.5*g*t*t)}
  }
  if(!xs.length)return;
  Plotly.newPlot('pC',[
    {x:xs,y:ys,type:'scatter',mode:'lines',line:{color:'#e6a817',width:2.5},name:'Trayectoria'},
    {x:[xs[0]],y:[ys[0]],type:'scatter',mode:'markers',marker:{color:'#3fb950',size:10},name:'Inicio'},
    {x:[xs[xs.length-1]],y:[ys[ys.length-1]],type:'scatter',mode:'markers',marker:{color:'#f85149',size:10,symbol:'x'},name:'Impacto'}
  ],{paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{color:'#b8a898',family:'JetBrains Mono'},margin:{t:10,r:10,b:40,l:50},xaxis:{title:'Distancia (m)',gridcolor:'#30363d'},yaxis:{title:'Altura (m)',gridcolor:'#30363d'},legend:{bgcolor:'rgba(0,0,0,0)'}},{responsive:true,displayModeBar:false});
}

// ================================================================
// HISTORY UI
// ================================================================
function addHist(ok,title,att){
  const l=document.getElementById('hList');const e=l.querySelector('p');if(e)e.remove();
  const it=document.createElement('div');it.className=`hi ${ok?'ok':'no'}`;
  it.innerHTML=`<div class="hd"></div><div class="htx">${title}</div><div class="hbg">${att} intento${att>1?'s':''}</div><div class="hbg" style="color:${ok?'var(--gn)':'var(--rd)'}">${ok?'‚úì':'‚úó'}</div>`;
  l.insertBefore(it,l.firstChild);while(l.children.length>20)l.removeChild(l.lastChild);
}

// ================================================================
// PROGRESS UI
// ================================================================
function updateUI(){
  const st=Prog.stats(S.hist,S.topic,S.lv);
  if(!st){['sAcc','sAtt','sTim'].forEach(id=>document.getElementById(id).textContent='‚Äî');document.getElementById('sSco').textContent='0';document.getElementById('mPct').textContent='0%';document.getElementById('mBar').style.width='0%';return}
  document.getElementById('sAcc').textContent=st.acc+'%';
  document.getElementById('sAtt').textContent=st.att;
  document.getElementById('sTim').textContent=st.sec+'s';
  const score=Adaptive.score(S.hist,S.topic,S.lv);
  document.getElementById('sSco').textContent=score;
  document.getElementById('mPct').textContent=score+'%';
  document.getElementById('mBar').style.width=score+'%';
}

function updateAdaptive(){
  const score=Adaptive.score(S.hist,S.topic,S.lv);
  const rec=Adaptive.rec(score,S.lv);
  const n=S.hist.filter(h=>h.topic===S.topic&&h.lv===S.lv).length;
  const m=Adaptive.msg(score,rec,n);
  document.getElementById('adSt').innerHTML=m;
  if(n>=3){const b=document.getElementById('sugB'),t=document.getElementById('sugT');if(b&&t){b.classList.add('show');t.textContent=m.replace(/<[^>]+>/g,'')}}
}

// ================================================================
// NAV
// ================================================================
function nextEx(){const list=DB[S.topic]?.levels[S.lv];if(!list)return;S.idx=(S.idx+1)%list.length;renderEx()}

function newVariant(){const ex=getEx();if(!ex)return;const vk=`${S.topic}_${S.lv}_${ex.id}`;S.vars[vk]=ex.gen();renderEx();toast('üîÑ Nuevos valores generados para el mismo ejercicio.')}

function clearAll(){if(!confirm('¬øBorrar todo el progreso?'))return;Prog.clear();S.hist=[];document.getElementById('hList').innerHTML='<p style="color:var(--cd);font-size:.85rem;">Sin actividad a√∫n.</p>';updateUI();toast('Progreso borrado.')}

// ================================================================
// INIT
// ================================================================
renderTopics();renderEx();updateUI();


// ================================================================
// BIBLIOTECA ‚Äî Datos de teor√≠a, ejemplos y actividades
// Estructura: BIBLIO[tema][nivel] = { teoria, formulas, ejemplo, actividades[], curiosidad }
// ================================================================

// ================================================================
// BIBLIOTECA EXTENDIDA ‚Äî 15 temas ¬∑ 3 niveles c/u
// ================================================================
const BIBLIO = {

  velocity:{label:'Velocidad',icon:'‚Üí',
    basic:{titulo:'¬øQu√© es la velocidad?',
      teoria:`La <strong>velocidad media</strong> mide cu√°n r√°pido se desplaza un objeto dividiendo distancia entre tiempo. En f√≠sica usamos m/s; en la vida diaria km/h. Distinci√≥n esencial: <strong>rapidez</strong> (escalar, solo magnitud) vs <strong>velocidad</strong> (vector, tiene direcci√≥n).<br><br>
      Si recorre distancias iguales en tiempos iguales, el movimiento es <strong>uniforme</strong> (MRU). Si la velocidad cambia, calculamos el promedio: vÃÑ = Œîx/Œît.`,
      formulas:['v = d / t','d = v ¬∑ t','t = d / v','1 km/h = 0.2778 m/s','1 m/s = 3.6 km/h'],
      ejemplo:{titulo:'Usain Bolt ‚Äî 100 m planos (Pek√≠n 2008)',
        texto:`Recorri√≥ 100 m en 9.58 s:<br><code>v = 100/9.58 ‚âà 10.44 m/s ‚âà 37.6 km/h</code><br>Un auto en ciudad va ~50 km/h = 13.9 m/s. La velocidad del sonido es 340 m/s ‚Äî Bolt corre al 3% de esa velocidad. La luz viaja 1,200,000 veces m√°s r√°pido que un avi√≥n comercial.`},
      actividades:[
        {texto:'Un autob√∫s recorre 240 km en 3 h. Calcula v en km/h y m/s.',datos:['d=240 km','t=3 h'],respuesta:'v=80 km/h ‚Üí 80√ó(1000/3600)=<strong>22.2 m/s</strong>'},
        {texto:'Un tren recorre 450 km a 150 km/h. ¬øCu√°ntas horas tarda?',datos:['d=450 km','v=150 km/h'],respuesta:'t=450/150=<strong>3 horas</strong>'},
        {texto:'Un caracol avanza 10 cm en 2 min. ¬øTiempo para cruzar 30 cm?',datos:['v=5 cm/min','d=30 cm'],respuesta:'t=30/5=<strong>6 minutos</strong>'}
      ],
      curiosidad:'La luz recorre ~300,000 km/s. En 1 segundo, un avi√≥n comercial solo avanza ~0.25 km. La luz es 1.2 millones de veces m√°s r√°pida que un avi√≥n de pasajeros.'},
    intermediate:{titulo:'Velocidad instant√°nea y relativa',
      teoria:`La <strong>velocidad instant√°nea</strong> es la derivada de la posici√≥n: v = dx/dt ‚Äî lo que indica el veloc√≠metro en cada momento.<br><br>
      <strong>Velocidad relativa:</strong> mismo sentido ‚Üí resta; sentidos opuestos ‚Üí suma.<br>
      <strong>Promedio en viaje de ida y vuelta:</strong> NO es la media aritm√©tica sino la media arm√≥nica: vÃÑ = 2v‚ÇÅv‚ÇÇ/(v‚ÇÅ+v‚ÇÇ). La velocidad m√°s lenta domina porque pasas m√°s tiempo en ella.`,
      formulas:["v_inst = dx/dt",'v_rel = |v‚ÇÅ‚àív‚ÇÇ| (mismo)','v_rel = v‚ÇÅ+v‚ÇÇ (opuestos)','vÃÑ(ida-vuelta) = 2v‚ÇÅv‚ÇÇ/(v‚ÇÅ+v‚ÇÇ)'],
      ejemplo:{titulo:'El error cl√°sico del promedio',
        texto:`Ida a 60 km/h, vuelta a 120 km/h. La gente dice 90 km/h ‚Äî <strong>incorrecto</strong>.<br>vÃÑ = 2√ó60√ó120/(60+120) = 14400/180 = <strong>80 km/h</strong>. La velocidad lenta domina porque tardas m√°s tiempo en ella.`},
      actividades:[
        {texto:'Tren B (110 km/h) persigue al A (80 km/h) que lleva 30 km de ventaja. ¬øEn cu√°nto lo alcanza?',datos:['v_rel=30 km/h','d=30 km'],respuesta:'t=30/30=<strong>1 hora</strong>'},
        {texto:'Avi√≥n: 600 km a 800 km/h de ida y vuelta a 600 km/h. Velocidad media del viaje completo.',datos:['v‚ÇÅ=800','v‚ÇÇ=600'],respuesta:'vÃÑ=2√ó800√ó600/1400=960000/1400‚âà<strong>685.7 km/h</strong>'}
      ],
      curiosidad:'El GPS compensa dos efectos relativistas: los sat√©lites (14,000 km/h) hacen que sus relojes corran 7 Œºs/d√≠a m√°s lento; la menor gravedad los hace correr 45 Œºs/d√≠a m√°s r√°pido. Neto: +38 Œºs/d√≠a ‚Üí sin correcci√≥n, error de ~11 km/d√≠a.'},
    advanced:{titulo:'Cinem√°tica vectorial y MRUA',
      teoria:`Las <strong>cuatro ecuaciones del MRUA</strong> (aceleraci√≥n constante) se derivan de integrar a=cte:<br>
      1) v=v‚ÇÄ+at  2) x=x‚ÇÄ+v‚ÇÄt+¬Ωat¬≤  3) v¬≤=v‚ÇÄ¬≤+2aŒîx  4) x=x‚ÇÄ+¬Ω(v‚ÇÄ+v)t<br><br>
      En movimiento circular: velocidad angular œâ=v/r, aceleraci√≥n centr√≠peta a_c=v¬≤/r=œâ¬≤r. En √≥rbita: v_orbital=‚àö(GM/r), velocidad de escape v_esc=‚àö(2GM/r).`,
      formulas:['v=v‚ÇÄ+at','x=x‚ÇÄ+v‚ÇÄt+¬Ωat¬≤','v¬≤=v‚ÇÄ¬≤+2aŒîx','v_esc=‚àö(2GM/R)','a_c=v¬≤/r=œâ¬≤r'],
      ejemplo:{titulo:'Frenado de emergencia ‚Äî distancia total',
        texto:`Auto a 100 km/h (27.8 m/s), a=‚àí8 m/s¬≤, tiempo de reacci√≥n 0.8 s:<br>d_reacci√≥n=27.8√ó0.8=22.2 m; d_frenado=27.8¬≤/16=48.3 m; <code>total=70.5 m</code>. A 120 km/h supera 110 m.`},
      actividades:[
        {texto:'Cohete: parte del reposo, alcanza 8 km/s en 120 s. Calcula a y distancia.',datos:['v‚ÇÄ=0','v=8000 m/s','t=120 s'],respuesta:'a=66.7 m/s¬≤‚âà6.8g; x=¬Ω√ó66.7√ó14400=<strong>480,240 m‚âà480 km</strong>'},
        {texto:'Auto frena de 90 km/h con a=‚àí6 m/s¬≤. ¬øTiempo y distancia?',datos:['v‚ÇÄ=25 m/s','a=‚àí6 m/s¬≤'],respuesta:'t=25/6‚âà<strong>4.17 s</strong>; d=25¬≤/12‚âà<strong>52.1 m</strong>'}
      ],
      curiosidad:'Velocidad de escape de la Tierra: 11.2 km/s. Del Sol: 617 km/s. Para un agujero negro la velocidad de escape supera la de la luz ‚Äî por eso nada puede salir de √©l.'}
  },

  kinematics:{label:'Cinem√°tica',icon:'‚ü≥',
    basic:{titulo:'Movimiento en 2D ‚Äî Tiro parab√≥lico',
      teoria:`Clave: horizontal y vertical son <strong>independientes</strong>. Horizontal: MRU (a=0), vx=v‚ÇÄcosŒ∏. Vertical: ca√≠da libre, vy‚ÇÄ=v‚ÇÄsinŒ∏, a=‚àíg. El mismo tiempo t aplica en ambos ejes. √Ångulo 45¬∞ maximiza el alcance en el vac√≠o.`,
      formulas:['R=v‚ÇÄ¬≤sin(2Œ∏)/g','H=v‚ÇÄ¬≤sin¬≤(Œ∏)/(2g)','T=2v‚ÇÄsin(Œ∏)/g','vx=v‚ÇÄcos(Œ∏)','vy(t)=v‚ÇÄsin(Œ∏)‚àígt'],
      ejemplo:{titulo:'Tiro libre en f√∫tbol a 28 m/s, 35¬∞',
        texto:`R=28¬≤sin70¬∞/9.8‚âà75.4 m; H=28¬≤sin¬≤35¬∞/(19.6)‚âà13.2 m; T‚âà3.28 s. En la Luna (g=1.62) el mismo tiro llegar√≠a a ‚âà456 m.`},
      actividades:[
        {texto:'Arquero dispara 40 m/s con 45¬∞. Alcance, H_max y tiempo.',datos:['v‚ÇÄ=40','Œ∏=45¬∞','g=9.8'],respuesta:'R‚âà<strong>163.3 m</strong>; H‚âà<strong>40.8 m</strong>; T‚âà<strong>5.77 s</strong>'},
        {texto:'Pelota a 20 m/s, 30¬∞. ¬øPasa sobre barrera de 2 m a 15 m de distancia?',datos:['x=15 m','Œ∏=30¬∞','v‚ÇÄ=20'],respuesta:'t=15/(20cos30¬∞)‚âà0.866 s; y=20sin30¬∞√ó0.866‚àí4.9√ó0.866¬≤‚âà<strong>4.98 m>2 m ‚úì</strong>'}
      ],
      curiosidad:'Galileo demostr√≥ en el siglo XVII que todos los proyectiles sin resistencia siguen par√°bolas, refutando 2000 a√±os de f√≠sica aristot√©lica.'},
    intermediate:{titulo:'Ecuaciones MRUA en 2D y ca√≠da libre',
      teoria:`Ca√≠da libre pura: h=¬Ωgt¬≤, v=gt, t=‚àö(2h/g).<br>Lanzamiento horizontal: eje X uniforme, eje Y en ca√≠da libre.<br>g var√≠a con latitud y altitud: Ecuador g‚âà9.78, polos g‚âà9.83, cima Everest g‚âà9.77 m/s¬≤.`,
      formulas:['h=¬Ωgt¬≤','t=‚àö(2h/g)','v_y=‚àö(2gh)','x(t)=v‚ÇÄt','v_imp=‚àö(vx¬≤+vy¬≤)'],
      ejemplo:{titulo:'Lanzamiento horizontal desde 80 m',
        texto:`v‚ÇÄ=15 m/s horiz.; t=‚àö(160/9.8)‚âà4.04 s; x=15√ó4.04‚âà60.6 m; vy=9.8√ó4.04‚âà39.6 m/s; v_imp‚âà42.4 m/s.`},
      actividades:[
        {texto:'Piedra desde puente 80 m a 15 m/s horizontal. ¬øD√≥nde cae y a qu√© velocidad?',datos:['h=80 m','v‚ÇÄ=15 m/s'],respuesta:'t‚âà4.04 s; x‚âà<strong>60.6 m</strong>; v_imp‚âà<strong>42.4 m/s</strong>'},
        {texto:'Objeto lanzado verticalmente a 25 m/s. ¬øAltura m√°xima y tiempo total?',datos:['v‚ÇÄ=25 m/s','g=9.8'],respuesta:'H=625/19.6‚âà<strong>31.9 m</strong>; T=2√ó25/9.8‚âà<strong>5.10 s</strong>'}
      ],
      curiosidad:'En 1971 el astronauta David Scott solt√≥ un martillo y una pluma en la Luna simult√°neamente. Ante millones de televidentes, ambos cayeron exactamente igual, comprobando experimentalmente que sin aire la masa no importa.'},
    advanced:{titulo:'Movimiento circular y centr√≠peto',
      teoria:`MCU: velocidad lineal constante pero direcci√≥n cambia ‚Üí aceleraci√≥n centr√≠peta a_c=v¬≤/r dirigida al centro.<br>Velocidad angular œâ (rad/s): œâ=2œÄf=2œÄ/T, v=œâr.<br>MCUA: œâ cambia con aceleraci√≥n angular Œ±; ecuaciones an√°logas a MRUA.`,
      formulas:['a_c=v¬≤/r=œâ¬≤r','œâ=2œÄ/T=2œÄf','v=œâr','œâ=œâ‚ÇÄ+Œ±t','Œ∏=œâ‚ÇÄt+¬ΩŒ±t¬≤'],
      ejemplo:{titulo:'Centr√≠fuga m√©dica a 12,000 rpm, r=10 cm',
        texto:`œâ=12000√ó2œÄ/60‚âà1257 rad/s; v=125.7 m/s; a_c=1257¬≤√ó0.1‚âà158,000 m/s¬≤‚âà16,100g. Separa componentes sangu√≠neos en minutos.`},
      actividades:[
        {texto:'Rueda r=0.4 m, 300 rpm. Calcula œâ, v tangencial y a_c.',datos:['r=0.4 m','n=300 rpm'],respuesta:'œâ‚âà<strong>31.4 rad/s</strong>; v‚âà<strong>12.57 m/s</strong>; a_c‚âà<strong>394.8 m/s¬≤‚âà40g</strong>'},
        {texto:'Sat√©lite geoestacionario (r=42,164 km, T=86,400 s). Velocidad orbital.',datos:['r=4.2164√ó10‚Å∑ m'],respuesta:'v=2œÄr/T=2œÄ√ó42164000/86400‚âà<strong>3,074 m/s‚âà11,066 km/h</strong>'}
      ],
      curiosidad:'Los pilotos de caza experimentan hasta 9g. A 5g sostenidos la sangre no llega al cerebro; los trajes anti-g comprimen piernas para contrarrestar esto.'}
  },

  vectors:{label:'Vectores',icon:'‚Üó',
    basic:{titulo:'Escalares vs vectores',
      teoria:`<strong>Escalar:</strong> solo magnitud (temperatura, masa, energ√≠a).<br><strong>Vector:</strong> magnitud + direcci√≥n (velocidad, fuerza, desplazamiento).<br><br>
      Representaci√≥n 2D: A=(Ax,Ay) cartesiano o |A|‚à†Œ∏ polar.<br>Conversi√≥n: Ax=|A|cosŒ∏, Ay=|A|sinŒ∏; |A|=‚àö(Ax¬≤+Ay¬≤), Œ∏=arctan(Ay/Ax).`,
      formulas:['|A|=‚àö(Ax¬≤+Ay¬≤)','Ax=|A|cosŒ∏','Ay=|A|sinŒ∏','Œ∏=arctan(Ay/Ax)','A+B=(Ax+Bx,Ay+By)'],
      ejemplo:{titulo:'Navegaci√≥n N45¬∞E a 20 nudos durante 3 horas',
        texto:`d=60 mn. Norte: 60cos45¬∞‚âà42.4 mn. Este: 60sin45¬∞‚âà42.4 mn. El GPS descompone as√≠ cada movimiento y los suma vectorialmente.`},
      actividades:[
        {texto:'Avi√≥n: 300 km Este, luego 400 km Norte. ¬øDistancia y rumbo desde origen?',datos:['dx=300','dy=400'],respuesta:'|d|=<strong>500 km</strong>; Œ∏=arctan(400/300)‚âà<strong>53.1¬∞</strong>'},
        {texto:'Fuerza F=50 N a 120¬∞. Descomp√≥n en Fx y Fy.',datos:['F=50','Œ∏=120¬∞'],respuesta:'Fx=50cos120¬∞=<strong>‚àí25 N</strong>; Fy=50sin120¬∞‚âà<strong>43.3 N</strong>'}
      ],
      curiosidad:'Los videojuegos modernos procesan 10‚Äì100 millones de operaciones vectoriales por segundo para f√≠sica, colisiones e iluminaci√≥n de cada fotograma.'},
    intermediate:{titulo:'Producto punto y producto cruz',
      teoria:`<strong>Producto punto:</strong> A¬∑B=AxBx+AyBy=|A||B|cosŒ∏ ‚Üí escalar. Mide proyecci√≥n. A¬∑B=0 ‚Üí perpendiculares.<br><strong>Producto cruz (3D):</strong> |A√óB|=|A||B|sinŒ∏ ‚Üí vector ‚ä• a ambos; m√≥dulo = √°rea del paralelogramo.<br>Aplicaciones: Trabajo W=F¬∑d¬∑cosŒ∏ (punto), Torque œÑ=r√óF (cruz).`,
      formulas:['A¬∑B=AxBx+AyBy','Œ∏=arccos(A¬∑B/|A||B|)','|A√óB|=|A||B|sinŒ∏','W=F¬∑d¬∑cosŒ∏','œÑ=r√óF'],
      ejemplo:{titulo:'Trabajo real al empujar una caja 6 m con F=80 N a 25¬∞',
        texto:`W=80√ó6√ócos25¬∞=480√ó0.906‚âà435 J. Si F fuera ‚ä• al movimiento: W=0. Por eso la fuerza normal no realiza trabajo.`},
      actividades:[
        {texto:'¬øSon perpendiculares A=(3,4) y B=(8,‚àí6)?',datos:['A=(3,4)','B=(8,‚àí6)'],respuesta:'A¬∑B=24‚àí24=<strong>0 ‚Üí S√≠, son perpendiculares (Œ∏=90¬∞)</strong>'},
        {texto:'√Ångulo entre A=(5,3) y B=(2,7).',datos:['A=(5,3)','B=(2,7)'],respuesta:'A¬∑B=31; |A|=‚àö34‚âà5.831; |B|=‚àö53‚âà7.28; Œ∏=arccos(31/42.45)‚âà<strong>43.1¬∞</strong>'}
      ],
      curiosidad:'Google Maps usa producto punto para proyectar tu ubicaci√≥n sobre la calle m√°s cercana. Las IAs de lenguaje comparan millones de "vectores de palabras" en espacios de miles de dimensiones usando este mismo producto.'},
    advanced:{titulo:'Equilibrio vectorial y √°lgebra lineal',
      teoria:`Equilibrio est√°tico: Œ£F=0 en x y en y; Œ£œÑ=0 rotacional.<br>Un conjunto de vectores es <strong>linealmente independiente</strong> si ninguno es combinaci√≥n lineal de los dem√°s ‚Äî base del espacio vectorial.<br>Teorema trabajo-energ√≠a: W_neto=ŒîK conecta vectores con energ√≠a escalar.`,
      formulas:['Œ£Fx=0, Œ£Fy=0','Œ£œÑ=0 (rotacional)','W_neto=ŒîK=¬Ωmv¬≤‚àí¬Ωmv‚ÇÄ¬≤','T=F¬∑cosŒ∏¬∑d','P=F¬∑v¬∑cosŒ∏'],
      ejemplo:{titulo:'Gr√∫a con dos cables a 60¬∞ y 45¬∞',
        texto:`Carga=8000 N. Œ£Fx=0: T_A/2=T_B/‚àö2. Œ£Fy=0: T_A sin60¬∞+T_B sin45¬∞=8000. Resultado: T_A‚âà5864 N, T_B‚âà4141 N.`},
      actividades:[
        {texto:'Tres fuerzas: F‚ÇÅ=40N a 0¬∞, F‚ÇÇ=30N a 90¬∞, F‚ÇÉ equilibra. Calcula F‚ÇÉ.',datos:['F‚ÇÅ=(40,0)','F‚ÇÇ=(0,30)'],respuesta:'F‚ÇÉ=‚àí(40,30); |F‚ÇÉ|=<strong>50 N</strong> a 216.87¬∞'},
      ],
      curiosidad:'Los "quants" de Wall Street modelan carteras como vectores en cientos de dimensiones. Diversificar equivale a buscar vectores casi perpendiculares (sin correlaci√≥n) entre s√≠.'}
  },

  algebra:{label:'√Ålgebra',icon:'=',
    basic:{titulo:'Ecuaciones lineales y despeje',
      teoria:`Regla de oro: todo lo que hagas a un lado, hazlo al otro. Para despejar x en ax+b=c: primero resta b, luego divide entre a.<br><strong>Inecuaciones:</strong> al multiplicar/dividir por n√∫mero negativo, el signo de la desigualdad se <strong>invierte</strong>.`,
      formulas:['ax+b=c ‚Üí x=(c‚àíb)/a','x/a=b ‚Üí x=ab','Regla de 3: a/b=c/x ‚Üí x=bc/a'],
      ejemplo:{titulo:'Conversi√≥n de temperatura con √°lgebra',
        texto:`F=(9/5)C+32. Despejando: C=(F‚àí32)√ó5/9. Si F=98.6¬∞F ‚Üí C=66.6√ó5/9=<strong>37¬∞C</strong> (temperatura corporal).`},
      actividades:[
        {texto:'5(x‚àí3)+2=3x+7. Resuelve.',datos:['5(x‚àí3)+2=3x+7'],respuesta:'5x‚àí13=3x+7 ‚Üí 2x=20 ‚Üí x=<strong>10</strong>'},
        {texto:'Per√≠metro de rect√°ngulo=56 cm. L=2A. ¬øDimensiones?',datos:['P=56','L=2A'],respuesta:'2(2A+A)=56 ‚Üí 6A=56 ‚Üí A‚âà<strong>9.33 cm</strong>, L‚âà<strong>18.67 cm</strong>'},
        {texto:'¬æ de un n√∫mero + 12 = 36. ¬øEl n√∫mero?',datos:['(3/4)x+12=36'],respuesta:'(3/4)x=24 ‚Üí x=<strong>32</strong>'}
      ],
      curiosidad:'"√Ålgebra" viene del √°rabe al-jabr (reuni√≥n de partes rotas). Al-Juarismi (s. IX) la sistematiz√≥; su nombre dio "algoritmo". Sin estas ideas no existir√≠an computadoras.'},
    intermediate:{titulo:'Ecuaciones cuadr√°ticas y factorizaci√≥n',
      teoria:`ax¬≤+bx+c=0. Discriminante Œî=b¬≤‚àí4ac:<br>Œî>0 ‚Üí 2 soluciones reales. Œî=0 ‚Üí 1 (ra√≠z doble). Œî<0 ‚Üí ninguna real.<br>F√≥rmula general siempre funciona. Vieta: x‚ÇÅ+x‚ÇÇ=‚àíb/a, x‚ÇÅx‚ÇÇ=c/a.`,
      formulas:['x=(‚àíb¬±‚àö(b¬≤‚àí4ac))/2a','Œî=b¬≤‚àí4ac','x‚ÇÅ+x‚ÇÇ=‚àíb/a','x‚ÇÅx‚ÇÇ=c/a','(x+p)(x+q)=x¬≤+(p+q)x+pq'],
      ejemplo:{titulo:'Optimizaci√≥n de √°rea ‚Äî cercar con 40 m',
        texto:`y=20‚àíx; A=x(20‚àíx)=‚àí(x‚àí10)¬≤+100. M√°ximo en x=10: <strong>A_max=100 m¬≤</strong>. Un cuadrado siempre maximiza el √°rea para un per√≠metro dado.`},
      actividades:[
        {texto:'Rect√°ngulo: √°rea=60 cm¬≤, L=A+7 cm. ¬øDimensiones?',datos:['A=60','L=w+7'],respuesta:'w¬≤+7w‚àí60=0; Œî=289; w=<strong>5 cm</strong>, L=<strong>12 cm</strong>'},
        {texto:'x¬≤‚àí5x+6=0. Resuelve e interpreta con Vieta.',datos:['a=1','b=‚àí5','c=6'],respuesta:'x‚ÇÅ=<strong>3</strong>, x‚ÇÇ=<strong>2</strong>; suma=5=‚àí(‚àí5)/1‚úì, producto=6=6/1‚úì'}
      ],
      curiosidad:'Las cuadr√°ticas aparecen en √≥ptica de lentes, dise√±o de antenas parab√≥licas, econom√≠a (maximizar beneficios), suspensiones de veh√≠culos y forma de cables en puentes colgantes.'},
    advanced:{titulo:'Sistemas de ecuaciones y regla de Cramer',
      teoria:`M√©todos: sustituci√≥n, eliminaci√≥n gaussiana, Cramer (determinantes), factorizaci√≥n LU.<br>Regla de Cramer: D=a‚ÇÅb‚ÇÇ‚àía‚ÇÇb‚ÇÅ; x=Dx/D; y=Dy/D. Solo si D‚â†0. Si D=0: sin soluci√≥n √∫nica.`,
      formulas:['D=a‚ÇÅb‚ÇÇ‚àía‚ÇÇb‚ÇÅ','x=Dx/D','y=Dy/D','Dx=c‚ÇÅb‚ÇÇ‚àíc‚ÇÇb‚ÇÅ','Dy=a‚ÇÅc‚ÇÇ‚àía‚ÇÇc‚ÇÅ'],
      ejemplo:{titulo:'Mezclas industriales de √°cidos',
        texto:`x+y=100, 0.3x+0.7y=50. D=0.4; Dx=20 ‚Üí x=50. Se necesitan <strong>50 L de cada concentraci√≥n</strong>.`},
      actividades:[
        {texto:'Resuelve: 3x+2y=16 y 5x‚àíy=9 por Cramer.',datos:['3x+2y=16','5x‚àíy=9'],respuesta:'D=‚àí13; x‚âà<strong>2.615</strong>; y‚âà<strong>4.077</strong>'},
        {texto:'Dos n√∫meros suman 100 y su diferencia es 24.',datos:['x+y=100','x‚àíy=24'],respuesta:'x=<strong>62</strong>, y=<strong>38</strong>'}
      ],
      curiosidad:'Sistemas con millones de ecuaciones se resuelven en milisegundos para predecir clima, dise√±ar aviones en CAD, o renderizar pel√≠culas Pixar.'}
  },

  force:{label:'Fuerzas',icon:'F',
    basic:{titulo:'Las Tres Leyes de Newton',
      teoria:`<strong>1¬™ Inercia:</strong> sin fuerza neta, el movimiento no cambia.<br><strong>2¬™ F=ma:</strong> fuerza neta = masa √ó aceleraci√≥n.<br><strong>3¬™ Acci√≥n-reacci√≥n:</strong> fuerzas iguales y opuestas sobre cuerpos <em>distintos</em> ‚Äî por eso no se cancelan entre s√≠.`,
      formulas:['F_neta=m¬∑a','a=F/m','Peso=m¬∑g (g‚âà9.8 m/s¬≤)','Impulso J=FŒît=mŒîv','Presi√≥n p=F/A'],
      ejemplo:{titulo:'Airbags ‚Äî por qu√© salvan vidas',
        texto:`70 kg a 60 km/h ‚Üí 0. Sin airbag (Œît=0.02 s): F=58,450 N ‚âà 6 toneladas. Con airbag (Œît=0.3 s): F=3,900 N ‚Äî 15 veces menos.`},
      actividades:[
        {texto:'Elevador sube con a=2 m/s¬≤. Peso aparente de 65 kg.',datos:['m=65 kg','a=2 m/s¬≤'],respuesta:'F=65√ó11.8=<strong>767 N</strong> (vs 637 N real)'},
        {texto:'¬øFuerza neta para acelerar 1200 kg de 0 a 20 m/s en 10 s?',datos:['m=1200','a=2 m/s¬≤'],respuesta:'F=1200√ó2=<strong>2400 N</strong>'}
      ],
      curiosidad:'La ISS flota no porque no haya gravedad sino porque est√° en ca√≠da libre permanente alrededor de la Tierra ‚Äî la estaci√≥n cae continuamente pero la curvatura terrestre "escapa" debajo.'},
    intermediate:{titulo:'Fricci√≥n y planos inclinados',
      teoria:`Normal en plano inclinado: N=mg¬∑cosŒ∏. Fricci√≥n opone movimiento:<br>Est√°tica m√°xima: f_s=Œº_s¬∑N (antes de moverse). Cin√©tica: f_k=Œº_k¬∑N (en movimiento). Siempre Œº_k<Œº_s.<br>En plano: a=g(sinŒ∏‚àíŒºcosŒ∏).`,
      formulas:['N=mg¬∑cosŒ∏','f=Œº¬∑N','a=g¬∑sinŒ∏ (sin fricci√≥n)','a=g(sinŒ∏‚àíŒºcosŒ∏)','Œº=tanŒ∏_cr√≠tico'],
      ejemplo:{titulo:'Curva a 60 km/h con radio 40 m',
        texto:`f_necesaria=mv¬≤/r=1500√ó277/40=10,388 N. f_disponible=0.7√ó1500√ó9.8=10,290 N. ¬°Casi en el l√≠mite! A 61 km/h el auto derrapar√≠a.`},
      actividades:[
        {texto:'Caja 25 kg en plano 35¬∞, Œº_s=0.45. ¬øSe mueve?',datos:['m=25','Œ∏=35¬∞','Œº_s=0.45'],respuesta:'Fp=140.5 N; f_max=90.3 N. Fp>f_max ‚Üí <strong>se desliza</strong>'},
        {texto:'Misma caja con Œº_k=0.35. ¬øAceleraci√≥n?',datos:['Œ∏=35¬∞','Œº_k=0.35'],respuesta:'a=9.8(sin35¬∞‚àí0.35cos35¬∞)‚âà<strong>2.82 m/s¬≤</strong>'}
      ],
      curiosidad:'Neum√°ticos de F√≥rmula 1 operan a 100‚Äì120¬∞C alcanzando Œº‚âà1.8. Eso permite aguantar fuerzas laterales de 5‚Äì6g en curvas ‚Äî m√°s que un piloto de caza promedio.'},
    advanced:{titulo:'Torque y din√°mica rotacional',
      teoria:`Torque œÑ=r√óF (producto cruz); œÑ=r¬∑F¬∑sinŒ∏. Equivale a la fuerza en rotaci√≥n.<br>2¬™ Ley rotacional: œÑ=IŒ±, donde I = momento de inercia.<br>Momento angular L=Iœâ: se conserva si no hay œÑ externo. Patinadora que acerca brazos: I‚Üì ‚Üí œâ‚Üë.`,
      formulas:['œÑ=r¬∑F¬∑sinŒ∏','œÑ=I¬∑Œ±','L=Iœâ=cte (sin œÑ)','E_rot=¬ΩIœâ¬≤','I_disco=¬Ωmr¬≤'],
      ejemplo:{titulo:'Manija al extremo ‚Äî m√°ximo torque',
        texto:`Puerta de 80 cm. En la manija: œÑ=0.8√ó10=8 N¬∑m. A 20 cm del eje: œÑ=0.2√ó10=2 N¬∑m. ¬°4√ó menos! Por eso la manija est√° lejos de la bisagra.`},
      actividades:[
        {texto:'Palanca 3 m, fulcro a 1 m. Peso=600 N en extremo corto. ¬øFuerza m√≠nima en extremo largo?',datos:['L_c=1 m','L_l=2 m','W=600 N'],respuesta:'F√ó2=600√ó1 ‚Üí F=<strong>300 N</strong> (ventaja mec√°nica √ó2)'},
        {texto:'Rueda s√≥lida m=20 kg, r=0.5 m acelera de 0 a 6 rad/s en 4 s. Calcula œÑ.',datos:['I=¬Ω√ó20√ó0.25=2.5 kg¬∑m¬≤','Œ±=1.5 rad/s¬≤'],respuesta:'œÑ=2.5√ó1.5=<strong>3.75 N¬∑m</strong>'}
      ],
      curiosidad:'La Tierra gira m√°s lento cada siglo por el torque de marea de la Luna. Hace 1400 millones de a√±os un d√≠a duraba 18 horas. La Luna se aleja 3.8 cm/a√±o por conservaci√≥n de momento angular.'}
  },

  thermodynamics:{label:'Termodin√°mica',icon:'üå°',
    basic:{titulo:'Temperatura, calor y escalas',
      teoria:`<strong>Temperatura:</strong> energ√≠a cin√©tica promedio de las mol√©culas.<br><strong>Calor:</strong> energ√≠a en tr√°nsito por diferencia de temperatura ‚Äî siempre del cuerpo caliente al fr√≠o.<br>Escalas: Celsius (¬∞C), Fahrenheit (¬∞F), Kelvin (K, escala absoluta: 0 K=‚àí273.15¬∞C).<br><strong>Calor espec√≠fico:</strong> Q=mcŒîT. El agua tiene c=4186 J/(kg¬∑¬∞C) ‚Äî el m√°s alto de los materiales comunes.`,
      formulas:['K=¬∞C+273.15','¬∞C=(¬∞F‚àí32)√ó5/9','¬∞F=(9/5)¬∞C+32','Q=m¬∑c¬∑ŒîT','c_agua=4186 J/(kg¬∑¬∞C)'],
      ejemplo:{titulo:'¬øPor qu√© el mar modera el clima costero?',
        texto:`Agua c=4186; roca c‚âà800 J/(kg¬∑¬∞C). La roca se calienta 5√ó m√°s r√°pido. Por eso las costas tienen veranos frescos e inviernos suaves comparado con el interior.`},
      actividades:[
        {texto:'Energ√≠a para calentar 2 kg de agua de 20¬∞C a 100¬∞C.',datos:['m=2 kg','ŒîT=80¬∞C','c=4186'],respuesta:'Q=2√ó4186√ó80=<strong>669,760 J‚âà670 kJ</strong>'},
        {texto:'Convierte 37¬∞C, 100¬∞C y ‚àí40¬∞C a Fahrenheit y Kelvin.',datos:['Usar f√≥rmulas'],respuesta:'37¬∞C‚Üí98.6¬∞F, 310.15 K | 100¬∞C‚Üí212¬∞F, 373.15 K | ‚àí40¬∞C‚Üí‚àí40¬∞F (¬°coinciden!), 233.15 K'}
      ],
      curiosidad:'El cero absoluto (0 K=‚àí273.15¬∞C) nunca se ha alcanzado exactamente. Los laboratorios m√°s fr√≠os del universo est√°n en la Tierra ‚Äî se ha llegado a nano-kelvins, millon√©simas de grado sobre el cero absoluto.'},
    intermediate:{titulo:'Leyes de la termodin√°mica',
      teoria:`<strong>1¬™ Ley (conservaci√≥n):</strong> ŒîU=Q‚àíW. La energ√≠a total se conserva.<br><strong>2¬™ Ley (entrop√≠a):</strong> El calor no fluye solo del fr√≠o al caliente. La entrop√≠a del universo no disminuye.<br><strong>Eficiencia de Carnot</strong> (m√°ximo te√≥rico): Œ∑=1‚àíT_c/T_h (en Kelvin).`,
      formulas:['ŒîU=Q‚àíW','Œ∑_Carnot=1‚àíT_c/T_h','Œ∑_real<Œ∑_Carnot','W=Q_h‚àíQ_c','pV=nRT'],
      ejemplo:{titulo:'Motor de auto ‚Äî eficiencia real vs Carnot',
        texto:`T_h‚âà1200 K, T_c‚âà400 K. Œ∑_Carnot=66.7%. Œ∑_real‚âà25‚Äì35%. El "calor desperdiciado" es f√≠sica fundamental, no mala ingenier√≠a.`},
      actividades:[
        {texto:'Planta el√©ctrica: 600¬∞C y 40¬∞C. ¬øEficiencia Carnot m√°xima?',datos:['T_h=873 K','T_c=313 K'],respuesta:'Œ∑=1‚àí313/873‚âà<strong>64.2%</strong>'},
        {texto:'Motor que absorbe 5000 J/ciclo con Œ∑=30%. ¬øTrabajo y calor expulsado?',datos:['Q_h=5000','Œ∑=0.30'],respuesta:'W=<strong>1500 J</strong>; Q_c=<strong>3500 J</strong>'}
      ],
      curiosidad:'El Sol como fuente caliente (~5778 K) y el espacio exterior (2.7 K) como fuente fr√≠a. Eficiencia Carnot solar‚âà99.95%. Pero los sistemas solares pr√°cticos capturan mucho menos.'},
    advanced:{titulo:'Entrop√≠a, ciclos y gas ideal',
      teoria:`Entrop√≠a dS=dQ/T (reversible). Procesos del gas ideal:<br>Isot√©rmico (T=cte): W=nRT¬∑ln(V‚ÇÇ/V‚ÇÅ).<br>Isoc√≥rico (V=cte): W=0, ŒîU=Q.<br>Isob√°rico (p=cte): W=pŒîV.<br>Adiab√°tico (Q=0): pV·µû=cte, Œ≥=Cp/Cv.`,
      formulas:['pV=nRT (R=8.314 J/mol¬∑K)','W_isot=nRT¬∑ln(V‚ÇÇ/V‚ÇÅ)','pV·µû=cte (adiab√°tico)','ŒîS=Q/T','COP_frig=Q_c/W=T_c/(T_h‚àíT_c)'],
      ejemplo:{titulo:'Refrigerador ‚Äî bomba de calor inversa',
        texto:`Interior 5¬∞C (278 K), ambiente 30¬∞C (303 K). COP=278/(303‚àí278)=<strong>11.12</strong>. Por cada joule el√©ctrico extrae 11.12 J del interior. No viola la 2¬™ Ley porque consume trabajo externo.`},
      actividades:[
        {texto:'1 mol de gas ideal a 300 K se expande isot√©rmicamente de 1 L a 5 L. Trabajo.',datos:['n=1','T=300 K','V‚ÇÅ=1 L','V‚ÇÇ=5 L'],respuesta:'W=nRT¬∑ln(5)=8.314√ó300√ó1.609‚âà<strong>4013 J</strong>'},
        {texto:'Gas a 2 atm, 10 L, T‚ÇÅ=300 K. Se comprime isoc√≥ricamente a 4 atm. T‚ÇÇ=?',datos:['p‚ÇÅ=2','p‚ÇÇ=4','T‚ÇÅ=300 K'],respuesta:'T‚ÇÇ=T‚ÇÅ√óp‚ÇÇ/p‚ÇÅ=300√ó2=<strong>600 K=327¬∞C</strong>'}
      ],
      curiosidad:'La entrop√≠a del universo ha aumentado ~10‚Å∏‚Å∏ veces desde el Big Bang. La vida es una isla de orden local a costa de exportar entrop√≠a masiva al espacio en forma de calor.'}
  },

  electricity:{label:'Electricidad y Magnetismo',icon:'‚ö°',
    basic:{titulo:'Carga, corriente, voltaje y resistencia',
      teoria:`<strong>Carga el√©ctrica</strong> (C): electr√≥n q=‚àí1.6√ó10‚Åª¬π‚Åπ C.<br><strong>Corriente</strong> I (A)=Q/t: flujo de cargas por segundo.<br><strong>Voltaje</strong> V (V): diferencia de potencial ‚Äî el "empuje" que mueve las cargas.<br><strong>Resistencia</strong> R (Œ©): oposici√≥n al flujo. <strong>Ley de Ohm:</strong> V=IR.`,
      formulas:['V=I¬∑R','I=V/R','R=V/I','P=VI=I¬≤R=V¬≤/R','R_serie=R‚ÇÅ+R‚ÇÇ+...'],
      ejemplo:{titulo:'Fusibles y cortocircuitos',
        texto:`Calefactor 1500 W a 120 V: I=12.5 A, R=9.6 Œ©. Cortocircuito ‚Üí I‚Üí‚àû. El fusible (15 A) se funde antes que el cable. Es el "eslab√≥n d√©bil" intencional de seguridad.`},
      actividades:[
        {texto:'Bombillo 60 W a 120 V. ¬øCorriente y resistencia?',datos:['P=60 W','V=120 V'],respuesta:'I=0.5 A; R=<strong>240 Œ©</strong>'},
        {texto:'R‚ÇÅ=10Œ©, R‚ÇÇ=20Œ©, R‚ÇÉ=30Œ© en serie con V=60 V. ¬øI?',datos:['R_t=60 Œ©','V=60 V'],respuesta:'I=60/60=<strong>1 A</strong>'}
      ],
      curiosidad:'Un rayo descarga hasta 1,000,000 A en microsegundos. La corriente letal comienza en 0.1 A ‚Äî 500 veces menos que un cargador de tel√©fono. La diferencia est√° en el camino por el cuerpo y la duraci√≥n.'},
    intermediate:{titulo:'Circuitos, Kirchhoff y potencia',
      teoria:`<strong>Paralelo:</strong> mismo voltaje, corrientes se suman. 1/R_p=Œ£(1/R·µ¢).<br><strong>Kirchhoff LCK:</strong> suma de corrientes en nodo=0.<br><strong>Kirchhoff LVK:</strong> suma de voltajes en lazo=0.<br>Energ√≠a: E=Pt (kWh en factura). 1 kWh=3.6√ó10‚Å∂ J.`,
      formulas:['1/R_p=1/R‚ÇÅ+1/R‚ÇÇ+...','Œ£I_nodo=0','Œ£V_lazo=0','E=P¬∑t','1 kWh=3.6√ó10‚Å∂ J'],
      ejemplo:{titulo:'Factura el√©ctrica mensual',
        texto:`3 LEDs 10W + TV 100W + refrigerador 150W = 280 W. 6 h/d√≠a √ó 30 d√≠as = 50.4 kWh. A $1.50/kWh ‚âà <strong>$75.60 MXN/mes</strong>.`},
      actividades:[
        {texto:'R‚ÇÅ=40Œ© y R‚ÇÇ=60Œ© en paralelo. ¬øR equivalente?',datos:['R‚ÇÅ=40','R‚ÇÇ=60'],respuesta:'1/R_p=1/40+1/60=5/120 ‚Üí R_p=<strong>24 Œ©</strong>'},
        {texto:'Computadora 250 W, 8 h/d√≠a. Energ√≠a y costo a $2/kWh.',datos:['P=250 W','t=8 h'],respuesta:'E=2 kWh; Costo=<strong>$4 MXN</strong>'}
      ],
      curiosidad:'El cerebro humano opera con ~20 W. En eficiencia computacional supera millones de veces a cualquier supercomputadora actual. Simular un cerebro humano requerir√≠a ~1 exaflop (10¬π‚Å∏ operaciones/s) sostenido.'},
    advanced:{titulo:'Campo el√©ctrico, potencial y capacitores',
      teoria:`Campo el√©ctrico: E=kQ/r¬≤ (V/m). Potencial: V=kQ/r (voltios). Ley de Coulomb: F=kQ‚ÇÅQ‚ÇÇ/r¬≤.<br>Capacitor: Q=CV; energ√≠a U=¬ΩCV¬≤. Paralelo: C_t=Œ£C·µ¢. Serie: 1/C_t=Œ£(1/C·µ¢).<br>Inducci√≥n magn√©tica: F=qv√óB (fuerza de Lorentz).`,
      formulas:['E=kQ/r¬≤ (k=9√ó10‚Åπ)','F=kQ‚ÇÅQ‚ÇÇ/r¬≤','Q=CV; U=¬ΩCV¬≤','F=qv√óB','B=Œº‚ÇÄI/(2œÄr)'],
      ejemplo:{titulo:'Desfibrilador ‚Äî descarga de capacitor',
        texto:`C=32 ŒºF, V=5000 V. Q=0.16 C; U=¬Ω√ó32√ó10‚Åª‚Å∂√ó25√ó10‚Å∂=<strong>400 J</strong>. Descarga en 10 ms ‚Üí P_pico=40,000 W. Un destello de energ√≠a que reinicia el coraz√≥n.`},
      actividades:[
        {texto:'Fuerza entre Q‚ÇÅ=+3ŒºC y Q‚ÇÇ=‚àí2ŒºC a 0.3 m de distancia.',datos:['Q‚ÇÅ=3√ó10‚Åª‚Å∂','Q‚ÇÇ=2√ó10‚Åª‚Å∂','r=0.3'],respuesta:'F=9√ó10‚Åπ√ó6√ó10‚Åª¬π¬≤/0.09=<strong>0.6 N (atractiva)</strong>'},
        {texto:'Capacitor 100 ŒºF cargado a 200 V. ¬øEnerg√≠a almacenada?',datos:['C=100 ŒºF','V=200 V'],respuesta:'U=¬Ω√ó100√ó10‚Åª‚Å∂√ó40000=<strong>2 J</strong>'}
      ],
      curiosidad:'Cada c√©lula de tu cuerpo funciona como un capacitor natural (~1 ŒºF/cm¬≤). Los canales i√≥nicos son transistores biol√≥gicos. El cerebro es un circuito de 86 mil millones de transistores org√°nicos operando en paralelo.'}
  },

  waves:{label:'Ondas y Sonido',icon:'„Äú',
    basic:{titulo:'Propiedades de las ondas',
      teoria:`Una <strong>onda</strong> transporta energ√≠a sin transportar materia. <strong>Mec√°nicas</strong> necesitan medio (sonido, agua). <strong>EM</strong> no (luz, radio).<br>Propiedades: amplitud A, longitud de onda Œª, frecuencia f (Hz), per√≠odo T=1/f, velocidad v=fŒª.<br><strong>Transversales:</strong> vibraci√≥n ‚ä• al movimiento. <strong>Longitudinales:</strong> vibraci√≥n ‚à• al movimiento (sonido).`,
      formulas:['v=f¬∑Œª','T=1/f','v_sonido‚âà343 m/s (aire,20¬∞C)','v_luz=3√ó10‚Å∏ m/s','E‚àùA¬≤'],
      ejemplo:{titulo:'Rango audible humano y altavoces',
        texto:`La (440 Hz): Œª=343/440=0.78 m. Subwoofer (40 Hz): Œª=8.57 m. Silbido (8000 Hz): Œª=4.3 cm. Por eso los subwoofers son enormes y los tweeters diminutos.`},
      actividades:[
        {texto:'Sonido en agua (v=1480 m/s) a 1000 Hz. ¬øLongitud de onda?',datos:['v=1480','f=1000'],respuesta:'Œª=1480/1000=<strong>1.48 m</strong>'},
        {texto:'Cuerda de guitarra vibra a 330 Hz. ¬øPer√≠odo?',datos:['f=330 Hz'],respuesta:'T=1/330‚âà<strong>3.03 ms</strong>'}
      ],
      curiosidad:'Delfines y murci√©lagos usan ultrasonido hasta 200 kHz para ecolocalizaci√≥n. Un ultrasonido m√©dico usa 2‚Äì18 MHz para ver tejidos internos sin radiaci√≥n ionizante.'},
    intermediate:{titulo:'Efecto Doppler, interferencia y resonancia',
      teoria:`<strong>Efecto Doppler:</strong> fuente y observador en movimiento relativo ‚Üí frecuencia cambia. Acerc√°ndose: f‚Üë. Alej√°ndose: f‚Üì.<br>f' = f√ó(v¬±v_obs)/(v‚àìv_f)<br><strong>Interferencia constructiva:</strong> Œîx=nŒª. Destructiva: Œîx=(n+¬Ω)Œª.<br><strong>Resonancia:</strong> la amplitud crece al coincidir frecuencia externa con frecuencia natural.`,
      formulas:["f'=f√ó(v¬±v_obs)/(v‚àìv_f)",'Œîf/f‚âàv_rel/v_sonido','Œîx=nŒª (constructiva)','f_n=nv/(2L) (cuerda)','Œª_n=2L/n'],
      ejemplo:{titulo:'Radar de velocidad policial',
        texto:`f=10 GHz. Auto a 27.8 m/s. Œîf=2√óf√óv/c=2√ó10¬π‚Å∞√ó27.8/3√ó10‚Å∏‚âà<strong>1853 Hz</strong>. El radar detecta esta diferencia y calcula la velocidad. Precisi√≥n ¬±1 km/h.`},
      actividades:[
        {texto:'Ambulancia con sirena 700 Hz a 25 m/s. ¬øFrecuencia al acercarse y alejarse?',datos:['f=700','v_f=25','v_s=343'],respuesta:"Acerc√°ndose: f'=700√ó343/318‚âà<strong>755 Hz</strong>; Alej√°ndose: f'=700√ó343/368‚âà<strong>653 Hz</strong>"},
      ],
      curiosidad:'El "redshift" c√≥smico descubierto por Hubble en 1929 demostr√≥ que el universo se expande. Las galaxias lejanas emiten luz desplazada al rojo ‚Äî Doppler a escala c√≥smica.'},
    advanced:{titulo:'Ondas electromagn√©ticas y espectro',
      teoria:`Ondas EM: oscilaciones acopladas de E y B, perpendiculares entre s√≠ y al movimiento. Velocidad en vac√≠o: c=3√ó10‚Å∏ m/s.<br>Espectro (menor a mayor f): radio, microondas, IR, visible (400‚Äì700 nm), UV, rayos X, gamma.<br>Energ√≠a del fot√≥n: E=hf=hc/Œª.`,
      formulas:['c=f¬∑Œª=3√ó10‚Å∏ m/s','E=hf=hc/Œª','h=6.626√ó10‚Åª¬≥‚Å¥ J¬∑s','n=c/v_medio','I=P/(4œÄr¬≤)'],
      ejemplo:{titulo:'WiFi y microondas ‚Äî misma f√≠sica',
        texto:`WiFi 2.4 GHz: Œª=12.5 cm. Microondas cocina: 2.45 GHz ‚Üí excita resonancia de H‚ÇÇO. Luz visible: 400‚Äì700 nm. Todos son fotones, solo difieren en frecuencia. El ojo detecta ~0.0001% del espectro total.`},
      actividades:[
        {texto:'Emisora FM a 98.7 MHz. ¬øLongitud de onda?',datos:['f=98.7√ó10‚Å∂ Hz'],respuesta:'Œª=3√ó10‚Å∏/98.7√ó10‚Å∂‚âà<strong>3.04 m</strong>'},
        {texto:'Energ√≠a de fot√≥n de luz verde (Œª=550 nm).',datos:['Œª=550√ó10‚Åª‚Åπ m'],respuesta:'E=hc/Œª‚âà<strong>3.61√ó10‚Åª¬π‚Åπ J=2.26 eV</strong>'}
      ],
      curiosidad:'El microondas y el WiFi usan exactamente 2.45 GHz. Por eso el microondas interfiere con el WiFi. La diferencia: microondas ~1000 W, router WiFi ~0.1 W. La misma f√≠sica, distinta potencia.'}
  },

  optics:{label:'√ìptica',icon:'üî≠',
    basic:{titulo:'Reflexi√≥n y refracci√≥n',
      teoria:`<strong>Reflexi√≥n:</strong> √°ngulo incidencia = √°ngulo reflexi√≥n (respecto a la normal).<br><strong>Refracci√≥n:</strong> cambio de direcci√≥n al cambiar de medio. Ley de Snell: n‚ÇÅsinŒ∏‚ÇÅ=n‚ÇÇsinŒ∏‚ÇÇ.<br><strong>√çndice de refracci√≥n:</strong> n=c/v_medio. Cuanto mayor n, m√°s lenta la luz.<br><strong>Reflexi√≥n total interna:</strong> Œ∏_c=arcsin(n‚ÇÇ/n‚ÇÅ). Base de la fibra √≥ptica.`,
      formulas:['Œ∏·µ¢=Œ∏·µ£','n‚ÇÅsinŒ∏‚ÇÅ=n‚ÇÇsinŒ∏‚ÇÇ (Snell)','n=c/v_medio','Œ∏_c=arcsin(n‚ÇÇ/n‚ÇÅ)','n_agua‚âà1.33, n_vidrio‚âà1.5'],
      ejemplo:{titulo:'L√°piz "roto" en el agua',
        texto:`Luz del agua (n=1.33) al aire (n=1) a Œ∏‚ÇÅ=45¬∞: sin Œ∏‚ÇÇ=1.33√ósin45¬∞=0.940 ‚Üí Œ∏‚ÇÇ=70¬∞. El rayo se desv√≠a 25¬∞ al salir. Tu cerebro ve el objeto desplazado.`},
      actividades:[
        {texto:'Rayo del aire (n=1) al vidrio (n=1.5) con Œ∏‚ÇÅ=30¬∞. ¬øŒ∏‚ÇÇ?',datos:['n‚ÇÅ=1','n‚ÇÇ=1.5','Œ∏‚ÇÅ=30¬∞'],respuesta:'sinŒ∏‚ÇÇ=sin30¬∞/1.5=0.333 ‚Üí Œ∏‚ÇÇ‚âà<strong>19.47¬∞</strong>'},
        {texto:'√Ångulo cr√≠tico para vidrio‚Üíaire (n=1.5).',datos:['n‚ÇÅ=1.5','n‚ÇÇ=1'],respuesta:'Œ∏_c=arcsin(1/1.5)=arcsin(0.667)‚âà<strong>41.8¬∞</strong>'}
      ],
      curiosidad:'La fibra √≥ptica transmite datos a la velocidad de la luz por reflexi√≥n total interna. Un hilo del grosor de un cabello puede transmitir 10 terabits/segundo ‚Äî equivalente a 100,000 llamadas telef√≥nicas simult√°neas.'},
    intermediate:{titulo:'Lentes, espejos y formaci√≥n de im√°genes',
      teoria:`Ecuaci√≥n universal: 1/f=1/d_o+1/d_i. Aumento: M=‚àíd_i/d_o.<br>M>0: imagen derecha. M<0: invertida. |M|>1: ampliada.<br>Lente convergente (f>0): puede dar im√°genes reales o virtuales seg√∫n d_o.<br>Lente divergente (f<0): siempre virtual, derecha, reducida.<br>Potencia en dioptr√≠as: P=1/f (f en metros).`,
      formulas:['1/f=1/d‚Çí+1/d·µ¢','M=‚àíd·µ¢/d‚Çí','P=1/f (dioptr√≠as)','f_esfera=R/2'],
      ejemplo:{titulo:'Lentes correctoras ‚Äî miop√≠a de ‚àí2 dioptr√≠as',
        texto:`Miope con punto lejano a 50 cm: 1/f=0+(‚àí1/0.5)=‚àí2 ‚Üí f=‚àí0.5 m ‚Üí <strong>P=‚àí2 dioptr√≠as</strong>. Negativo=divergente=para miopes. Positivo=convergente=para hiperm√©tropes.`},
      actividades:[
        {texto:'Objeto a 30 cm de lente convexa f=20 cm. ¬øD√≥nde est√° la imagen?',datos:['d‚Çí=30','f=20'],respuesta:'1/d·µ¢=1/20‚àí1/30=1/60 ‚Üí d·µ¢=<strong>60 cm (real, invertida, M=‚àí2)</strong>'},
        {texto:'Espejo c√≥ncavo R=40 cm, objeto a 60 cm. ¬øImagen?',datos:['f=20 cm','d‚Çí=60'],respuesta:'d·µ¢=30 cm; M=‚àí0.5 (<strong>real, invertida, reducida</strong>)'}
      ],
      curiosidad:'Los anteojos fueron inventados en Italia ~1290. Permitieron a eruditos seguir leyendo m√°s all√° de los 40 a√±os, extendiendo la vida intelectual productiva y posiblemente acelerando el Renacimiento.'},
    advanced:{titulo:'√ìptica ondulatoria ‚Äî difracci√≥n e interferencia',
      teoria:`Experimento de Young (doble rendija): demuestra que la luz es onda. Franjas brillantes: d¬∑sinŒ∏=mŒª. Franjas oscuras: d¬∑sinŒ∏=(m+¬Ω)Œª.<br>Difracci√≥n por rendija simple: m√≠nimo a¬∑sinŒ∏=mŒª.<br>L√≠mite de resoluci√≥n de Rayleigh: Œ∏_min=1.22Œª/D.`,
      formulas:['d¬∑sinŒ∏=mŒª (doble rendija)','y_m=mŒªL/d','a¬∑sinŒ∏=mŒª (rendija simple)','Œ∏_min=1.22Œª/D'],
      ejemplo:{titulo:'Telescopio Hubble ‚Äî l√≠mite de resoluci√≥n',
        texto:`D=2.4 m, Œª=550 nm. Œ∏_min=1.22√ó550√ó10‚Åª‚Åπ/2.4=2.8√ó10‚Åª‚Å∑ rad‚âà0.057". Equivale a distinguir dos faros de auto separados 1 m a 3,600 km de distancia.`},
      actividades:[
        {texto:'Doble rendija: d=0.2 mm, L=1 m, Œª=600 nm. Separaci√≥n entre franjas.',datos:['d=2√ó10‚Åª‚Å¥','L=1','Œª=600√ó10‚Åª‚Åπ'],respuesta:'y=ŒªL/d=600√ó10‚Åª‚Åπ/2√ó10‚Åª‚Å¥=<strong>3 mm</strong>'},
        {texto:'Resoluci√≥n angular del ojo (D=3 mm, Œª=550 nm).',datos:['D=3√ó10‚Åª¬≥ m'],respuesta:'Œ∏=1.22√ó550√ó10‚Åª‚Åπ/3√ó10‚Åª¬≥‚âà<strong>2.24√ó10‚Åª‚Å¥ rad‚âà0.77 arcmin</strong>'}
      ],
      curiosidad:'Los hologramas de tu tarjeta de cr√©dito son redes de difracci√≥n microsc√≥picas. Leer un holograma con precisi√≥n requiere luz l√°ser de longitud de onda espec√≠fica ‚Äî tecnolog√≠a que aparenta "magia" pero es pura f√≠sica ondulatoria.'}
  },

  energy:{label:'Energ√≠a y Trabajo',icon:'‚öô',
    basic:{titulo:'Trabajo, energ√≠a cin√©tica y potencial',
      teoria:`<strong>Trabajo</strong> W=F¬∑d¬∑cosŒ∏: energ√≠a transferida por una fuerza. Si F‚ä•movimiento, W=0.<br><strong>Energ√≠a cin√©tica</strong> K=¬Ωmv¬≤: duplicar v cuadruplica K.<br><strong>Energ√≠a potencial gravitatoria</strong> U=mgh.<br><strong>Conservaci√≥n:</strong> sin fricci√≥n, E_mec=K+U=constante.`,
      formulas:['W=F¬∑d¬∑cosŒ∏','K=¬Ωmv¬≤','U=mgh','E_mec=K+U=cte','W_neto=ŒîK'],
      ejemplo:{titulo:'Monta√±a rusa desde h=40 m',
        texto:`v=‚àö(2gh)=‚àö(784)=<strong>28 m/s‚âà100.8 km/h</strong>. En h=15 m: v=‚àö(2√ó9.8√ó25)‚âà22.1 m/s. La energ√≠a potencial se convierte en cin√©tica exactamente.`},
      actividades:[
        {texto:'Proyectil 2 kg a 30 m/s. ¬øEnerg√≠a cin√©tica?',datos:['m=2 kg','v=30 m/s'],respuesta:'K=¬Ω√ó2√ó900=<strong>900 J</strong>'},
        {texto:'¬øDesde qu√© altura soltar una pelota para alcanzar 20 m/s al suelo?',datos:['v=20 m/s'],respuesta:'h=v¬≤/(2g)=400/19.6‚âà<strong>20.4 m</strong>'}
      ],
      curiosidad:'Caer desde 10 m impacta a ~14 m/s‚âà50 km/h. La energ√≠a cin√©tica es ~6,860 J ‚Äî equivalente a dejar caer un auto desde 0.5 m de altura. El cuerpo humano tolera hasta ~15 J de impacto localizado.'},
    intermediate:{titulo:'Potencia, rendimiento y energ√≠as no conservativas',
      teoria:`<strong>Potencia</strong> P=W/t=F¬∑v (vatios). 1 HP=746 W.<br>Con fricci√≥n: E_mec_f=E_mec_i‚àíW_fricci√≥n (energ√≠a va a calor).<br><strong>Rendimiento</strong> Œ∑=W_√∫til/E_entrada<100% siempre (2¬™ Ley). Motor el√©ctrico ~90%; gasolina ~25‚Äì35%; solar ~15‚Äì22%.`,
      formulas:['P=W/t=F¬∑v','Œ∑=W_√∫til/E_entrada√ó100%','W_fr=f_k¬∑d','1 HP=746 W','1 kWh=3.6√ó10‚Å∂ J'],
      ejemplo:{titulo:'Auto el√©ctrico vs gasolina',
        texto:`Gasolina: 50 L (~1750 MJ), Œ∑=30% ‚Üí √∫til=525 MJ. El√©ctrico: 75 kWh (270 MJ), Œ∑=90% ‚Üí √∫til=243 MJ. El el√©ctrico usa 3√ó menos energ√≠a bruta por km.`},
      actividades:[
        {texto:'Motor el√©ctrico 5 kW levanta 200 kg. ¬øVelocidad m√°xima vertical?',datos:['P=5000 W','F=1960 N'],respuesta:'v=P/F=5000/1960‚âà<strong>2.55 m/s</strong>'},
        {texto:'Bomba Œ∑=75% eleva 500 L/min a 30 m. ¬øPotencia el√©ctrica?',datos:['m=500 kg/min','h=30 m'],respuesta:'P_√∫til=500√ó9.8√ó30/60=2450 W; P=2450/0.75=<strong>3267 W</strong>'}
      ],
      curiosidad:'El cuerpo humano tiene P_basal‚âà80 W. Los mejores ciclistas del Tour de France sostienen ~400 W durante horas con rendimiento muscular ~25%. Un auto de F1 tiene ~500 kW ‚Äî 6,250 veces m√°s que un humano en reposo.'},
    advanced:{titulo:'Energ√≠a nuclear ‚Äî E=mc¬≤',
      teoria:`Einstein: E=mc¬≤ ‚Äî masa y energ√≠a son equivalentes. c¬≤‚âà9√ó10¬π‚Å∂ J/kg ‚Üí masa peque√±a = energ√≠a enorme.<br>Fisi√≥n (U-235): ~200 MeV/fisi√≥n. Fusi√≥n (D+T‚ÜíHe+n): ~17.6 MeV ‚Äî proceso del Sol.<br>Defecto de masa Œîm: la masa del n√∫cleo < suma de nucleones libres. Esa diferencia es la energ√≠a de enlace.`,
      formulas:['E=mc¬≤ (c=3√ó10‚Å∏ m/s)','E_enlace=Œîm¬∑c¬≤','1 eV=1.6√ó10‚Åª¬π‚Åπ J','1 u=931.5 MeV/c¬≤','P_Sol‚âà3.85√ó10¬≤‚Å∂ W'],
      ejemplo:{titulo:'Hiroshima ‚Äî E=mc¬≤ en n√∫meros reales',
        texto:`"Little Boy" convirti√≥ ~0.6 g en energ√≠a: E=6√ó10‚Åª‚Å¥√ó(3√ó10‚Å∏)¬≤=5.4√ó10¬π¬≥ J‚âà13,000 toneladas de TNT. 0.6 gramos destruyeron una ciudad. Una central nuclear convierte ~1 kg/a√±o ‚Üí 2.5 TWh de electricidad.`},
      actividades:[
        {texto:'¬øEnerg√≠a al aniquilar 1 g de materia con 1 g de antimateria?',datos:['m=2√ó10‚Åª¬≥ kg'],respuesta:'E=2√ó10‚Åª¬≥√ó9√ó10¬π‚Å∂=<strong>1.8√ó10¬π‚Å¥ J=180 TJ</strong> (‚âà43 bombas de Hiroshima)'},
        {texto:'El Sol pierde 4.3√ó10‚Åπ kg/s por fusi√≥n. ¬øPotencia luminosa?',datos:['Œîm=4.3√ó10‚Åπ kg/s'],respuesta:'P=4.3√ó10‚Åπ√ó9√ó10¬π‚Å∂=<strong>3.87√ó10¬≤‚Å∂ W</strong> ‚úì'}
      ],
      curiosidad:'La "Tsar Bomba" (URSS, 1961) liber√≥ 50 megatones. El Sol libera esa misma energ√≠a cada 0.5 milisegundos. Los 4,600 millones de a√±os de vida restante del Sol consumir√°n en total ~3√ó10¬≤‚Å∂ kg de masa ‚Äî el 0.015% de su masa total.'}
  },

  gravitation:{label:'Gravitaci√≥n',icon:'ü™ê',
    basic:{titulo:'Ley de Gravitaci√≥n Universal',
      teoria:`Toda masa atrae a toda otra masa: F=Gm‚ÇÅm‚ÇÇ/r¬≤. Proporcional al producto de masas e inversamente proporcional al cuadrado de la distancia.<br>G=6.674√ó10‚Åª¬π¬π N¬∑m¬≤/kg¬≤ ‚Äî la constante m√°s dif√≠cil de medir en f√≠sica, determinada primero por Cavendish en 1798.<br>g en superficie = GM/R¬≤ (depende del planeta).`,
      formulas:['F=Gm‚ÇÅm‚ÇÇ/r¬≤','G=6.674√ó10‚Åª¬π¬π','g=GM/R¬≤','Peso=mg','g_tierra=9.8 m/s¬≤'],
      ejemplo:{titulo:'¬øPor qu√© la Luna no cae a la Tierra?',
        texto:`La Luna s√≠ cae ‚Äî pero avanza horizontalmente tan r√°pido que la curvatura terrestre escapa debajo. Es una ca√≠da libre perpetua. F_Tierra-Luna‚âà1.98√ó10¬≤‚Å∞ N proporciona la aceleraci√≥n centr√≠peta de la √≥rbita.`},
      actividades:[
        {texto:'Fuerza gravitacional entre dos personas de 70 kg a 1 m de distancia.',datos:['m‚ÇÅ=m‚ÇÇ=70','r=1','G=6.674√ó10‚Åª¬π¬π'],respuesta:'F=6.674√ó10‚Åª¬π¬π√ó4900/1‚âà<strong>3.27√ó10‚Åª‚Å∑ N</strong> (indetectable sin instrumentos)'},
        {texto:'g en Marte (M=6.42√ó10¬≤¬≥ kg, R=3.39√ó10‚Å∂ m).',datos:['G=6.674√ó10‚Åª¬π¬π'],respuesta:'g=GM/R¬≤‚âà<strong>3.72 m/s¬≤</strong> (38% de la Tierra)'}
      ],
      curiosidad:'La gravedad es la m√°s d√©bil de las 4 fuerzas fundamentales. Un im√°n peque√±o puede levantar un clavo venciendo la gravedad de TODO el planeta Tierra. Sin embargo, domina a escala c√≥smica por ser siempre atractiva y de alcance infinito.'},
    intermediate:{titulo:'√ìrbitas y Leyes de Kepler',
      teoria:`Orbita circular: gravedad=centr√≠peta ‚Üí v_orb=‚àö(GM/r).<br>Velocidad de escape: v_esc=‚àö(2GM/R)=‚àö2√óv_orb en superficie.<br><strong>3¬™ Ley de Kepler:</strong> T¬≤‚àùr¬≥. Para el Sistema Solar: T¬≤/r¬≥=4œÄ¬≤/(GM_sol)=constante.`,
      formulas:['v_orb=‚àö(GM/r)','v_esc=‚àö(2GM/R)','T¬≤=(4œÄ¬≤/GM)r¬≥','E_total=‚àíGMm/(2r)','r_geo=42,164 km'],
      ejemplo:{titulo:'GPS a 20,200 km de altitud',
        texto:`r=2.656√ó10‚Å∑ m. v=‚àö(3.986√ó10¬π‚Å¥/2.656√ó10‚Å∑)‚âà3,874 m/s. T‚âà43,080 s‚âà11.97 h. Con al menos 24 sat√©lites, todo punto de la Tierra ve ‚â•4 simult√°neamente para triangulaci√≥n 3D.`},
      actividades:[
        {texto:'ISS a 400 km de altura (R_tierra=6371 km). Velocidad y per√≠odo.',datos:['r=6771 km','GM=3.986√ó10¬π‚Å¥'],respuesta:'v‚âà<strong>7,669 m/s‚âà27,600 km/h</strong>; T‚âà<strong>92.4 min</strong>'},
        {texto:'Tierra en 1 a√±o a 1 UA. Usando Kepler, ¬øper√≠odo de Marte a 1.524 UA?',datos:['r_M=1.524 UA'],respuesta:'T¬≤=1.524¬≥=3.54 ‚Üí T=<strong>1.88 a√±os</strong>'}
      ],
      curiosidad:'La √≥rbita geoestacionaria (35,786 km) fue propuesta por Arthur C. Clarke en 1945 ‚Äî 12 a√±os antes del primer sat√©lite. Hoy lleva oficialmente su nombre: "√ìrbita Clarke". Hay ~500 sat√©lites activos ah√≠.'},
    advanced:{titulo:'Relatividad general y agujeros negros',
      teoria:`Einstein 1915: la gravedad no es fuerza sino <strong>curvatura del espacio-tiempo</strong> por la masa-energ√≠a. Los objetos siguen geod√©sicas (caminos "m√°s rectos") en ese espacio-tiempo curvado.<br>Radio de Schwarzschild: r_s=2GM/c¬≤ (agujero negro si se comprime hasta ese radio).<br>Dilataci√≥n temporal gravitacional: relojes en campo gravitacional corren m√°s lento.`,
      formulas:['r_s=2GM/c¬≤','Œît=Œît‚ÇÄ/‚àö(1‚àír_s/r)','E_fot√≥n=hf(1‚àíGM/rc¬≤)','g_tt=1‚àí2GM/(rc¬≤)','c=3√ó10‚Å∏ m/s'],
      ejemplo:{titulo:'GPS y la relatividad ‚Äî correcci√≥n esencial',
        texto:`Sin correcciones: error acumulado de ~11.4 km/d√≠a. Relatividad especial (velocidad del sat√©lite): ‚àí7 Œºs/d√≠a. Relatividad general (menor gravedad): +45 Œºs/d√≠a. Neto: +38 Œºs/d√≠a ‚Üí correcci√≥n continua necesaria.`},
      actividades:[
        {texto:'Radio de Schwarzschild de agujero negro de 10 masas solares.',datos:['M=2√ó10¬≥¬π kg','G=6.674√ó10‚Åª¬π¬π'],respuesta:'r_s=2√ó6.674√ó10‚Åª¬π¬π√ó2√ó10¬≥¬π/9√ó10¬π‚Å∂‚âà<strong>29,660 m‚âà29.7 km</strong>'},
      ],
      curiosidad:'M87* (fotografiado en 2019) tiene r_s‚âà19,000 millones de km ‚Äî m√°s grande que el Sistema Solar. Est√° a 53 millones de a√±os luz. La "foto" requiri√≥ 8 telescopios en 5 continentes y petabytes de datos procesados durante 2 a√±os.'}
  },

  modernphysics:{label:'F√≠sica Moderna',icon:'‚öõ',
    basic:{titulo:'Cu√°ntica ‚Äî fotones y efecto fotoel√©ctrico',
      teoria:`Einstein 1905: la luz viene en paquetes (<strong>fotones</strong>) con E=hf. El efecto fotoel√©ctrico solo ocurre si f‚â•f_m√≠nima (la intensidad no importa). Esto inaugur√≥ la f√≠sica cu√°ntica.<br>La <strong>constante de Planck</strong> h=6.626√ó10‚Åª¬≥‚Å¥ J¬∑s marca el l√≠mite del mundo cu√°ntico.`,
      formulas:['E=hf=hc/Œª','h=6.626√ó10‚Åª¬≥‚Å¥ J¬∑s','K_max=hf‚àíœÜ','Œª_dB=h/(mv)','1 eV=1.602√ó10‚Åª¬π‚Åπ J'],
      ejemplo:{titulo:'Panel solar de silicio ‚Äî por qu√© tiene l√≠mite de ~33%',
        texto:`Silicio necesita E‚â•1.12 eV. Œª_max=hc/(1.12√ó1.6√ó10‚Åª¬π‚Åπ)‚âà1110 nm (infrarrojo cercano). Fotones con Œª>1110 nm se convierten en calor. El l√≠mite te√≥rico del silicio es ~33% (l√≠mite de Shockley-Queisser).`},
      actividades:[
        {texto:'L√°ser de 1 mW a Œª=532 nm. ¬øFotones por segundo?',datos:['P=10‚Åª¬≥ W','Œª=532 nm'],respuesta:'E_f=hc/Œª‚âà3.73√ó10‚Åª¬π‚Åπ J; N=10‚Åª¬≥/3.73√ó10‚Åª¬π‚Åπ‚âà<strong>2.68√ó10¬π‚Åµ fotones/s</strong>'},
        {texto:'Funci√≥n de trabajo del sodio: œÜ=2.28 eV. Frecuencia m√≠nima para efecto fotoel√©ctrico.',datos:['œÜ=3.65√ó10‚Åª¬π‚Åπ J'],respuesta:'f_min=œÜ/h=3.65√ó10‚Åª¬π‚Åπ/6.626√ó10‚Åª¬≥‚Å¥‚âà<strong>5.51√ó10¬π‚Å¥ Hz</strong> (verde visible)'}
      ],
      curiosidad:'Einstein gan√≥ el Nobel de 1921 por el efecto fotoel√©ctrico, no por la relatividad. En 1905 public√≥ tambi√©n la relatividad especial y la explicaci√≥n del movimiento browniano ‚Äî el "annus mirabilis" m√°s prol√≠fico de la historia cient√≠fica.'},
    intermediate:{titulo:'Principio de incertidumbre y dualidad onda-part√≠cula',
      teoria:`De Broglie 1924: toda part√≠cula tiene Œª=h/(mv). Es una onda de probabilidad (funci√≥n de onda œà).<br><strong>Heisenberg:</strong> Œîx¬∑Œîp‚â•ƒß/2 y ŒîE¬∑Œît‚â•ƒß/2. No es imprecisi√≥n del instrumento ‚Äî es una propiedad fundamental de la naturaleza.<br>Mec√°nica cu√°ntica: probabil√≠stica por naturaleza. |œà|¬≤ es la densidad de probabilidad.`,
      formulas:['Œª=h/(mv)','Œîx¬∑Œîp‚â•ƒß/2','ŒîE¬∑Œît‚â•ƒß/2','ƒß=h/2œÄ=1.055√ó10‚Åª¬≥‚Å¥ J¬∑s','E_n=‚àí13.6/n¬≤ eV (H)'],
      ejemplo:{titulo:'¬øPor qu√© el √°tomo no colapsa?',
        texto:`Si el electr√≥n se confina a r=0.1 nm: Œîp‚â•ƒß/(2√ó10‚Åª¬π‚Å∞)‚âà5.27√ó10‚Åª¬≤‚Åµ kg¬∑m/s. K_m√≠n‚âà0.95 eV. Esta "presi√≥n cu√°ntica" impide el colapso. La estabilidad de la materia es consecuencia directa de la incertidumbre.`},
      actividades:[
        {texto:'Longitud de onda de de Broglie de un electr√≥n a 10‚Å∂ m/s.',datos:['m_e=9.11√ó10‚Åª¬≥¬π kg'],respuesta:'Œª=6.626√ó10‚Åª¬≥‚Å¥/(9.11√ó10‚Åª¬≥¬π√ó10‚Å∂)‚âà<strong>0.727 nm</strong> (del orden at√≥mico)'},
        {texto:'Œîx=10‚Åª¬π‚Å∞ m para un electr√≥n. ¬øIncertidumbre m√≠nima en velocidad?',datos:['m_e=9.11√ó10‚Åª¬≥¬π'],respuesta:'Œîv=ƒß/(2√óŒîx√óm)‚âà<strong>580,000 m/s</strong>'}
      ],
      curiosidad:'En el experimento de la doble rendija, un electr√≥n INDIVIDUAL produce un patr√≥n de interferencia con s√≠ mismo ‚Äî pasa por ambas rendijas simult√°neamente. Si mides por cu√°l pas√≥, el patr√≥n desaparece. La realidad cu√°ntica existe en superposici√≥n hasta ser observada.'},
    advanced:{titulo:'Relatividad especial',
      teoria:`Dos postulados: (1) mismas leyes f√≠sicas en todos los marcos inerciales. (2) c=constante para todos.<br>Consecuencias: dilataci√≥n temporal Œît=Œ≥Œît‚ÇÄ; contracci√≥n espacial L=L‚ÇÄ/Œ≥; masa relativista m=Œ≥m‚ÇÄ.<br>Factor de Lorentz: Œ≥=1/‚àö(1‚àív¬≤/c¬≤). Energ√≠a total: E=Œ≥m‚ÇÄc¬≤.`,
      formulas:['Œ≥=1/‚àö(1‚àív¬≤/c¬≤)','Œît=Œ≥¬∑Œît‚ÇÄ','L=L‚ÇÄ/Œ≥','E=Œ≥m‚ÇÄc¬≤','E¬≤=(pc)¬≤+(m‚ÇÄc¬≤)¬≤'],
      ejemplo:{titulo:'Muones c√≥smicos ‚Äî prueba experimental de relatividad',
        texto:`Muones a 0.998c, vida propia œÑ‚ÇÄ=2.2 Œºs. Sin relatividad llegar√≠an 659 m. Con Œ≥=15.8: œÑ=34.7 Œºs ‚Üí 10.4 km. Los muones llegan a la Tierra en abundancia, exactamente como predice la relatividad.`},
      actividades:[
        {texto:'Nave a 0.9c durante 10 a√±os (tiempo propio). ¬øTiempo en la Tierra?',datos:['v=0.9c','Œît‚ÇÄ=10 a√±os'],respuesta:'Œ≥=1/‚àö0.19‚âà2.294 ‚Üí Œît=<strong>22.94 a√±os en la Tierra</strong>'},
        {texto:'Prot√≥n a 0.99c. Energ√≠a cin√©tica (m_p=1.672√ó10‚Åª¬≤‚Å∑ kg).',datos:['v=0.99c','Œ≥‚âà7.089'],respuesta:'K=(Œ≥‚àí1)m‚ÇÄc¬≤=6.089√ó1.503√ó10‚Åª¬π‚Å∞‚âà<strong>9.15√ó10‚Åª¬π‚Å∞ J‚âà5.71 GeV</strong>'}
      ],
      curiosidad:'En el LHC del CERN, los protones alcanzan Œ≥‚âà7,500 (0.999999991c). Su masa relativista es 7,500 veces la masa en reposo. El LHC consume ~1.3 TWh/a√±o ‚Äî el consumo de 300,000 hogares europeos ‚Äî para mantener esas velocidades.'}
  },

  fluids:{label:'Mec√°nica de Fluidos',icon:'üíß',
    basic:{titulo:'Presi√≥n, densidad y principio de Arqu√≠medes',
      teoria:`<strong>Presi√≥n:</strong> p=F/A (Pa=N/m¬≤). La presi√≥n aumenta con la profundidad: p=œÅgh.<br><strong>Densidad:</strong> œÅ=m/V (kg/m¬≥). Agua: 1000 kg/m¬≥; aire: ~1.2 kg/m¬≥; oro: 19,300 kg/m¬≥.<br><strong>Principio de Arqu√≠medes:</strong> todo cuerpo sumergido experimenta una fuerza de empuje hacia arriba igual al peso del fluido desplazado. F_empuje=œÅ_fluido√óV_sumergido√óg.`,
      formulas:['p=F/A','p=œÅgh','F_empuje=œÅ_f¬∑V¬∑g','œÅ=m/V','p_total=p_atm+œÅgh'],
      ejemplo:{titulo:'¬øPor qu√© flota el barco de acero?',
        texto:`Un barco de acero (œÅ=7,800 kg/m¬≥) flota porque su volumen hueco desplaza suficiente agua. Si V_total=1000 m¬≥ y masa=200,000 kg: œÅ_promedio=200,000/1000=200 kg/m¬≥ < 1000 ‚Üí flota. El empuje: 1000√ó1000√ó9.8=9.8√ó10‚Å∂ N soporta el peso.`},
      actividades:[
        {texto:'Presi√≥n a 100 m de profundidad en el mar (œÅ=1025 kg/m¬≥).',datos:['h=100 m','œÅ=1025','g=9.8'],respuesta:'p=1025√ó9.8√ó100=<strong>1,004,500 Pa‚âà10 atm</strong>'},
        {texto:'¬øQu√© volumen de agua desplaza una bola de acero de 2 kg que flota (imposible si s√≥lida, pero asume que empieza a hundirse)?',datos:['m=2 kg','œÅ_acero=7800'],respuesta:'V_bola=m/œÅ=2/7800=2.56√ó10‚Åª‚Å¥ m¬≥; <strong>se hunde</strong> pues œÅ_acero>œÅ_agua'}
      ],
      curiosidad:'El punto m√°s profundo del oc√©ano (Fosa de las Marianas, ~11,000 m) tiene presi√≥n de ~1,100 atm = 1,115 kg/cm¬≤. Una persona sin traje especial ser√≠a aplastada instant√°neamente. El titanio de los submaridores cient√≠ficos debe soportar esa presi√≥n.'},
    intermediate:{titulo:'Ecuaci√≥n de Bernoulli y flujo laminar',
      teoria:`Para fluido incompresible en flujo estacionario (sin viscosidad): <strong>Ecuaci√≥n de Bernoulli:</strong> p+¬ΩœÅv¬≤+œÅgh=constante a lo largo de una l√≠nea de flujo.<br><strong>Ecuaci√≥n de continuidad:</strong> A‚ÇÅv‚ÇÅ=A‚ÇÇv‚ÇÇ (flujo volum√©trico conservado).<br>Si el tubo se estrecha (A‚Üì), la velocidad aumenta (v‚Üë) y la presi√≥n disminuye (p‚Üì).`,
      formulas:['p+¬ΩœÅv¬≤+œÅgh=cte','A‚ÇÅv‚ÇÅ=A‚ÇÇv‚ÇÇ','Q=Av (caudal)','F_sustentaci√≥n=ŒîpA','Œîp=¬ΩœÅ(v‚ÇÇ¬≤‚àív‚ÇÅ¬≤)'],
      ejemplo:{titulo:'Vuelo de avi√≥n ‚Äî perfil aerodin√°mico',
        texto:`El ala curva hace que el aire viaje m√°s r√°pido por arriba (v_arriba>v_abajo). Por Bernoulli: p_arriba<p_abajo ‚Üí diferencia de presi√≥n hacia arriba = sustentaci√≥n. Un Boeing 747 genera ~600 toneladas de sustentaci√≥n con alas de 541 m¬≤.`},
      actividades:[
        {texto:'Tubo: secci√≥n A‚ÇÅ=0.02 m¬≤ con v‚ÇÅ=2 m/s. Se estrecha a A‚ÇÇ=0.005 m¬≤. ¬øv‚ÇÇ?',datos:['A‚ÇÅv‚ÇÅ=A‚ÇÇv‚ÇÇ'],respuesta:'v‚ÇÇ=A‚ÇÅv‚ÇÅ/A‚ÇÇ=0.02√ó2/0.005=<strong>8 m/s</strong>'},
        {texto:'Diferencia de velocidad en un ala (v_arriba=80 m/s, v_abajo=60 m/s, œÅ=1.2 kg/m¬≥). Diferencia de presi√≥n.',datos:['v‚ÇÅ=80','v‚ÇÇ=60','œÅ=1.2'],respuesta:'Œîp=¬Ω√ó1.2√ó(80¬≤‚àí60¬≤)=0.6√ó(6400‚àí3600)=<strong>1680 Pa</strong>'}
      ],
      curiosidad:'La paradoja de Bernoulli sorprende: al acercar dos hojas de papel paralelas y soplar entre ellas (no hacia afuera), se juntan. La alta velocidad del aire entre ellas reduce la presi√≥n, y la presi√≥n exterior las empuja hacia adentro.'},
    advanced:{titulo:'Viscosidad, flujo turbulento y n√∫mero de Reynolds',
      teoria:`La <strong>viscosidad</strong> Œ∑ mide la resistencia interna al flujo. Ley de Poiseuille: Q=œÄŒîp¬∑r‚Å¥/(8Œ∑L) ‚Äî el caudal depende de r‚Å¥, por eso arteriosclerosis reduce dram√°ticamente el flujo.<br><strong>N√∫mero de Reynolds:</strong> Re=œÅvL/Œ∑. Re<2300: laminar. Re>4000: turbulento. Entre: transici√≥n.<br>Turbulencia es uno de los problemas no resueltos de la f√≠sica cl√°sica.`,
      formulas:['Re=œÅvL/Œ∑','Q=œÄŒîpr‚Å¥/(8Œ∑L) (Poiseuille)','F_viscosa=Œ∑A(dv/dy)','F_Stokes=6œÄŒ∑rv','œÑ=Œ∑dv/dy'],
      ejemplo:{titulo:'Arteriosclerosis ‚Äî por qu√© r‚Å¥ es cr√≠tico',
        texto:`Si una arteria se estrecha un 20% (r‚Üí0.8r): Q‚àùr‚Å¥ ‚Üí Q=(0.8)‚Å¥√óQ‚ÇÄ=0.41√óQ‚ÇÄ. ¬°El flujo se reduce al 41%! Para compensar, el coraz√≥n debe aumentar la presi√≥n 2.4 veces ‚Üí hipertensi√≥n. Una reducci√≥n del 50% del radio deja solo el 6.25% del flujo.`},
      actividades:[
        {texto:'Sangre (Œ∑=0.003 Pa¬∑s, œÅ=1060 kg/m¬≥) fluye en arteria de 4 mm a 0.3 m/s. ¬øRe? ¬øFlujo laminar o turbulento?',datos:['Œ∑=0.003','œÅ=1060','D=0.004 m','v=0.3'],respuesta:'Re=1060√ó0.3√ó0.004/0.003=<strong>424 ‚Üí laminar</strong> (Re<2300)'},
      ],
      curiosidad:'El n√∫mero de Reynolds fue propuesto por Osborne Reynolds en 1883 observando tintes en agua. Hoy aplica desde el flujo de sangre en capilares (Re~0.001) hasta aviones supers√≥nicos (Re~10‚Å∑). Las ecuaciones de Navier-Stokes que describen la turbulencia tienen precio Millennium Prize: $1 mill√≥n para quien las resuelva formalmente.'}
  },

  nuclear:{label:'F√≠sica Nuclear',icon:'‚ò¢',
    basic:{titulo:'Estructura del √°tomo y n√∫cleo',
      teoria:`El <strong>√°tomo</strong>: n√∫cleo (protones Z + neutrones N) rodeado de electrones. N√∫mero m√°sico A=Z+N. Los is√≥topos tienen igual Z pero diferente N.<br>El <strong>n√∫cleo</strong> tiene dimensi√≥n ~10‚Åª¬π‚Åµ m (fm), 100,000 veces m√°s peque√±o que el √°tomo (~10‚Åª¬π‚Å∞ m).<br>La <strong>fuerza nuclear fuerte</strong> une protones y neutrones venciendo la repulsi√≥n el√©ctrica entre protones. Solo act√∫a a distancias <3 fm.`,
      formulas:['A=Z+N','r_n√∫cleo‚âà1.2¬∑A^(1/3) fm','E_enlace=Œîm¬∑c¬≤','1 fm=10‚Åª¬π‚Åµ m','1 u=1.66√ó10‚Åª¬≤‚Å∑ kg'],
      ejemplo:{titulo:'Helio-4 ‚Äî energ√≠a de enlace por nucle√≥n',
        texto:`He-4: 2 protones + 2 neutrones. Masa te√≥rica (libres): 2√ó1.00728+2√ó1.00866=4.03188 u. Masa real: 4.00260 u. Œîm=0.02928 u. E_enlace=0.02928√ó931.5‚âà<strong>27.3 MeV</strong>. Por nucle√≥n: 27.3/4=6.82 MeV/nucle√≥n ‚Äî muy estable.`},
      actividades:[
        {texto:'U-235: Z=92, A=235. ¬øCu√°ntos neutrones tiene?',datos:['Z=92','A=235'],respuesta:'N=A‚àíZ=235‚àí92=<strong>143 neutrones</strong>'},
        {texto:'Radio del n√∫cleo de Au-197 (A=197).',datos:['r‚ÇÄ=1.2 fm','A=197'],respuesta:'r=1.2√ó197^(1/3)=1.2√ó5.82‚âà<strong>6.98 fm</strong>'}
      ],
      curiosidad:'Si el √°tomo de hidr√≥geno fuera del tama√±o de un estadio de f√∫tbol, el n√∫cleo (prot√≥n) ser√≠a del tama√±o de una pelota de golf en el centro. El √°tomo es casi completamente espacio vac√≠o. La materia "s√≥lida" es una ilusi√≥n causada por fuerzas electromagn√©ticas.'},
    intermediate:{titulo:'Radiactividad y decaimiento nuclear',
      teoria:`N√∫cleos inestables emiten radiaci√≥n para alcanzar configuraciones m√°s estables.<br><strong>Decaimiento Œ±:</strong> emite ‚Å¥He (pierde 2p+2n). Poco penetrante.<br><strong>Decaimiento Œ≤‚Åª:</strong> neutron‚Üíprot√≥n+electr√≥n+antineutrino. <strong>Œ≤‚Å∫:</strong> prot√≥n‚Üíneutron+positr√≥n+neutrino.<br><strong>Decaimiento Œ≥:</strong> solo fotones, no cambia A ni Z.<br><strong>Ley del decaimiento:</strong> N(t)=N‚ÇÄ¬∑e^(‚àíŒªt). Semivida T‚ÇÅ/‚ÇÇ=ln2/Œª.`,
      formulas:['N(t)=N‚ÇÄ¬∑e^{‚àíŒªt}','T¬Ω=ln2/Œª=0.693/Œª','Actividad A=ŒªN','N=N‚ÇÄ¬∑(¬Ω)^{t/T¬Ω}','1 Bq=1 desintegraci√≥n/s'],
      ejemplo:{titulo:'Carbono-14 ‚Äî dataci√≥n arqueol√≥gica',
        texto:`C-14 T‚ÇÅ/‚ÇÇ=5,730 a√±os. Un hueso prehist√≥rico tiene 25% de C-14 original:<br>(¬Ω)^(t/5730)=0.25 ‚Üí t/5730=2 ‚Üí <strong>t=11,460 a√±os</strong>.<br>Rango √∫til: ~50,000 a√±os. Para objetos m√°s antiguos se usan otros is√≥topos (U-238, T‚ÇÅ/‚ÇÇ=4.5 Ga).`},
      actividades:[
        {texto:'I-131 (T‚ÇÅ/‚ÇÇ=8.02 d√≠as) se usa en medicina nuclear. ¬øQu√© fracci√≥n queda despu√©s de 24.06 d√≠as?',datos:['n=t/T¬Ω=24.06/8.02=3'],respuesta:'N/N‚ÇÄ=(¬Ω)¬≥=<strong>0.125 = 12.5%</strong>'},
        {texto:'Actividad inicial de 1 mg de Ra-226 (T‚ÇÅ/‚ÇÇ=1600 a√±os, M_a=226 g/mol).',datos:['m=10‚Åª‚Å∂ kg','N_A=6.022√ó10¬≤¬≥'],respuesta:'N=10‚Åª‚Å∂/226√ó10‚Åª¬≥√ó6.022√ó10¬≤¬≥‚âà2.664√ó10¬π‚Åµ; Œª=0.693/(1600√ó3.15√ó10‚Å∑)‚âà1.374√ó10‚Åª¬π¬π; A=ŒªN‚âà<strong>3.66√ó10‚Å¥ Bq=37 kBq‚âà1 ŒºCi</strong>'}
      ],
      curiosidad:'El C-14 lo crea la radiaci√≥n c√≥smica en la atm√≥sfera constantemente. Todo ser vivo mantiene la misma proporci√≥n C-14/C-12 que la atm√≥sfera. Al morir, el C-14 decae sin reposici√≥n. Willard Libby gan√≥ el Nobel de Qu√≠mica en 1960 por desarrollar esta t√©cnica.'},
    advanced:{titulo:'Fisi√≥n, fusi√≥n y aplicaciones nucleares',
      teoria:`<strong>Fisi√≥n:</strong> n√∫cleo pesado (U-235, Pu-239) absorbe neutr√≥n ‚Üí se divide en fragmentos + 2-3 neutrones + ~200 MeV. La reacci√≥n en cadena requiere masa cr√≠tica.<br><strong>Fusi√≥n:</strong> n√∫cleos ligeros se unen (D+T‚ÜíHe-4+n) liberando ~17.6 MeV. Requiere T>100 millones K. Es el proceso del Sol y de la bomba H.<br><strong>Reactores fisionados:</strong> moderadores reducen velocidad de neutrones para mantener la cadena controlada.`,
      formulas:['U-235+n ‚Üí fragmentos+2.4n+~200 MeV','D+T ‚Üí He-4+n+17.6 MeV','E=Œîm¬∑c¬≤','k=factor de multiplicaci√≥n','k=1 ‚Üí reacci√≥n controlada'],
      ejemplo:{titulo:'Central nuclear vs carb√≥n ‚Äî comparaci√≥n energ√©tica',
        texto:`1 kg de uranio enriquecido libera ~45,000 MWh de energ√≠a el√©ctrica.<br>1 kg de carb√≥n libera ~8.14 kWh (0.00000814 MWh).<br>Relaci√≥n: <strong>uranium/carb√≥n ‚âà 5,500,000 veces</strong> m√°s densa energ√©ticamente.<br>Una pastilla de uranio del tama√±o de un dedo me√±ique = el equivalente a 1 tonelada de carb√≥n.`},
      actividades:[
        {texto:'En la fisi√≥n de U-235, el neutr√≥n libera ~200 MeV. ¬øCu√°nta energ√≠a en joules y en kg equivalentes de masa?',datos:['E=200 MeV=200√ó10‚Å∂√ó1.6√ó10‚Åª¬π‚Åπ'],respuesta:'E=3.2√ó10‚Åª¬π¬π J; Œîm=E/c¬≤=3.2√ó10‚Åª¬π¬π/9√ó10¬π‚Å∂‚âà<strong>3.56√ó10‚Åª¬≤‚Å∏ kg‚âà0.214 u</strong>'},
      ],
      curiosidad:'El proyecto ITER (Francia) es el reactor de fusi√≥n m√°s grande jam√°s construido. Costo: ~20 mil millones de euros. Objetivo: producir 500 MW con solo 50 MW de entrada (factor Q=10). Si la fusi√≥n comercial funciona (~2050), usar√≠a agua de mar como combustible. El deuterio en 1 litro de agua de mar equivale a 300 litros de gasolina.'}
  },

  astro:{label:'Astrof√≠sica',icon:'üåå',
    basic:{titulo:'El Sistema Solar y la escala del universo',
      teoria:`El Sistema Solar tiene 8 planetas, el cintur√≥n de asteroides, el cintur√≥n de Kuiper y la Nube de Oort. El Sol contiene el 99.86% de la masa total.<br>Distancias astron√≥micas: 1 UA=1.496√ó10¬π¬π m (Tierra-Sol). 1 a√±o luz=9.461√ó10¬π‚Åµ m. 1 p√°rsec=3.086√ó10¬π‚Å∂ m=3.26 a√±os luz.<br>La galaxia V√≠a L√°ctea tiene ~300 mil millones de estrellas, di√°metro ~100,000 a√±os luz.`,
      formulas:['1 UA=1.496√ó10¬π¬π m','1 a√±o luz=9.461√ó10¬π‚Åµ m','1 pc=3.086√ó10¬π‚Å∂ m=3.26 al','L=4œÄR¬≤œÉT‚Å¥ (Stefan-Boltzmann)','v_escape_sol=617 km/s'],
      ejemplo:{titulo:'Comparaciones de escala del universo',
        texto:`Si el Sol fuera una pelota de playa (60 cm): La Tierra ser√≠a una guisante a 65 m. Neptuno estar√≠a a 2 km. La estrella m√°s cercana (Proxima Centauri) estar√≠a a ~17,000 km. La galaxia completa a ~300,000,000,000 km de esa pelota.`},
      actividades:[
        {texto:'Luz del Sol tarda 8 min 20 s en llegar. ¬øDistancia Tierra-Sol?',datos:['t=500 s','c=3√ó10‚Å∏ m/s'],respuesta:'d=500√ó3√ó10‚Å∏=<strong>1.5√ó10¬π¬π m=1 UA</strong> ‚úì'},
        {texto:'Proxima Centauri est√° a 4.24 a√±os luz. ¬øEn metros y en UA?',datos:['1 al=9.461√ó10¬π‚Åµ m','1 UA=1.496√ó10¬π¬π m'],respuesta:'d=4.24√ó9.461√ó10¬π‚Åµ‚âà<strong>4.01√ó10¬π‚Å∂ m‚âà268,000 UA</strong>'}
      ],
      curiosidad:'El universo observable tiene ~93 mil millones de a√±os luz de di√°metro y contiene ~2 billones de galaxias. La cantidad de estrellas en el universo observable (estimada en 10¬≤‚Å¥) supera la cantidad de granos de arena en todas las playas y desiertos de la Tierra.'},
    intermediate:{titulo:'Estrellas, ciclos estelares y diagrama HR',
      teoria:`Las estrellas se clasifican por temperatura en el <strong>diagrama Hertzsprung-Russell (HR)</strong>: secuencia principal, gigantes, supergigantes, enanas blancas.<br>El ciclo estelar depende de la masa: estrellas como el Sol viven ~10 Ga; masivas (<8M_sol) terminan como enanas blancas; m√°s masivas terminan como estrellas de neutrones o agujeros negros.<br><strong>Ley de Stefan-Boltzmann:</strong> L=4œÄR¬≤œÉT‚Å¥. Las estrellas m√°s calientes (tipo O, B) son azules y brillantes; las fr√≠as (tipo M) son rojas y tenues.`,
      formulas:['L=4œÄR¬≤œÉT‚Å¥','œÉ=5.67√ó10‚Åª‚Å∏ W/m¬≤K‚Å¥','L_sol=3.85√ó10¬≤‚Å∂ W','T_sol‚âà5778 K','M_sol=2√ó10¬≥‚Å∞ kg'],
      ejemplo:{titulo:'Rigel vs el Sol ‚Äî dos estrellas muy distintas',
        texto:`Rigel (tipo B, supergigante azul): T‚âà12,000 K, R‚âà78 R_sol. L=4œÄR¬≤œÉT‚Å¥. Usando proporciones: L/L_sol=(R/R_sol)¬≤√ó(T/T_sol)‚Å¥=78¬≤√ó(12000/5778)‚Å¥=6084√ó18.1‚âà<strong>110,000 L_sol</strong>. Rigel brilla como 110,000 Soles.`},
      actividades:[
        {texto:'Luminosidad del Sol usando Stefan-Boltzmann (R=6.96√ó10‚Å∏ m, T=5778 K).',datos:['œÉ=5.67√ó10‚Åª‚Å∏','R=6.96√ó10‚Å∏','T=5778'],respuesta:'L=4œÄ√ó(6.96√ó10‚Å∏)¬≤√ó5.67√ó10‚Åª‚Å∏√ó5778‚Å¥‚âà<strong>3.85√ó10¬≤‚Å∂ W</strong> ‚úì'},
        {texto:'Estrella con T=3√óT_sol y R=2√óR_sol. ¬øLuminosidad en unidades de L_sol?',datos:['T=3','R=2'],respuesta:'L/L_sol=2¬≤√ó3‚Å¥=4√ó81=<strong>324 L_sol</strong>'}
      ],
      curiosidad:'El Sol est√° en la mitad de su vida, a ~4,600 millones de a√±os. En ~5,000 millones de a√±os se expandir√° a gigante roja absorbiendo Mercurio, Venus y posiblemente la Tierra, antes de colapsar en enana blanca del tama√±o de la Tierra actual.'},
    advanced:{titulo:'Cosmolog√≠a ‚Äî Big Bang, expansi√≥n y materia oscura',
      teoria:`El universo comenz√≥ hace ~13,800 millones de a√±os (Big Bang). Evidencias: expansi√≥n de Hubble (V_recesi√≥n=H‚ÇÄ¬∑d, H‚ÇÄ‚âà70 km/s/Mpc), radiaci√≥n c√≥smica de fondo (CMB, T=2.725 K), abundancias de helio e hidr√≥geno.<br><strong>Energ√≠a oscura</strong> (~68%): acelera la expansi√≥n. <strong>Materia oscura</strong> (~27%): no interact√∫a electromagn√©ticamente pero tiene masa gravitacional. Materia barionica visible: solo ~5%.`,
      formulas:['V=H‚ÇÄ¬∑d (Hubble)','H‚ÇÄ‚âà70 km/s/Mpc','z=(Œª_obs‚àíŒª_emit)/Œª_emit','T_CMB=2.725 K','t_universo‚âà13.8 Ga'],
      ejemplo:{titulo:'Distancia de una galaxia por su redshift',
        texto:`Una galaxia tiene z=0.1 (longitud de onda corrida 10% hacia el rojo).<br>V=z√óc=0.1√ó3√ó10‚Åµ km/s=30,000 km/s.<br>d=V/H‚ÇÄ=30,000/70‚âà<strong>428 Mpc‚âà1,395 millones de a√±os luz</strong>.<br>La vemos como era hace ~1,400 millones de a√±os ‚Äî era arcaica del universo.`},
      actividades:[
        {texto:'Galaxia observada con V_recesi√≥n=21,000 km/s. ¬øDistancia? (H‚ÇÄ=70)',datos:['V=21,000','H‚ÇÄ=70'],respuesta:'d=21000/70=<strong>300 Mpc‚âà978 millones de a√±os luz</strong>'},
        {texto:'Temperatura de la CMB hoy: 2.725 K. Cuando el universo era 1000 veces m√°s peque√±o (redshift z=999), ¬øcu√°l era la temperatura?',datos:['T‚ÇÄ=2.725 K','z=999'],respuesta:'T=T‚ÇÄ√ó(1+z)=2.725√ó1000=<strong>2725 K</strong> (temperatura de una estrella tipo K)'}
      ],
      curiosidad:'El 95% del universo est√° compuesto de energ√≠a oscura y materia oscura ‚Äî de las que no sabemos casi nada. La materia visible (estrellas, planetas, gas) es solo el 5%. El universo que podemos ver y tocar es la excepci√≥n, no la regla.'}
  }

};


// ================================================================
// ESTADO DE LA BIBLIOTECA
// ================================================================
let bibState = { topic: 'velocity', lv: 'basic' };

// ================================================================
// TAB SWITCHING
// ================================================================
function switchTab(tab){
  document.getElementById('sec-ejercicios').style.display = tab==='ejercicios'?'block':'none';
  document.getElementById('sec-biblioteca').style.display = tab==='biblioteca'?'block':'none';
  document.getElementById('sec-simulador').style.display  = tab==='simulador'?'block':'none';
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('on', b.id==='tab-'+tab));
  if(tab==='biblioteca') renderBib();
  if(tab==='simulador')  initSim();
}

// ================================================================
// SIMULADOR VISUAL DE FUNCIONES
// Motor: Canvas 2D, ejes din√°micos, cuadr√≠cula adaptativa,
//        par√°metros deslizables, tabla de valores, tooltip XY.
// 15 funciones did√°cticas: f√≠sica, matem√°ticas, trigonometr√≠a,
//        exponenciales, distribuciones, ondas y m√°s.
// ================================================================

const SIM_FNS = [
  {
    id:'mrua', label:'MRUA ‚Äî Posici√≥n', icon:'üöÄ',
    params:[
      {id:'x0',  label:'x‚ÇÄ (posici√≥n inicial)', min:-20, max:20, step:0.5, val:0, unit:'m'},
      {id:'v0',  label:'v‚ÇÄ (vel. inicial)',      min:-20, max:20, step:0.5, val:5, unit:'m/s'},
      {id:'a',   label:'a (aceleraci√≥n)',         min:-10, max:10, step:0.5, val:2, unit:'m/s¬≤'},
    ],
    xLabel:'t (s)', yLabel:'x (m)', xRange:[0,10],
    fn: (t,p) => p.x0 + p.v0*t + 0.5*p.a*t*t,
    eq: 'x(t) = x‚ÇÄ + v‚ÇÄ¬∑t + ¬Ω¬∑a¬∑t¬≤',
    tableX: [0,1,2,3,4,5,6,7,8,9,10],
    color:'#58a6ff',
    desc:{
      title:'Movimiento Rectil√≠neo Uniformemente Acelerado',
      text:`La posici√≥n en funci√≥n del tiempo describe una <strong>par√°bola</strong>. El par√°metro <strong>a</strong> controla la curvatura: si a>0 la par√°bola abre hacia arriba (aceleraci√≥n), si a<0 hacia abajo (desaceleraci√≥n). <strong>x‚ÇÄ</strong> desplaza la curva verticalmente y <strong>v‚ÇÄ</strong> modifica la pendiente inicial. Observa c√≥mo la derivada de esta curva (velocidad) ser√≠a una l√≠nea recta con pendiente a.`,
    }
  },
  {
    id:'tiro', label:'Tiro parab√≥lico', icon:'‚öæ',
    params:[
      {id:'v0',    label:'v‚ÇÄ (velocidad inicial)', min:5,   max:50,  step:1,   val:20, unit:'m/s'},
      {id:'theta', label:'Œ∏ (√°ngulo)',              min:5,   max:85,  step:1,   val:45, unit:'¬∞'},
      {id:'h0',    label:'h‚ÇÄ (altura inicial)',     min:0,   max:30,  step:1,   val:0,  unit:'m'},
    ],
    xLabel:'x (m)', yLabel:'y (m)', xRange:[0,100],
    fn: (x,p) => {
      const rad = p.theta*Math.PI/180;
      const vx = p.v0*Math.cos(rad), vy = p.v0*Math.sin(rad);
      return p.h0 + vy*(x/vx) - 4.9*(x/vx)*(x/vx);
    },
    extraInfo: (p) => {
      const r = p.theta*Math.PI/180;
      const R = (p.v0*p.v0*Math.sin(2*r)/9.8).toFixed(2);
      const H = (p.v0*p.v0*Math.sin(r)*Math.sin(r)/19.6+p.h0).toFixed(2);
      return `Alcance: ${R} m | H_max: ${H} m`;
    },
    clipNeg: true,
    eq: 'y = h‚ÇÄ + (v‚ÇÄsinŒ∏/v‚ÇÄcosŒ∏)x ‚àí g/(2v‚ÇÄ¬≤cos¬≤Œ∏)¬∑x¬≤',
    color:'#3fb950',
    desc:{
      title:'Tiro Parab√≥lico',
      text:`La trayectoria es una <strong>par√°bola invertida</strong>. Ajusta el √°ngulo Œ∏ y observa: a <strong>45¬∞</strong> se maximiza el alcance horizontal (para h‚ÇÄ=0). √Ångulos complementarios (ej. 30¬∞ y 60¬∞) dan el mismo alcance. La altura inicial h‚ÇÄ extiende la trayectoria. La velocidad v‚ÇÄ escala toda la curva: duplicarla cuadruplica el alcance.`,
    },
    tableX: [0,5,10,15,20,25,30,35,40],
  },
  {
    id:'mhs', label:'Movimiento Arm√≥nico', icon:'„Äú',
    params:[
      {id:'A', label:'A (amplitud)',  min:0.5, max:5,  step:0.1, val:2,   unit:'m'},
      {id:'f', label:'f (frecuencia)',min:0.1, max:3,  step:0.1, val:0.5, unit:'Hz'},
      {id:'œÜ', label:'œÜ (fase)',      min:0,   max:360,step:5,   val:0,   unit:'¬∞'},
    ],
    xLabel:'t (s)', yLabel:'x (m)', xRange:[0,8],
    fn: (t,p) => p.A * Math.cos(2*Math.PI*p.f*t + p.œÜ*Math.PI/180),
    eq: 'x(t) = A¬∑cos(2œÄf¬∑t + œÜ)',
    color:'#e6a817',
    tableX: [0,0.5,1,1.5,2,2.5,3,3.5,4],
    desc:{
      title:'Movimiento Arm√≥nico Simple (MAS)',
      text:`El MAS describe resortes, p√©ndulos y circuitos LC. La <strong>amplitud A</strong> determina el m√°ximo desplazamiento ‚Äî la energ√≠a es proporcional a A¬≤. La <strong>frecuencia f</strong> indica cu√°ntas oscilaciones completas ocurren por segundo (per√≠odo T=1/f). La <strong>fase œÜ</strong> desplaza la curva horizontalmente: œÜ=90¬∞ convierte el coseno en seno.`,
    }
  },
  {
    id:'pendulo', label:'P√©ndulo simple', icon:'‚è≥',
    params:[
      {id:'L', label:'L (longitud)',    min:0.1, max:5,  step:0.1, val:1,   unit:'m'},
      {id:'A', label:'A (amplitud ¬∞)',  min:1,   max:30, step:1,   val:10,  unit:'¬∞'},
      {id:'g', label:'g (gravedad)',    min:1,   max:25, step:0.1, val:9.8, unit:'m/s¬≤'},
    ],
    xLabel:'t (s)', yLabel:'Œ∏ (¬∞)', xRange:[0,8],
    fn: (t,p) => {
      const T = 2*Math.PI*Math.sqrt(p.L/p.g);
      return p.A * Math.cos(2*Math.PI*t/T);
    },
    eq: 'Œ∏(t) = A¬∑cos(2œÄ/T¬∑t),   T = 2œÄ‚àö(L/g)',
    color:'#bc8cff',
    tableX: [0,0.5,1,1.5,2,2.5,3,3.5,4],
    extraInfo: (p) => {
      const T = (2*Math.PI*Math.sqrt(p.L/p.g)).toFixed(3);
      return `Per√≠odo T = ${T} s`;
    },
    desc:{
      title:'P√©ndulo Simple',
      text:`El per√≠odo del p√©ndulo solo depende de la <strong>longitud L</strong> y la <strong>gravedad g</strong> ‚Äî no de la amplitud (para √°ngulos peque√±os). Esto fue lo que descubri√≥ Galileo. Nota c√≥mo en la Luna (g=1.62) el p√©ndulo oscila mucho m√°s lento. Un p√©ndulo de 1 m tiene T‚âà2 s, base del reloj de p√©ndulo. La dependencia de ‚àöL significa que para duplicar el per√≠odo hay que cuadruplicar la longitud.`,
    }
  },
  {
    id:'resorte', label:'Energ√≠a en resorte', icon:'üîµ',
    params:[
      {id:'k', label:'k (constante resorte)', min:1,  max:50, step:1,   val:10, unit:'N/m'},
      {id:'m', label:'m (masa)',               min:0.1,max:5,  step:0.1, val:1,  unit:'kg'},
      {id:'A', label:'A (amplitud)',            min:0.1,max:3,  step:0.1, val:1,  unit:'m'},
    ],
    xLabel:'t (s)', yLabel:'E (J)', xRange:[0,8],
    fn2: true, // plot two curves
    fn: (t,p) => {
      const œâ = Math.sqrt(p.k/p.m);
      return 0.5*p.k*p.A*p.A*Math.cos(œâ*t)*Math.cos(œâ*t); // Ep
    },
    fn_b: (t,p) => {
      const œâ = Math.sqrt(p.k/p.m);
      return 0.5*p.m*œâ*œâ*p.A*p.A*Math.sin(œâ*t)*Math.sin(œâ*t); // Ec
    },
    colorB:'#3fb950',
    eq: 'Ep=¬Ωkx¬≤=¬ΩkA¬≤cos¬≤(œât)   Ec=¬Ωmv¬≤=¬ΩkA¬≤sin¬≤(œât)',
    color:'#f85149',
    legend: ['üî¥ Energ√≠a potencial (Ep)', 'üü¢ Energ√≠a cin√©tica (Ec)'],
    tableX: [0,0.5,1,1.5,2,2.5,3],
    extraInfo: (p) => {
      const E = (0.5*p.k*p.A*p.A).toFixed(3);
      const œâ = Math.sqrt(p.k/p.m).toFixed(3);
      return `E_total = ${E} J | œâ = ${œâ} rad/s`;
    },
    desc:{
      title:'Conservaci√≥n de Energ√≠a en Resorte (MAS)',
      text:`La energ√≠a <strong style="color:#f85149">potencial (Ep)</strong> y <strong style="color:#3fb950">cin√©tica (Ec)</strong> oscilan pero su suma siempre es constante (E_total = ¬ΩkA¬≤). Cuando el resorte est√° en la posici√≥n extrema (x=¬±A), toda la energ√≠a es potencial. En el centro (x=0), toda es cin√©tica. Esta gr√°fica visualiza la conversi√≥n continua entre ambas formas de energ√≠a ‚Äî fundamento de la conservaci√≥n de energ√≠a mec√°nica.`,
    }
  },
  {
    id:'ley_enfriamiento', label:'Enfriamiento Newton', icon:'üå°',
    params:[
      {id:'T0', label:'T‚ÇÄ (temp. inicial)',  min:50,  max:200, step:5,  val:100, unit:'¬∞C'},
      {id:'Ta', label:'T‚Çê (temp. ambiente)', min:0,   max:40,  step:1,  val:20,  unit:'¬∞C'},
      {id:'k',  label:'k (constante)',        min:0.05,max:1,   step:0.05,val:0.2, unit:'1/min'},
    ],
    xLabel:'t (min)', yLabel:'T (¬∞C)', xRange:[0,20],
    fn: (t,p) => p.Ta + (p.T0 - p.Ta)*Math.exp(-p.k*t),
    eq: 'T(t) = T‚Çê + (T‚ÇÄ‚àíT‚Çê)¬∑e^{‚àíkt}',
    color:'#f85149',
    tableX: [0,2,4,6,8,10,12,14,16,18,20],
    desc:{
      title:'Ley de Enfriamiento de Newton',
      text:`Un objeto caliente pierde calor a una tasa proporcional a la diferencia de temperatura con el ambiente. La curva es una <strong>exponencial decreciente</strong> que se aproxima asint√≥ticamente a T‚Çê (nunca la cruza). La constante k controla qu√© tan r√°pido enfr√≠a: mayor k = curva m√°s empinada. Esta ecuaci√≥n se usa en medicina forense para estimar la hora de muerte, en ingenier√≠a para dise√±ar disipadores de calor, y en f√≠sica de materiales.`,
    }
  },
  {
    id:'ley_coulomb', label:'Fuerza el√©ctrica vs distancia', icon:'‚ö°',
    params:[
      {id:'q1', label:'q‚ÇÅ (carga 1)', min:1,  max:20, step:0.5, val:5,  unit:'ŒºC'},
      {id:'q2', label:'q‚ÇÇ (carga 2)', min:1,  max:20, step:0.5, val:5,  unit:'ŒºC'},
    ],
    xLabel:'r (cm)', yLabel:'F (N)', xRange:[1,30],
    fn: (r,p) => (9e9 * p.q1*1e-6 * p.q2*1e-6) / ((r/100)*(r/100)),
    eq: 'F(r) = kQ‚ÇÅQ‚ÇÇ/r¬≤   (k=9√ó10‚Åπ N¬∑m¬≤/C¬≤)',
    color:'#e6a817',
    tableX: [1,2,3,5,7,10,15,20,25,30],
    desc:{
      title:'Ley de Coulomb ‚Äî Dependencia 1/r¬≤',
      text:`La fuerza el√©ctrica disminuye con el <strong>cuadrado de la distancia</strong>. Esta dependencia 1/r¬≤ es la misma que la gravitacional de Newton ‚Äî no es coincidencia, ambas son fuerzas de campo de largo alcance. Al <strong>duplicar la distancia</strong>, la fuerza se reduce a ¬º. Al triplicarla, queda 1/9. Desliza r para visualizar este comportamiento hiperb√≥lico. La curva se dispara verticalmente al acercarse a r=0 ‚Äî en la realidad, los √°tomos tienen tama√±o finito que lo impide.`,
    }
  },
  {
    id:'capacitor', label:'Carga de Capacitor (RC)', icon:'üîã',
    params:[
      {id:'V0', label:'V‚ÇÄ (voltaje fuente)', min:1,   max:20, step:0.5, val:5,  unit:'V'},
      {id:'R',  label:'R (resistencia)',      min:1,   max:20, step:0.5, val:5,  unit:'kŒ©'},
      {id:'C',  label:'C (capacitancia)',     min:100, max:2000,step:50, val:470,unit:'ŒºF'},
    ],
    xLabel:'t (s)', yLabel:'Vc (V)', xRange:[0,25],
    fn: (t,p) => p.V0*(1 - Math.exp(-t/(p.R*1000*p.C*1e-6))),
    eq: 'Vc(t) = V‚ÇÄ¬∑(1 ‚àí e^{‚àít/RC})',
    color:'#58a6ff',
    tableX: [0,1,2,3,5,7,10,13,16,20,25],
    extraInfo: (p) => {
      const tau = (p.R*1000*p.C*1e-6).toFixed(3);
      return `œÑ = RC = ${tau} s  (al 63% en t=œÑ)`;
    },
    desc:{
      title:'Carga de Capacitor en Circuito RC',
      text:`El voltaje del capacitor crece exponencialmente acerc√°ndose a V‚ÇÄ sin nunca alcanzarlo. La <strong>constante de tiempo œÑ=RC</strong> determina la velocidad: en t=œÑ el capacitor est√° al 63.2% de V‚ÇÄ; en t=5œÑ est√° al 99.3% (se considera "completamente cargado"). Nota que al duplicar R o C se duplica œÑ y la curva se "extiende" horizontalmente. Este comportamiento aparece en electr√≥nica (filtros, delays), biolog√≠a (potenciales de membrana) y qu√≠mica (reacciones de primer orden).`,
    }
  },
  {
    id:'senoidal', label:'Ondas y Superposici√≥n', icon:'üåä',
    params:[
      {id:'A1', label:'A‚ÇÅ (amplitud 1)', min:0.1, max:3,  step:0.1, val:1,   unit:''},
      {id:'f1', label:'f‚ÇÅ (frecuencia 1)',min:0.1, max:5,  step:0.1, val:1,   unit:'Hz'},
      {id:'A2', label:'A‚ÇÇ (amplitud 2)', min:0,   max:3,  step:0.1, val:0.5, unit:''},
      {id:'f2', label:'f‚ÇÇ (frecuencia 2)',min:0.1, max:5,  step:0.1, val:3,   unit:'Hz'},
    ],
    xLabel:'t (s)', yLabel:'y', xRange:[0,4],
    fn2: true,
    fn: (t,p) => p.A1*Math.sin(2*Math.PI*p.f1*t) + p.A2*Math.sin(2*Math.PI*p.f2*t),
    fn_b: (t,p) => p.A1*Math.sin(2*Math.PI*p.f1*t),
    fn_c: (t,p) => p.A2*Math.sin(2*Math.PI*p.f2*t),
    colorB:'rgba(88,166,255,0.4)',
    colorC:'rgba(63,185,80,0.4)',
    eq: 'y = A‚ÇÅsin(2œÄf‚ÇÅt) + A‚ÇÇsin(2œÄf‚ÇÇt)',
    color:'#e6a817',
    legend:['üü° Suma (superposici√≥n)','üîµ Onda 1 (A‚ÇÅ,f‚ÇÅ)','üü¢ Onda 2 (A‚ÇÇ,f‚ÇÇ)'],
    tableX: [0,0.25,0.5,0.75,1,1.25,1.5,1.75,2],
    desc:{
      title:'Principio de Superposici√≥n de Ondas',
      text:`Dos ondas que se cruzan se <strong>suman punto a punto</strong>. Cuando f‚ÇÅ‚âàf‚ÇÇ se producen <em>batidos</em> ‚Äî variaciones lentas de amplitud que escuchas como "wow-wow" al afinar un instrumento. Cuando f‚ÇÇ es m√∫ltiplo de f‚ÇÅ (arm√≥nicos) aparecen patrones peri√≥dicos estables ‚Äî base del timbre musical. Ajusta f‚ÇÇ/f‚ÇÅ = 2 (octava), 3/2 (quinta), 4/3 (cuarta) y observa las diferentes formas de onda resultantes.`,
    }
  },
  {
    id:'gravedad', label:'Gravedad Universal vs r', icon:'ü™ê',
    params:[
      {id:'M',  label:'M (masa en M_tierra)', min:0.5, max:10, step:0.1, val:1,  unit:'M‚äï'},
      {id:'m',  label:'m (masa objeto)',       min:1,   max:100,step:1,   val:10, unit:'kg'},
    ],
    xLabel:'r (R_tierra)', yLabel:'F (N)', xRange:[1,20],
    fn: (r,p) => {
      const G=6.674e-11, Mt=5.97e24, Rt=6.371e6;
      return G*(p.M*Mt)*p.m / ((r*Rt)*(r*Rt));
    },
    eq: 'F = GM¬∑m / r¬≤   (1/r¬≤)',
    color:'#bc8cff',
    tableX: [1,2,3,5,7,10,15,20],
    extraInfo: (p) => {
      const G=6.674e-11,Mt=5.97e24,Rt=6.371e6;
      const g_sup = (G*p.M*Mt/(Rt*Rt)).toFixed(2);
      return `g en superficie = ${g_sup} m/s¬≤`;
    },
    desc:{
      title:'Ley de Gravitaci√≥n Universal ‚Äî Ca√≠da 1/r¬≤',
      text:`La fuerza gravitacional disminuye con el cuadrado de la distancia al centro del planeta. A r=1 (superficie) obtienes el peso habitual. A r=2 (el doble de distancia), la fuerza es ¬º. La ISS orbita a r‚âà1.06 R_tierra ‚Äî la gravedad ah√≠ es ~88% de la superficie, no cero. Los astronautas flotan porque est√°n en <em>ca√≠da libre</em>, no porque no haya gravedad.`,
    }
  },
  {
    id:'doppler', label:'Efecto Doppler', icon:'üîä',
    params:[
      {id:'f0',  label:'f‚ÇÄ (frecuencia emisor)', min:100, max:2000,step:50, val:440, unit:'Hz'},
      {id:'vf',  label:'v_fuente',                min:0,   max:100, step:1,  val:30,  unit:'m/s'},
    ],
    xLabel:'posici√≥n x (m)', yLabel:'f_obs (Hz)', xRange:[-100,100],
    fn: (x,p) => {
      const vs=343;
      if(x<0) return p.f0*vs/(vs-p.vf);   // fuente acerc√°ndose
      if(x>0) return p.f0*vs/(vs+p.vf);   // fuente alej√°ndose
      return p.f0;
    },
    eq: "f' = f‚ÇÄ¬∑vs/(vs‚àìvf)",
    color:'#58a6ff',
    tableX:[-80,-60,-40,-20,-5,0,5,20,40,60,80],
    extraInfo: (p) => {
      const vs=343;
      const fa=(p.f0*vs/(vs-p.vf)).toFixed(1), fl=(p.f0*vs/(vs+p.vf)).toFixed(1);
      return `Acerc√°ndose: ${fa} Hz | Alej√°ndose: ${fl} Hz`;
    },
    desc:{
      title:'Efecto Doppler ‚Äî Frecuencia Observada',
      text:`Cuando la fuente sonora se <strong>acerca</strong> (x<0), el observador escucha una frecuencia m√°s alta (tono agudo). Cuando se <strong>aleja</strong> (x>0), la frecuencia baja (tono grave). La discontinuidad en x=0 es el "frente de onda" en el momento de pasar. Ajusta v_fuente para ver c√≥mo se ampl√≠a la diferencia. Si v_fuente ‚Üí 343 m/s (velocidad del sonido), la frecuencia de acercamiento ‚Üí ‚àû (barrera del sonido).`,
    }
  },
  {
    id:'gauss', label:'Distribuci√≥n Normal (Gauss)', icon:'üìä',
    params:[
      {id:'mu',    label:'Œº (media)',             min:-5, max:5,   step:0.1, val:0,   unit:''},
      {id:'sigma', label:'œÉ (desviaci√≥n est√°ndar)',min:0.3,max:3,   step:0.1, val:1,   unit:''},
    ],
    xLabel:'x', yLabel:'P(x)', xRange:[-6,6],
    fn: (x,p) => (1/(p.sigma*Math.sqrt(2*Math.PI)))*Math.exp(-0.5*((x-p.mu)/p.sigma)**2),
    eq: 'P(x) = (1/œÉ‚àö2œÄ)¬∑e^{‚àí(x‚àíŒº)¬≤/(2œÉ¬≤)}',
    color:'#3fb950',
    tableX:[-3,-2,-1,0,1,2,3],
    desc:{
      title:'Distribuci√≥n Normal de Gauss',
      text:`La distribuci√≥n m√°s importante de la estad√≠stica. Aparece en f√≠sica (distribuci√≥n de velocidades moleculares de Maxwell-Boltzmann), medici√≥n de errores, notas acad√©micas, alturas humanas, precios de activos. La <strong>media Œº</strong> desplaza la campana horizontalmente. La <strong>desviaci√≥n œÉ</strong> controla su anchura: œÉ peque√±a = campana estrecha y alta, œÉ grande = campana ancha y baja. El √°rea bajo la curva siempre es 1 (probabilidad total = 100%).`,
    }
  },
  {
    id:'maxwell', label:'Distribuci√≥n de Maxwell (gases)', icon:'üí®',
    params:[
      {id:'T',  label:'T (temperatura)', min:100, max:2000, step:50,  val:300,  unit:'K'},
      {id:'M',  label:'M (masa molar)',  min:2,   max:32,   step:1,   val:2,    unit:'g/mol'},
    ],
    xLabel:'v (m/s)', yLabel:'f(v)', xRange:[0,4000],
    fn: (v,p) => {
      const R=8.314, m=p.M/1000;
      const a=m/(2*R*p.T);
      return 4*Math.PI*Math.pow(a/Math.PI,1.5)*v*v*Math.exp(-a*v*v);
    },
    eq: 'f(v) = 4œÄ(m/2œÄkT)^{3/2}¬∑v¬≤¬∑e^{‚àímv¬≤/2kT}',
    color:'#e6a817',
    tableX:[0,200,400,600,800,1000,1200,1500,2000,2500],
    extraInfo: (p) => {
      const R=8.314,m=p.M/1000;
      const vp=Math.sqrt(2*R*p.T/m).toFixed(0);
      const vrms=Math.sqrt(3*R*p.T/m).toFixed(0);
      return `v_m√°s_probable=${vp} m/s | v_rms=${vrms} m/s`;
    },
    desc:{
      title:'Distribuci√≥n de Velocidades de Maxwell-Boltzmann',
      text:`Las mol√©culas de un gas no viajan todas a la misma velocidad ‚Äî siguen esta distribuci√≥n. Al <strong>aumentar T</strong>, la curva se aplana y desplaza a velocidades mayores (las mol√©culas van m√°s r√°pido). Mol√©culas <strong>m√°s ligeras</strong> (H‚ÇÇ vs Ar) tienen la misma energ√≠a promedio pero mayor velocidad promedio (¬Ωmv¬≤=3/2kT ‚Üí v‚àù1/‚àöm). Por eso el hidr√≥geno escapa de la atm√≥sfera terrestre con el tiempo, pero el arg√≥n no.`,
    }
  },
  {
    id:'bragg', label:'Difracci√≥n ‚Äî Red de difracci√≥n', icon:'üåà',
    params:[
      {id:'lambda',label:'Œª (longitud de onda)', min:380, max:780,  step:5,  val:550,  unit:'nm'},
      {id:'d',     label:'d (espaciado red)',     min:500, max:3000, step:50, val:1000, unit:'nm'},
    ],
    xLabel:'Œ∏ (¬∞)', yLabel:'Intensidad', xRange:[0,90],
    fn: (theta,p) => {
      const rad=theta*Math.PI/180;
      const N=20; // n√∫mero de rendijas
      const delta=2*Math.PI*p.d*Math.sin(rad)/p.lambda;
      if(Math.abs(delta)<1e-9) return N*N;
      const num=Math.sin(N*delta/2), den=Math.sin(delta/2);
      return (num/den)*(num/den);
    },
    eq: 'I(Œ∏) = [sin(NŒ¥/2)/sin(Œ¥/2)]¬≤,  Œ¥=2œÄd¬∑sinŒ∏/Œª',
    color:'#bc8cff',
    tableX:[0,10,20,30,40,50,60,70,80,90],
    desc:{
      title:'Patr√≥n de Difracci√≥n ‚Äî Red de N Rendijas',
      text:`La intensidad difractada forma <strong>picos muy agudos</strong> en los √°ngulos donde d¬∑sinŒ∏=mŒª (m√°ximos de orden m). Entre los picos principales hay N-2 m√≠nimos secundarios. Al <strong>aumentar Œª</strong> (luz roja vs azul), los picos se desplazan a √°ngulos mayores ‚Äî por eso las redes de difracci√≥n separan colores (como un prisma, pero por interferencia). Las redes de difracci√≥n se usan en espectroscop√≠a para identificar elementos por su espectro de emisi√≥n.`,
    }
  },
];

let simState = { fnId: 'mrua', params:{}, mouseX: null };
let simInitialized = false;

function initSim(){
  if(simInitialized){ renderSim(); return; }
  simInitialized = true;
  // Build function bar
  const bar = document.getElementById('simFnBar');
  SIM_FNS.forEach(fn=>{
    const b=document.createElement('button');
    b.className='sim-fn-btn'+(fn.id===simState.fnId?' on':'');
    b.innerHTML=`${fn.icon} ${fn.label}`;
    b.onclick=()=>{ simState.fnId=fn.id; renderSim(); };
    bar.appendChild(b);
  });
  renderSim();
  // Mouse tracking on canvas
  const canvas=document.getElementById('simCanvas');
  canvas.addEventListener('mousemove', e=>{
    const rect=canvas.getBoundingClientRect();
    const px=(e.clientX-rect.left)*(canvas.width/rect.width);
    simState.mouseX=px;
    drawSim(getSimFn(), getSimParams());
  });
  canvas.addEventListener('mouseleave',()=>{
    simState.mouseX=null;
    drawSim(getSimFn(), getSimParams());
  });
}

function getSimFn(){ return SIM_FNS.find(f=>f.id===simState.fnId)||SIM_FNS[0]; }

function getSimParams(){
  const fn=getSimFn(), p={};
  fn.params.forEach(param=>{ p[param.id]=simState.params[fn.id]?.[param.id]??param.val; });
  return p;
}

function renderSim(){
  const fn=getSimFn();
  // Highlight active fn button
  document.querySelectorAll('.sim-fn-btn').forEach(b=>{
    b.classList.toggle('on', b.textContent.includes(fn.label));
  });
  const p=getSimParams();
  buildSimControls(fn,p);
  drawSim(fn,p);
  buildSimDesc(fn);
  buildSimTable(fn,p);
}

function buildSimControls(fn,p){
  const ctrl=document.getElementById('simControls'); if(!ctrl)return;
  ctrl.innerHTML=`<div class="sim-fn-eq">${fn.eq}</div>`;
  if(fn.legend){
    ctrl.innerHTML+=`<div class="sim-checkpoint">${fn.legend.map(l=>`<span class="sim-cp">${l}</span>`).join('')}</div>`;
  }
  fn.params.forEach(param=>{
    const val=p[param.id];
    const d=document.createElement('div'); d.className='sim-ctrl';
    d.innerHTML=`
      <div class="sim-ctrl-label">
        <span class="sim-ctrl-name">${param.label}</span>
        <span class="sim-ctrl-val" id="sv_${fn.id}_${param.id}">${val} ${param.unit}</span>
      </div>
      <input type="range" class="sim-range" min="${param.min}" max="${param.max}" step="${param.step}" value="${val}"
        oninput="simSetParam('${fn.id}','${param.id}',this.value)">`;
    ctrl.appendChild(d);
  });
  if(fn.extraInfo){
    const info=document.createElement('div');
    info.id='simExtraInfo';
    info.style.cssText='font-family:var(--mn);font-size:.72rem;color:var(--cd);background:var(--sf2);border-radius:6px;padding:7px 12px;margin-top:2px';
    info.textContent=fn.extraInfo(p);
    ctrl.appendChild(info);
  }
  const resetBtn=document.createElement('button');
  resetBtn.className='sim-reset'; resetBtn.textContent='‚ü≥ Valores por defecto';
  resetBtn.onclick=()=>{ if(simState.params[fn.id]) delete simState.params[fn.id]; renderSim(); };
  ctrl.appendChild(resetBtn);
}

function simSetParam(fnId,paramId,rawVal){
  if(!simState.params[fnId]) simState.params[fnId]={};
  const fn=SIM_FNS.find(f=>f.id===fnId);
  const param=fn.params.find(p=>p.id===paramId);
  const val=parseFloat(rawVal);
  simState.params[fnId][paramId]=val;
  const vEl=document.getElementById(`sv_${fnId}_${paramId}`);
  if(vEl) vEl.textContent=`${val} ${param.unit}`;
  const p=getSimParams();
  drawSim(fn,p);
  buildSimTable(fn,p);
  if(fn.extraInfo){
    const infoEl=document.getElementById('simExtraInfo');
    if(infoEl) infoEl.textContent=fn.extraInfo(p);
  }
}

function buildSimDesc(fn){
  const el=document.getElementById('simDesc'); if(!el||!fn.desc)return;
  el.innerHTML=`<h4>${fn.desc.title}</h4><p>${fn.desc.text}</p>`;
}

function buildSimTable(fn,p){
  const tbl=document.getElementById('simTable'); if(!tbl)return;
  const xs=fn.tableX||[];
  let html=`<tr><th>${fn.xLabel}</th>`;
  if(fn.fn2&&fn.fn_b){
    if(fn.fn_c) html+=`<th>y (suma)</th><th>y‚ÇÅ</th><th>y‚ÇÇ</th>`;
    else html+=`<th style="color:#f85149">Ep (J)</th><th style="color:#3fb950">Ec (J)</th><th>E_total (J)</th>`;
  } else {
    html+=`<th>${fn.yLabel}</th>`;
  }
  html+='</tr>';
  xs.forEach(x=>{
    const y=fn.fn(x,p);
    const yClip=fn.clipNeg&&y<0?null:y;
    let row=`<tr><td>${x}</td>`;
    if(fn.fn2&&fn.fn_b){
      const yb=fn.fn_b(x,p);
      if(fn.fn_c){const yc=fn.fn_c(x,p);row+=`<td>${fmt(y)}</td><td>${fmt(yb)}</td><td>${fmt(yc)}</td>`;}
      else{const tot=y+yb;row+=`<td>${fmt(y)}</td><td>${fmt(yb)}</td><td>${fmt(tot)}</td>`;}
    } else {
      row+=`<td>${yClip===null?'‚Äî':fmt(yClip)}</td>`;
    }
    html+=row+'</tr>';
  });
  tbl.innerHTML=html;
}

function fmt(v){ if(!isFinite(v))return '‚Äî'; const a=Math.abs(v); if(a===0)return '0'; if(a>1e5||a<0.0001)return v.toExponential(3); return parseFloat(v.toFixed(4)).toString(); }

function drawSim(fn,p){
  const canvas=document.getElementById('simCanvas'); if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const W=canvas.width, H=canvas.height;
  const PAD={top:30,right:20,bottom:50,left:68};
  const pw=W-PAD.left-PAD.right, ph=H-PAD.top-PAD.bottom;

  // Compute data
  const [xmin,xmax]=fn.xRange;
  const steps=400;
  const dx=(xmax-xmin)/steps;
  const ys=[];
  for(let i=0;i<=steps;i++){
    const x=xmin+i*dx;
    let y=fn.fn(x,p);
    if(fn.clipNeg&&y<0) y=NaN;
    ys.push(y);
  }
  let ysB=null, ysC=null;
  if(fn.fn2&&fn.fn_b){
    ysB=[]; for(let i=0;i<=steps;i++) ysB.push(fn.fn_b(xmin+i*dx,p));
  }
  if(fn.fn_c){
    ysC=[]; for(let i=0;i<=steps;i++) ysC.push(fn.fn_c(xmin+i*dx,p));
  }

  // Y range
  const allY=[...ys,...(ysB||[]),...(ysC||[])].filter(v=>isFinite(v)&&!isNaN(v));
  let ymin=Math.min(...allY), ymax=Math.max(...allY);
  if(ymin===ymax){ymin-=1;ymax+=1;}
  const ypad=(ymax-ymin)*0.1; ymin-=ypad; ymax+=ypad;

  const toCanX=x=>PAD.left+(x-xmin)/(xmax-xmin)*pw;
  const toCanY=y=>PAD.top+(ymax-y)/(ymax-ymin)*ph;

  // Clear
  ctx.fillStyle='#0d1117'; ctx.fillRect(0,0,W,H);

  // Grid
  ctx.strokeStyle='rgba(48,54,61,0.7)'; ctx.lineWidth=1;
  const nGridX=8, nGridY=6;
  for(let i=0;i<=nGridX;i++){
    const x=toCanX(xmin+i*(xmax-xmin)/nGridX);
    ctx.beginPath(); ctx.moveTo(x,PAD.top); ctx.lineTo(x,PAD.top+ph); ctx.stroke();
  }
  for(let i=0;i<=nGridY;i++){
    const y=toCanY(ymin+i*(ymax-ymin)/nGridY);
    ctx.beginPath(); ctx.moveTo(PAD.left,y); ctx.lineTo(PAD.left+pw,y); ctx.stroke();
  }

  // Axes
  ctx.strokeStyle='rgba(240,230,211,0.25)'; ctx.lineWidth=1.5;
  // X axis
  if(ymin<=0&&ymax>=0){
    const y0=toCanY(0);
    ctx.beginPath(); ctx.moveTo(PAD.left,y0); ctx.lineTo(PAD.left+pw,y0); ctx.stroke();
  }
  // Y axis
  if(xmin<=0&&xmax>=0){
    const x0=toCanX(0);
    ctx.beginPath(); ctx.moveTo(x0,PAD.top); ctx.lineTo(x0,PAD.top+ph); ctx.stroke();
  }

  // Axis labels
  ctx.fillStyle='#b8a898'; ctx.font='12px JetBrains Mono,monospace'; ctx.textAlign='center';
  for(let i=0;i<=nGridX;i++){
    const xv=xmin+i*(xmax-xmin)/nGridX;
    ctx.fillText(fmtAxis(xv), toCanX(xv), PAD.top+ph+18);
  }
  ctx.textAlign='right';
  for(let i=0;i<=nGridY;i++){
    const yv=ymin+i*(ymax-ymin)/nGridY;
    ctx.fillText(fmtAxis(yv), PAD.left-8, toCanY(yv)+4);
  }

  // Axis titles
  ctx.fillStyle='#e6a817'; ctx.font='bold 11px JetBrains Mono,monospace';
  ctx.textAlign='center';
  ctx.fillText(fn.xLabel, PAD.left+pw/2, H-6);
  ctx.save(); ctx.translate(14, PAD.top+ph/2); ctx.rotate(-Math.PI/2);
  ctx.fillText(fn.yLabel, 0, 0); ctx.restore();

  // Helper: draw curve
  function drawCurve(data, color, lineW=2.5){
    ctx.strokeStyle=color; ctx.lineWidth=lineW;
    ctx.beginPath(); let penDown=false;
    for(let i=0;i<=steps;i++){
      const y=data[i];
      if(!isFinite(y)||isNaN(y)){penDown=false;continue;}
      const cx=toCanX(xmin+i*dx), cy=toCanY(y);
      if(!penDown){ctx.moveTo(cx,cy);penDown=true;}else{ctx.lineTo(cx,cy);}
    }
    ctx.stroke();
  }

  if(ysC) drawCurve(ysC, fn.colorC||'rgba(63,185,80,0.5)', 1.5);
  if(ysB) drawCurve(ysB, fn.colorB||'rgba(88,166,255,0.5)', 1.5);
  drawCurve(ys, fn.color, 2.5);

  // Mouse tooltip
  if(simState.mouseX!==null){
    const mouseXpx=simState.mouseX;
    if(mouseXpx>=PAD.left&&mouseXpx<=PAD.left+pw){
      const xv=xmin+(mouseXpx-PAD.left)/pw*(xmax-xmin);
      const yv=fn.fn(xv,p);
      if(isFinite(yv)&&!isNaN(yv)){
        const cx=mouseXpx, cy=toCanY(yv);
        // vertical line
        ctx.strokeStyle='rgba(230,168,23,0.35)'; ctx.lineWidth=1;
        ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(cx,PAD.top); ctx.lineTo(cx,PAD.top+ph); ctx.stroke();
        ctx.setLineDash([]);
        // dot
        ctx.fillStyle=fn.color; ctx.beginPath(); ctx.arc(cx,cy,5,0,Math.PI*2); ctx.fill();
        ctx.strokeStyle='#fff'; ctx.lineWidth=1.5; ctx.stroke();
        // tooltip
        const lbl=`(${fmtAxis(xv)}, ${fmtAxis(yv)})`;
        ctx.font='12px JetBrains Mono,monospace'; ctx.textAlign='left';
        const tw=ctx.measureText(lbl).width+16;
        let tx=cx+8, ty=cy-28;
        if(tx+tw>W-10) tx=cx-tw-8;
        if(ty<PAD.top+4) ty=cy+18;
        ctx.fillStyle='rgba(22,27,34,0.95)'; ctx.strokeStyle=fn.color;
        ctx.lineWidth=1; ctx.beginPath();
        ctx.roundRect(tx,ty,tw,22,4); ctx.fill(); ctx.stroke();
        ctx.fillStyle=fn.color; ctx.fillText(lbl,tx+8,ty+15);
        // coords display
        const coordsEl=document.getElementById('simCoords');
        if(coordsEl) coordsEl.textContent=`${fn.xLabel}=${fmtAxis(xv)}  ${fn.yLabel}=${fmtAxis(yv)}`;
      }
    }
  } else {
    const coordsEl=document.getElementById('simCoords');
    if(coordsEl) coordsEl.textContent='Mueve el cursor sobre la gr√°fica';
  }
}

function fmtAxis(v){
  if(!isFinite(v)) return '';
  const a=Math.abs(v);
  if(a===0) return '0';
  if(a>=10000||a<0.001) return v.toExponential(1);
  if(a>=100) return Math.round(v).toString();
  if(a>=10) return parseFloat(v.toFixed(1)).toString();
  return parseFloat(v.toFixed(2)).toString();
}

// Redraw on window resize (debounced)
window.addEventListener('resize', (()=>{
  let t; return ()=>{ clearTimeout(t); t=setTimeout(()=>{ if(simInitialized) drawSim(getSimFn(),getSimParams()); },150); };
})());

// ================================================================
// BIBLIOTECA ‚Äî RENDER
// ================================================================
function renderBibNav(){
  const nav=document.getElementById('bibNav'); if(!nav)return; nav.innerHTML='';
  Object.entries(BIBLIO).forEach(([k,v])=>{
    const b=document.createElement('button');
    b.className='bib-tab'+(k===bibState.topic?' on':'');
    b.innerHTML=`${v.icon} ${v.label}`; b.onclick=()=>{bibState.topic=k;renderBib();};
    nav.appendChild(b);
  });
}
function setBibLv(lv){
  bibState.lv=lv;
  document.querySelectorAll('.lv-pill').forEach(b=>b.classList.toggle('on',b.id==='bpill-'+lv));
  renderBibContent();
}
function renderBib(){ renderBibNav(); document.querySelectorAll('.lv-pill').forEach(b=>b.classList.toggle('on',b.id==='bpill-'+bibState.lv)); renderBibContent(); }

function renderBibContent(){
  const container=document.getElementById('bibContent'); if(!container)return;
  const data=BIBLIO[bibState.topic]?.[bibState.lv];
  const lvName={basic:'B√°sico',intermediate:'Intermedio',advanced:'Avanzado'}[bibState.lv];
  if(!data){container.innerHTML='<p style="color:var(--cd)">Contenido no disponible.</p>';return}
  const actsHTML=data.actividades.map((act,i)=>`
    <div class="actividad">
      <div class="act-lbl">Actividad ${i+1}</div>
      <div class="act-text">${act.texto}</div>
      <div class="act-dato">${act.datos.map(d=>`<div class="act-chip">${d}</div>`).join('')}</div>
      <button class="btn-reveal" onclick="toggleAct(${i},'${bibState.topic}','${bibState.lv}')">Ver respuesta</button>
      <div class="act-resp" id="act-${bibState.topic}-${bibState.lv}-${i}">‚úÖ ${act.respuesta}</div>
    </div>`).join('');

  // TTS read text (strip HTML)
  const ttsText=`${data.titulo}. ${data.teoria.replace(/<[^>]+>/g,' ')} Ejemplo: ${data.ejemplo.titulo}. ${data.ejemplo.texto.replace(/<[^>]+>/g,' ')}. Curiosidad: ${data.curiosidad}`.replace(/\s+/g,' ').trim();

  container.innerHTML=`
    <div class="teoria">
      <div class="teoria-head">
        <span class="teoria-icon">${BIBLIO[bibState.topic].icon}</span>
        <h3>${data.titulo}</h3>
        <span class="nivel-badge ${bibState.lv}">${lvName}</span>
        <button class="tts-btn" id="ttsBtn" onclick="ttsToggle()" title="Leer en voz alta" aria-label="Leer en voz alta">üîä</button>
      </div>
      <div class="teoria-body">
        <div class="teoria-text" id="ttsContent" data-tts="${ttsText.replace(/"/g,'&quot;')}">${data.teoria}</div>
        <div>
          <div class="pt" style="margin-bottom:10px">F√≥rmulas clave</div>
          <div class="fstrip">${data.formulas.map(f=>`<div class="fchip">${f}</div>`).join('')}</div>
        </div>
        <div class="ejemplo">
          <div class="ejemplo-lbl">${data.ejemplo.titulo}</div>
          <div class="ejemplo-text">${data.ejemplo.texto}</div>
        </div>
        <div>
          <div class="pt" style="margin-bottom:12px">Actividades</div>
          ${actsHTML}
        </div>
        <div class="curiosidad">
          <div class="cur-lbl">¬øSab√≠as que‚Ä¶?</div>
          ${data.curiosidad}
        </div>
      </div>
    </div>`;
}

function toggleAct(i,topic,lv){
  const el=document.getElementById(`act-${topic}-${lv}-${i}`); if(!el)return;
  el.classList.toggle('show');
  const btn=el.previousElementSibling;
  if(btn)btn.textContent=el.classList.contains('show')?'Ocultar respuesta':'Ver respuesta';
}

// ================================================================
// TTS ‚Äî LECTOR DE VOZ
// ================================================================
const TTS={
  utter:null, playing:false,
  init(){return 'speechSynthesis' in window},
  stop(){if(this.utter){speechSynthesis.cancel();this.playing=false;this.setBtn(false)}},
  setBtn(playing){const b=document.getElementById('ttsBtn');if(b)b.textContent=playing?'‚èπ Detener':'üîä'},
  speak(text){
    if(!this.init()){alert('Tu navegador no soporta s√≠ntesis de voz.');return;}
    this.stop();
    // Try Spanish voice
    const voices=speechSynthesis.getVoices();
    const esVoice=voices.find(v=>v.lang.startsWith('es'))||voices[0];
    this.utter=new SpeechSynthesisUtterance(text);
    this.utter.lang='es-MX';
    if(esVoice)this.utter.voice=esVoice;
    this.utter.rate=0.92; this.utter.pitch=1;
    this.utter.onstart=()=>{this.playing=true;this.setBtn(true)};
    this.utter.onend=()=>{this.playing=false;this.setBtn(false)};
    this.utter.onerror=()=>{this.playing=false;this.setBtn(false)};
    speechSynthesis.speak(this.utter);
  }
};

function ttsToggle(){
  if(TTS.playing){TTS.stop();return;}
  const el=document.getElementById('ttsContent');
  if(!el)return;
  TTS.speak(el.getAttribute('data-tts'));
}

// Load voices async (some browsers need this)
if('speechSynthesis' in window){
  speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices();
}
</script>

<!-- ============================================================
     CALCULADORA FLOTANTE
     Bot√≥n fijo en esquina inferior izquierda.
     Arrastreable, operaciones b√°sicas + funciones cient√≠ficas.
============================================================ -->
<style>
/* Bot√≥n toggle */
#calcToggle{
  position:fixed;bottom:24px;left:24px;z-index:1000;
  width:52px;height:52px;border-radius:50%;
  background:linear-gradient(135deg,var(--am),#c47f00);
  border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;color:#000;
  box-shadow:0 4px 20px rgba(230,168,23,.45);
  transition:transform .2s,box-shadow .2s;
}
#calcToggle:hover{transform:scale(1.1);box-shadow:0 6px 28px rgba(230,168,23,.6)}

/* Ventana calculadora */
#calcWin{
  position:fixed;bottom:88px;left:24px;z-index:1001;
  width:290px;
  background:var(--sf);border:1px solid var(--br);
  border-radius:16px;
  box-shadow:0 16px 48px rgba(0,0,0,.6);
  display:none;flex-direction:column;overflow:hidden;
  user-select:none;
}
#calcWin.open{display:flex}

/* Header arrastrable */
#calcHead{
  background:var(--sf2);padding:10px 14px;
  display:flex;align-items:center;justify-content:space-between;
  cursor:grab;border-bottom:1px solid var(--br);
}
#calcHead:active{cursor:grabbing}
#calcHead span{font-family:var(--mn);font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;color:var(--am)}
#calcClose{background:none;border:none;color:var(--cd);cursor:pointer;font-size:16px;line-height:1;padding:2px 6px;border-radius:4px;transition:background .15s}
#calcClose:hover{background:rgba(248,81,73,.2);color:var(--rd)}

/* Display */
#calcDisplay{
  padding:12px 16px;background:var(--bg);border-bottom:1px solid var(--br);
  min-height:70px;display:flex;flex-direction:column;justify-content:flex-end;align-items:flex-end;gap:2px;
}
#calcExpr{font-family:var(--mn);font-size:.78rem;color:var(--cd);min-height:16px;word-break:break-all;text-align:right}
#calcResult{font-family:var(--mn);font-size:1.6rem;color:var(--cr);word-break:break-all;text-align:right}
#calcResult.err{color:var(--rd);font-size:1rem}

/* Botones */
#calcBtns{
  display:grid;grid-template-columns:repeat(4,1fr);
  gap:1px;background:var(--br);
}
.cb{
  background:var(--sf2);border:none;
  color:var(--cr);font-family:var(--mn);font-size:.88rem;
  padding:14px 0;cursor:pointer;
  transition:background .1s;
  -webkit-tap-highlight-color:transparent;
}
.cb:hover{background:#2d3440}
.cb:active{background:#3a4150}
.cb.op{color:var(--am)}
.cb.fn{color:var(--bl);font-size:.75rem}
.cb.eq{background:var(--am);color:#000;font-weight:700}
.cb.eq:hover{background:#d4960a}
.cb.cl{color:var(--rd)}
.cb.span2{grid-column:span 2}
</style>

<!-- Bot√≥n toggle -->
<button id="calcToggle" onclick="toggleCalc()" aria-label="Abrir calculadora" title="Calculadora">üßÆ</button>

<!-- Ventana calculadora -->
<div id="calcWin" role="dialog" aria-label="Calculadora cient√≠fica">
  <div id="calcHead" onmousedown="startDrag(event)" ontouchstart="startDragTouch(event)">
    <span>Calculadora</span>
    <button id="calcClose" onclick="toggleCalc()" aria-label="Cerrar calculadora">‚úï</button>
  </div>
  <div id="calcDisplay">
    <div id="calcExpr"></div>
    <div id="calcResult">0</div>
  </div>
  <div id="calcBtns">
    <!-- Fila 1 -->
    <button class="cb fn" onclick="cFn('sin(')">sin</button>
    <button class="cb fn" onclick="cFn('cos(')">cos</button>
    <button class="cb fn" onclick="cFn('tan(')">tan</button>
    <button class="cb fn" onclick="cFn('sqrt(')">‚àö</button>
    <!-- Fila 2 -->
    <button class="cb fn" onclick="cFn('asin(')">asin</button>
    <button class="cb fn" onclick="cFn('acos(')">acos</button>
    <button class="cb fn" onclick="cFn('atan(')">atan</button>
    <button class="cb fn" onclick="cFn('log(')">log</button>
    <!-- Fila 3 -->
    <button class="cb fn" onclick="cFn('PI')">œÄ</button>
    <button class="cb fn" onclick="cFn('E')">e</button>
    <button class="cb fn" onclick="cFn('^')">x ∏</button>
    <button class="cb cl" onclick="cDel()">‚å´</button>
    <!-- Fila 4 -->
    <button class="cb cl" onclick="cClear()">AC</button>
    <button class="cb op" onclick="cFn('(')"> ( </button>
    <button class="cb op" onclick="cFn(')')"> ) </button>
    <button class="cb op" onclick="cFn('%')">%</button>
    <!-- Fila 5 -->
    <button class="cb"    onclick="cNum('7')">7</button>
    <button class="cb"    onclick="cNum('8')">8</button>
    <button class="cb"    onclick="cNum('9')">9</button>
    <button class="cb op" onclick="cFn('/')">√∑</button>
    <!-- Fila 6 -->
    <button class="cb"    onclick="cNum('4')">4</button>
    <button class="cb"    onclick="cNum('5')">5</button>
    <button class="cb"    onclick="cNum('6')">6</button>
    <button class="cb op" onclick="cFn('*')">√ó</button>
    <!-- Fila 7 -->
    <button class="cb"    onclick="cNum('1')">1</button>
    <button class="cb"    onclick="cNum('2')">2</button>
    <button class="cb"    onclick="cNum('3')">3</button>
    <button class="cb op" onclick="cFn('-')">‚àí</button>
    <!-- Fila 8 -->
    <button class="cb span2" onclick="cNum('0')">0</button>
    <button class="cb"    onclick="cFn('.')">.</button>
    <button class="cb op" onclick="cFn('+')">+</button>
    <!-- Fila 9 -->
    <button class="cb eq span2" onclick="cCalc()">=</button>
    <button class="cb fn" onclick="cFn('1/')">1/x</button>
    <button class="cb fn" onclick="cFn('(-')" title="Cambiar signo">+/‚àí</button>
  </div>
</div>

<script>
// ============================================================
// L√ìGICA DE LA CALCULADORA FLOTANTE
// ============================================================
let cExpr = '';    // expresi√≥n acumulada (string)
let cJustCalc = false; // flag para saber si se acaba de calcular

function toggleCalc(){
  const w=document.getElementById('calcWin');
  w.classList.toggle('open');
  document.getElementById('calcToggle').textContent = w.classList.contains('open') ? '‚úï' : 'üßÆ';
}

function cRefresh(){
  document.getElementById('calcExpr').textContent = cExpr || '';
}

function cNum(n){
  if(cJustCalc){ cExpr=''; cJustCalc=false; }
  cExpr += n;
  cRefresh();
  // Preview en tiempo real
  cPreview();
}

function cFn(op){
  if(cJustCalc && !['+','-','*','/','^','%',')',].includes(op)){ cExpr=''; cJustCalc=false; }
  if(op==='1/') { cExpr = '1/('+cExpr; cRefresh(); return; }
  if(op==='(-') { cExpr += '(-'; cRefresh(); return; }
  cExpr += op;
  cJustCalc=false;
  cRefresh();
  cPreview();
}

function cDel(){
  cExpr = cExpr.slice(0,-1);
  cJustCalc=false;
  cRefresh();
  cPreview();
}

function cClear(){
  cExpr=''; cJustCalc=false;
  document.getElementById('calcExpr').textContent='';
  document.getElementById('calcResult').textContent='0';
  document.getElementById('calcResult').className='';
}

function cPreview(){
  // Muestra resultado parcial mientras escribe
  try{
    const r = evalExpr(cExpr);
    if(r !== null && isFinite(r)){
      const el=document.getElementById('calcResult');
      el.textContent = formatNum(r);
      el.className='';
    }
  }catch(e){}
}

function cCalc(){
  if(!cExpr) return;
  try{
    const r = evalExpr(cExpr);
    if(r===null || !isFinite(r)) throw new Error();
    const el=document.getElementById('calcResult');
    el.textContent = formatNum(r);
    el.className='';
    document.getElementById('calcExpr').textContent = cExpr + ' =';
    cExpr = String(r);
    cJustCalc = true;
  }catch(e){
    const el=document.getElementById('calcResult');
    el.textContent='Error';el.className='err';
  }
}

// Formatea n√∫meros: sin decimales innecesarios, notaci√≥n cient√≠fica si es muy grande
function formatNum(n){
  if(Math.abs(n)>=1e12||( Math.abs(n)<1e-6 && n!==0)) return n.toExponential(6);
  // M√°ximo 10 decimales significativos
  const s = parseFloat(n.toFixed(10)).toString();
  return s;
}

// Eval√∫a la expresi√≥n de forma segura
function evalExpr(expr){
  if(!expr) return null;
  // Reemplazos para convertir la expresi√≥n a JS v√°lido
  let e = expr
    .replace(/sin\(/g,   'Math.sin(toRad(')
    .replace(/cos\(/g,   'Math.cos(toRad(')
    .replace(/tan\(/g,   'Math.tan(toRad(')
    .replace(/asin\(/g,  'toDeg(Math.asin(')
    .replace(/acos\(/g,  'toDeg(Math.acos(')
    .replace(/atan\(/g,  'toDeg(Math.atan(')
    .replace(/sqrt\(/g,  'Math.sqrt(')
    .replace(/log\(/g,   'Math.log10(')
    .replace(/\^/g,      '**')
    .replace(/%/g,       '/100')
    .replace(/PI/g,      'Math.PI')
    .replace(/E/g,       'Math.E');

  // Cierra par√©ntesis autom√°ticamente si faltan
  const open  = (e.match(/\(/g)||[]).length;
  const close = (e.match(/\)/g)||[]).length;
  e += ')'.repeat(Math.max(0, open-close));

  // Eval√∫a en contexto con helpers
  const fn = new Function('toRad','toDeg',`"use strict";return (${e})`)
  return fn(
    deg => deg * Math.PI / 180,
    rad => rad * 180 / Math.PI
  );
}

// ============================================================
// ARRASTRE (drag) de la ventana calculadora
// ============================================================
let drag={active:false,ox:0,oy:0,sx:0,sy:0};

function startDrag(e){
  if(e.target.id==='calcClose')return;
  e.preventDefault();
  const w=document.getElementById('calcWin');
  const r=w.getBoundingClientRect();
  drag={active:true,ox:e.clientX-r.left,oy:e.clientY-r.top,sx:r.left,sy:r.top};
  w.style.transition='none';
  document.addEventListener('mousemove',onDrag);
  document.addEventListener('mouseup',stopDrag);
}

function startDragTouch(e){
  const t=e.touches[0];
  const w=document.getElementById('calcWin');
  const r=w.getBoundingClientRect();
  drag={active:true,ox:t.clientX-r.left,oy:t.clientY-r.top};
  w.style.transition='none';
  document.addEventListener('touchmove',onDragTouch,{passive:false});
  document.addEventListener('touchend',stopDrag);
}

function onDrag(e){
  if(!drag.active)return;
  posCalc(e.clientX-drag.ox, e.clientY-drag.oy);
}
function onDragTouch(e){
  e.preventDefault();
  const t=e.touches[0];
  posCalc(t.clientX-drag.ox, t.clientY-drag.oy);
}

function posCalc(x,y){
  const w=document.getElementById('calcWin');
  const maxX=window.innerWidth-w.offsetWidth;
  const maxY=window.innerHeight-w.offsetHeight;
  w.style.left=Math.max(0,Math.min(x,maxX))+'px';
  w.style.top =Math.max(0,Math.min(y,maxY))+'px';
  w.style.bottom='auto';
}

function stopDrag(){
  drag.active=false;
  document.removeEventListener('mousemove',onDrag);
  document.removeEventListener('mouseup',stopDrag);
  document.removeEventListener('touchmove',onDragTouch);
  document.removeEventListener('touchend',stopDrag);
}

// Teclado f√≠sico cuando la calculadora est√° abierta
document.addEventListener('keydown',e=>{
  const w=document.getElementById('calcWin');
  if(!w.classList.contains('open'))return;
  // No interferir con el input de respuesta
  if(document.activeElement && document.activeElement.id==='ai')return;
  const map={'0':'0','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9','.':'.','+'  :'+','-':'-','*':'*','/':'/','^':'^','(':  '(',')'  :')','Enter':'=','='  :'=','Backspace':'back','Escape':'clear'};
  const k=map[e.key];
  if(!k)return;
  e.stopPropagation();
  if(k==='=')cCalc();
  else if(k==='back')cDel();
  else if(k==='clear')cClear();
  else if('0123456789.'.includes(k))cNum(k);
  else cFn(k);
});
</script>
</body>
</html>
